// ==UserScript==
// @name        IITC plugin: Data Explorer
// @description UI to explore intel available data
// @namespace   https://github.com/le-jeu
// @version     0.1.8
// @match       https://intel.ingress.com/*
// @author      jaiperdu
// @updateURL   https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @downloadURL https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @grant       none
// ==/UserScript==

function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};

var cssList = [];
function registerCSS(css) {
	cssList.push(css);
}

function addCSS(css) {
	var s = document.createElement('style');
	s.textContent = css;
	document.head.appendChild(s);
}

function addCSSs(css) {
	cssList.forEach(addCSS);
}
var setup=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function o(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(e,n,i){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const i=e.subscribe(...n);return i.unsubscribe?()=>i.unsubscribe():i}(n,i))}function r(t,e,n,i){if(t){const o=a(t,e,n,i);return t[0](o)}}function a(t,e,n,i){return t[1]&&i?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](i(e))):n.ctx}function c(t,e,n,i){if(t[2]&&i){const o=t[2](i(n));if(void 0===e.dirty)return o;if("object"==typeof o){const t=[],n=Math.max(e.dirty.length,o.length);for(let i=0;i<n;i+=1)t[i]=e.dirty[i]|o[i];return t}return e.dirty|o}return e.dirty}function d(t,e,n,i,o,l){if(o){const s=a(e,n,i,l);t.p(s,o)}}function u(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function p(t,e,n){return t.set(n),e}function f(t,e){t.appendChild(e)}function $(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function g(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function w(t){return document.createTextNode(t)}function v(){return w(" ")}function x(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function D(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function I(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function y(t,e,n){t.classList[n?"add":"remove"](e)}let b;function k(t){b=t}function E(){if(!b)throw new Error("Function called outside component initialization");return b}function C(t){E().$$.on_destroy.push(t)}function S(){const t=E();return(e,n)=>{const i=t.$$.callbacks[e];if(i){const o=function(t,e,n=!1){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,!1,e),i}(e,n);i.slice().forEach((e=>{e.call(t,o)}))}}}function _(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const L=[],T=[],P=[],q=[],R=Promise.resolve();let A=!1;function j(t){P.push(t)}let G=!1;const O=new Set;function M(){if(!G){G=!0;do{for(let t=0;t<L.length;t+=1){const e=L[t];k(e),z(e.$$)}for(k(null),L.length=0;T.length;)T.pop()();for(let t=0;t<P.length;t+=1){const e=P[t];O.has(e)||(O.add(e),e())}P.length=0}while(L.length);for(;q.length;)q.pop()();A=!1,G=!1,O.clear()}}function z(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(j)}}const F=new Set;let H;function N(){H={r:0,c:[],p:H}}function U(){H.r||i(H.c),H=H.p}function B(t,e){t&&t.i&&(F.delete(t),t.i(e))}function J(t,e,n,i){if(t&&t.o){if(F.has(t))return;F.add(t),H.c.push((()=>{F.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}}function Q(t){t&&t.c()}function Y(t,n,l,s){const{fragment:r,on_mount:a,on_destroy:c,after_update:d}=t.$$;r&&r.m(n,l),s||j((()=>{const n=a.map(e).filter(o);c?c.push(...n):i(n),t.$$.on_mount=[]})),d.forEach(j)}function Z(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function K(t,e){-1===t.$$.dirty[0]&&(L.push(t),A||(A=!0,R.then(M)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function V(e,o,l,s,r,a,c,d=[-1]){const u=b;k(e);const p=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:r,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(u?u.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:o.target||u.$$.root};c&&c(p.root);let f=!1;if(p.ctx=l?l(e,o.props||{},((t,n,...i)=>{const o=i.length?i[0]:n;return p.ctx&&r(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),f&&K(e,t)),n})):[],p.update(),f=!0,i(p.before_update),p.fragment=!!s&&s(p.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();o.intro&&B(e.$$.fragment),Y(e,o.target,o.anchor,o.customElement),M()}k(u)}class W{$destroy(){Z(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function X(t){let e,n;const i=t[3].default,o=r(i,t,t[2],null);return{c(){e=h("div"),o&&o.c()},m(i,l){$(i,e,l),o&&o.m(e,null),t[4](e),n=!0},p(t,[e]){o&&o.p&&(!n||4&e)&&d(o,i,t,t[2],n?c(i,t[2],e,null):u(t[2]),null)},i(t){n||(B(o,t),n=!0)},o(t){J(o,t),n=!1},d(n){n&&m(e),o&&o.d(n),t[4](null)}}}function tt(t,e,n){let i,{$$slots:o={},$$scope:l}=e,{options:s={}}=e,r=S();var a;return a=()=>{const t=s.closeCallback;dialog(Object.assign(s,{html:i,closeCallback:()=>{t&&t(),r("close")}}))},E().$$.on_mount.push(a),t.$$set=t=>{"options"in t&&n(1,s=t.options),"$$scope"in t&&n(2,l=t.$$scope)},[i,s,l,o,function(t){T[t?"unshift":"push"]((()=>{i=t,n(0,i)}))}]}class et extends W{constructor(t){super(),V(this,t,tt,X,l,{options:1})}}const nt=[];function it(e,n=t){let i;const o=new Set;function s(t){if(l(e,t)&&(e=t,i)){const t=!nt.length;for(const t of o)t[1](),nt.push(t,e);if(t){for(let t=0;t<nt.length;t+=2)nt[t][0](nt[t+1]);nt.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(l,r=t){const a=[l,r];return o.add(a),1===o.size&&(i=n(s)||t),l(e),()=>{o.delete(a),0===o.size&&(i(),i=null)}}}}const ot=it({}),lt=it({}),st=it({}),rt=it({}),at=it(null);function ct(t,e,n){const i=t.slice();return i[4]=e[n][0],i[5]=e[n][1],i}registerCSS("div.grid.svelte-1jc6t41.svelte-1jc6t41{display:grid;grid-template-columns:max-content auto;grid-gap:4px;box-sizing:border-box;padding:0.5em;border:1px solid #69a;background-color:#0001;max-width:100%;width:max-content;font-family:monospace}div.grid.svelte-1jc6t41>div.svelte-1jc6t41{overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:30em}");const dt=t=>({key:1&t}),ut=t=>({key:t[4]}),pt=t=>({key:1&t}),ft=t=>({key:t[4]});function $t(t){let e,n,i,o,l,s;const a=t[3].key,p=r(a,t,t[2],ft),g=p||function(t){let e,n=t[4]+"";return{c(){e=w(n)},m(t,n){$(t,e,n)},p(t,i){1&i&&n!==(n=t[4]+"")&&I(e,n)},d(t){t&&m(e)}}}(t),x=t[3].value,y=r(x,t,t[2],ut),b=y||function(t){let e,n=t[5]+"";return{c(){e=w(n)},m(t,n){$(t,e,n)},p(t,i){1&i&&n!==(n=t[5]+"")&&I(e,n)},d(t){t&&m(e)}}}(t);return{c(){e=h("div"),g&&g.c(),n=v(),i=h("div"),b&&b.c(),o=v(),D(e,"class","svelte-1jc6t41"),D(i,"title",l=t[1][t[4]]||t[5]),D(i,"class","svelte-1jc6t41")},m(t,l){$(t,e,l),g&&g.m(e,null),$(t,n,l),$(t,i,l),b&&b.m(i,null),f(i,o),s=!0},p(t,e){p?p.p&&(!s||5&e)&&d(p,a,t,t[2],s?c(a,t[2],e,pt):u(t[2]),ft):g&&g.p&&(!s||1&e)&&g.p(t,s?e:-1),y?y.p&&(!s||5&e)&&d(y,x,t,t[2],s?c(x,t[2],e,dt):u(t[2]),ut):b&&b.p&&(!s||1&e)&&b.p(t,s?e:-1),(!s||3&e&&l!==(l=t[1][t[4]]||t[5]))&&D(i,"title",l)},i(t){s||(B(g,t),B(b,t),s=!0)},o(t){J(g,t),J(b,t),s=!1},d(t){t&&m(e),g&&g.d(t),t&&m(n),t&&m(i),b&&b.d(t)}}}function mt(t){let e,n,i=Object.entries(t[0]),o=[];for(let e=0;e<i.length;e+=1)o[e]=$t(ct(t,i,e));const l=t=>J(o[t],1,1,(()=>{o[t]=null}));return{c(){e=h("div");for(let t=0;t<o.length;t+=1)o[t].c();D(e,"class","grid svelte-1jc6t41")},m(t,i){$(t,e,i);for(let t=0;t<o.length;t+=1)o[t].m(e,null);n=!0},p(t,[n]){if(7&n){let s;for(i=Object.entries(t[0]),s=0;s<i.length;s+=1){const l=ct(t,i,s);o[s]?(o[s].p(l,n),B(o[s],1)):(o[s]=$t(l),o[s].c(),B(o[s],1),o[s].m(e,null))}for(N(),s=i.length;s<o.length;s+=1)l(s);U()}},i(t){if(!n){for(let t=0;t<i.length;t+=1)B(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)J(o[t]);n=!1},d(t){t&&m(e),g(o,t)}}}function gt(t,e,n){let{$$slots:i={},$$scope:o}=e,{properties:l}=e,{titles:s={}}=e;return t.$$set=t=>{"properties"in t&&n(0,l=t.properties),"titles"in t&&n(1,s=t.titles),"$$scope"in t&&n(2,o=t.$$scope)},[l,s,o,i]}class ht extends W{constructor(t){super(),V(this,t,gt,mt,l,{properties:0,titles:1})}}function wt(t,e){return!!window.fields[e]&&window.fields[e].options.data.points.some((e=>e.guid==t))}function vt(t,e){const n=window.links[t];return!!n&&(wt(n.options.data.oGuid,e)&&wt(n.options.data.dGuid,e))}function xt(t){const e=new Date(t),n=e.getUTCFullYear()+"",i=e.getUTCMonth()+1+"",o=e.getUTCDate()+"",l=e.getUTCHours()+"",s=e.getUTCMinutes()+"",r=e.getUTCSeconds()+"",a=e.getUTCMilliseconds()+"";return`${n}-${i.padStart(2,"0")}-${o.padStart(2,"0")}T${l.padStart(2,"0")}:${s.padStart(2,"0")}:${r.padStart(2,"0")}.${a.padStart(3,"0")}Z`}function Dt(t){const[e,n,i,o,l,s]=t.split("_");return{zoom:+e,x:+n,y:+i,minlvl:+o,maxlvl:+l,maxhealth:+s}}function It(t,e,n){const i=t.slice();return i[7]=e[n],i}function yt(t){let e,n,i,o,l,s,r,a,c=(t[7][2]||t[7][0])+"",d=xt(t[7][1])+"";function u(){return t[5](t[7])}return{c(){e=h("div"),n=w(c),i=v(),o=h("div"),l=w(d),s=v(),D(e,"class","guid svelte-x0bl6q"),y(e,"raw",!t[7][2]),y(e,"selected",t[2]==t[7][0]),y(e,"active",t[1]==t[7][0]),D(o,"class","date raw svelte-x0bl6q"),y(o,"selected",t[2]==t[7][0]),y(o,"active",t[1]==t[7][0])},m(t,c){$(t,e,c),f(e,n),$(t,i,c),$(t,o,c),f(o,l),f(o,s),r||(a=x(e,"click",u),r=!0)},p(i,s){t=i,1&s&&c!==(c=(t[7][2]||t[7][0])+"")&&I(n,c),1&s&&y(e,"raw",!t[7][2]),5&s&&y(e,"selected",t[2]==t[7][0]),3&s&&y(e,"active",t[1]==t[7][0]),1&s&&d!==(d=xt(t[7][1])+"")&&I(l,d),5&s&&y(o,"selected",t[2]==t[7][0]),3&s&&y(o,"active",t[1]==t[7][0])},d(t){t&&m(e),t&&m(i),t&&m(o),r=!1,a()}}}function bt(e){let n,i=e[0],o=[];for(let t=0;t<i.length;t+=1)o[t]=yt(It(e,i,t));return{c(){n=h("div");for(let t=0;t<o.length;t+=1)o[t].c();D(n,"class","grid svelte-x0bl6q")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){if(15&e){let l;for(i=t[0],l=0;l<i.length;l+=1){const s=It(t,i,l);o[l]?o[l].p(s,e):(o[l]=yt(s),o[l].c(),o[l].m(n,null))}for(;l<o.length;l+=1)o[l].d(1);o.length=i.length}},i:t,o:t,d(t){t&&m(n),g(o,t)}}}function kt(t,e,n){const i=S();let{items:o}=e,{activeID:l}=e,{selectedID:s=null}=e,{type:r}=e;function a(t){i("select",{type:r,guid:t})}return t.$$set=t=>{"items"in t&&n(0,o=t.items),"activeID"in t&&n(1,l=t.activeID),"selectedID"in t&&n(2,s=t.selectedID),"type"in t&&n(4,r=t.type)},[o,l,s,a,r,t=>a(t[0])]}registerCSS(".grid.svelte-x0bl6q.svelte-x0bl6q{display:grid;grid-template-columns:auto max-content;grid-gap:4px;box-sizing:border-box;padding:0.5em;border:1px solid #69a;background-color:#0001;max-width:100%;width:max-content}.grid.svelte-x0bl6q div.svelte-x0bl6q{white-space:nowrap;max-width:30em}.grid.svelte-x0bl6q div.svelte-x0bl6q:nth-child(2n + 1){text-overflow:ellipsis;overflow:hidden}.raw.svelte-x0bl6q.svelte-x0bl6q{font-family:monospace}.date.svelte-x0bl6q.svelte-x0bl6q{margin-left:auto}.selected.svelte-x0bl6q.svelte-x0bl6q{color:red}.active.svelte-x0bl6q.svelte-x0bl6q{color:green}");class Et extends W{constructor(t){super(),V(this,t,kt,bt,l,{items:0,activeID:1,selectedID:2,type:4})}}function Ct(t){let e,n;return e=new Et({props:{type:"link",items:t[1].map(t[7]),activeID:t[0]}}),e.$on("select",t[8]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,[n]){const i={};6&n&&(i.items=t[1].map(t[7])),1&n&&(i.activeID=t[0]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function St(t,e,n){let i,o;s(t,lt,(t=>n(2,i=t))),s(t,rt,(t=>n(6,o=t)));let{portalID:l=null}=e,{activeID:r=!1}=e,{fieldID:a=null}=e,{tileID:c=null}=e,d=[];return t.$$set=t=>{"portalID"in t&&n(3,l=t.portalID),"activeID"in t&&n(0,r=t.activeID),"fieldID"in t&&n(4,a=t.fieldID),"tileID"in t&&n(5,c=t.tileID)},t.$$.update=()=>{if(126&t.$$.dirty){if(c){const t=o[c];n(1,d=t?t.entities.filter((t=>"e"==t[0])).map((t=>t[1])):[]),n(1,d=d.filter((t=>i[t])))}else n(1,d=Object.keys(i).filter((t=>{return(!l||(e=l,n=t,!!window.links[n]&&(window.links[n].options.data.oGuid==e||window.links[n].options.data.dGuid==e)))&&(!a||vt(t,a));var e,n})));d.sort(((t,e)=>i[e].options.timestamp-i[t].options.timestamp))}},[r,d,i,l,a,c,o,t=>[t,i[t].options.timestamp,!1],function(e){_.call(this,t,e)}]}class _t extends W{constructor(t){super(),V(this,t,St,Ct,l,{portalID:3,activeID:0,fieldID:4,tileID:5})}}function Lt(t){let e,n;return e=new Et({props:{type:"field",items:t[1].map(t[7]),activeID:t[0]}}),e.$on("select",t[8]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,[n]){const i={};6&n&&(i.items=t[1].map(t[7])),1&n&&(i.activeID=t[0]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function Tt(t,e,n){let i,o;s(t,st,(t=>n(2,i=t))),s(t,rt,(t=>n(6,o=t)));let{portalID:l=null}=e,{linkID:r=null}=e,{activeID:a=!1}=e,{tileID:c=null}=e,d=[];return t.$$set=t=>{"portalID"in t&&n(3,l=t.portalID),"linkID"in t&&n(4,r=t.linkID),"activeID"in t&&n(0,a=t.activeID),"tileID"in t&&n(5,c=t.tileID)},t.$$.update=()=>{if(126&t.$$.dirty){if(c){const t=o[c];n(1,d=t?t.entities.filter((t=>"r"==t[0])).map((t=>t[1])):[]),n(1,d=d.filter((t=>i[t])))}else n(1,d=Object.keys(i).filter((t=>(!l||wt(l,t))&&(!r||vt(r,t)))));d.sort(((t,e)=>i[e].options.timestamp-i[t].options.timestamp))}},[a,d,i,l,r,c,o,t=>[t,i[t].options.timestamp,!1],function(e){_.call(this,t,e)}]}class Pt extends W{constructor(t){super(),V(this,t,Tt,Lt,l,{portalID:3,linkID:4,activeID:0,tileID:5})}}function qt(t){let e,n;return e=new Et({props:{type:"tile",items:t[1].map(t[6]),activeID:t[0]}}),e.$on("select",t[7]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,[n]){const i={};6&n&&(i.items=t[1].map(t[6])),1&n&&(i.activeID=t[0]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function Rt(t,e,n){let i;s(t,rt,(t=>n(2,i=t)));let{portalID:o=null}=e,{linkID:l=null}=e,{fieldID:r=null}=e,{activeID:a=!1}=e,c=[],d=window.L.layerGroup().addTo(window.map);C((()=>{d.remove()}));return t.$$set=t=>{"portalID"in t&&n(3,o=t.portalID),"linkID"in t&&n(4,l=t.linkID),"fieldID"in t&&n(5,r=t.fieldID),"activeID"in t&&n(0,a=t.activeID)},t.$$.update=()=>{if(62&t.$$.dirty&&(n(1,c=Object.keys(i).filter((t=>(!o||i[t].entities.some((t=>t[1]==o)))&&(!l||i[t].entities.some((t=>t[1]==l)))&&(!r||i[t].entities.some((t=>t[1]==r)))))),c.sort(((t,e)=>i[e].time-i[t].time))),58&t.$$.dirty&&(d.clearLayers(),o||l||r)){const t=window.TILE_PARAMS.TILES_PER_EDGE[window.TILE_PARAMS.TILES_PER_EDGE.length-1];for(const e of c){const n=Dt(e),i={tilesPerEdge:window.TILE_PARAMS.TILES_PER_EDGE[n.zoom]||t},o=tileToLat(n.y,i),l=tileToLat(n.y+1,i),s=tileToLng(n.x,i),r=tileToLng(n.x+1,i);window.L.rectangle([[l,s],[o,r]],{color:"purple",interactive:!1}).addTo(d)}}},[a,c,i,o,l,r,t=>[t,i[t].time,!1],function(e){_.call(this,t,e)}]}class At extends W{constructor(t){super(),V(this,t,Rt,qt,l,{portalID:3,linkID:4,fieldID:5,activeID:0})}}function jt(t){let e,n,i,o,l,s,r,a,c,d,u,p,f,g,w,I,y,b;return i=new ht({props:{properties:t[3],titles:t[2],$$slots:{value:[Mt,({key:t})=>({9:t}),({key:t})=>t?512:0]},$$scope:{ctx:t}}}),r=new _t({props:{portalID:t[0]}}),r.$on("select",t[6]),u=new Pt({props:{portalID:t[0]}}),u.$on("select",t[7]),w=new At({props:{portalID:t[0]}}),w.$on("select",t[8]),{c(){e=h("h3"),e.textContent="Portal ↻",n=v(),Q(i.$$.fragment),o=v(),l=h("h3"),l.textContent="Links",s=v(),Q(r.$$.fragment),a=v(),c=h("h3"),c.textContent="Fields",d=v(),Q(u.$$.fragment),p=v(),f=h("h3"),f.textContent="Tiles",g=v(),Q(w.$$.fragment),D(e,"class","svelte-176lmyd"),D(l,"class","svelte-176lmyd"),D(c,"class","svelte-176lmyd"),D(f,"class","svelte-176lmyd")},m(m,h){$(m,e,h),$(m,n,h),Y(i,m,h),$(m,o,h),$(m,l,h),$(m,s,h),Y(r,m,h),$(m,a,h),$(m,c,h),$(m,d,h),Y(u,m,h),$(m,p,h),$(m,f,h),$(m,g,h),Y(w,m,h),I=!0,y||(b=x(e,"click",t[5]),y=!0)},p(t,e){const n={};8&e&&(n.properties=t[3]),4&e&&(n.titles=t[2]),1544&e&&(n.$$scope={dirty:e,ctx:t}),i.$set(n);const o={};1&e&&(o.portalID=t[0]),r.$set(o);const l={};1&e&&(l.portalID=t[0]),u.$set(l);const s={};1&e&&(s.portalID=t[0]),w.$set(s)},i(t){I||(B(i.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(w.$$.fragment,t),I=!0)},o(t){J(i.$$.fragment,t),J(r.$$.fragment,t),J(u.$$.fragment,t),J(w.$$.fragment,t),I=!1},d(t){t&&m(e),t&&m(n),Z(i,t),t&&m(o),t&&m(l),t&&m(s),Z(r,t),t&&m(a),t&&m(c),t&&m(d),Z(u,t),t&&m(p),t&&m(f),t&&m(g),Z(w,t),y=!1,b()}}}function Gt(t){let e,n=t[3][t[9]]+"";return{c(){e=w(n)},m(t,n){$(t,e,n)},p(t,i){520&i&&n!==(n=t[3][t[9]]+"")&&I(e,n)},d(t){t&&m(e)}}}function Ot(t){let e,n,i,o=t[3][t[9]]+"";return{c(){e=h("a"),n=w(o),D(e,"href",i=t[3][t[9]])},m(t,i){$(t,e,i),f(e,n)},p(t,l){520&l&&o!==(o=t[3][t[9]]+"")&&I(n,o),520&l&&i!==(i=t[3][t[9]])&&D(e,"href",i)},d(t){t&&m(e)}}}function Mt(t){let e;function n(t,e){return"image"==t[9]?Ot:Gt}let i=n(t),o=i(t);return{c(){o.c(),e=w("")},m(t,n){o.m(t,n),$(t,e,n)},p(t,l){i===(i=n(t))&&o?o.p(t,l):(o.d(1),o=i(t),o&&(o.c(),o.m(e.parentNode,e)))},d(t){o.d(t),t&&m(e)}}}function zt(t){let e,n,i=t[1]&&jt(t);return{c(){e=h("div"),i&&i.c()},m(t,o){$(t,e,o),i&&i.m(e,null),n=!0},p(t,[n]){t[1]?i?(i.p(t,n),2&n&&B(i,1)):(i=jt(t),i.c(),B(i,1),i.m(e,null)):i&&(N(),J(i,1,1,(()=>{i=null})),U())},i(t){n||(B(i),n=!0)},o(t){J(i),n=!1},d(t){t&&m(e),i&&i.d()}}}function Ft(t,e,n){let i,o,l;s(t,ot,(t=>n(4,l=t)));let{guid:r=null}=e,a=null;return t.$$set=t=>{"guid"in t&&n(0,r=t.guid)},t.$$.update=()=>{17&t.$$.dirty&&(r&&l[r]?n(1,a=l[r]):n(1,a=null)),2&t.$$.dirty&&n(3,i=a?{guid:a.options.guid,timestamp:xt(a.options.timestamp),team:a.options.team,latE6:a.options.data.latE6,lngE6:a.options.data.lngE6,level:a.options.level,health:a.options.data.health,resCount:a.options.data.resCount,image:a.options.data.image,title:a.options.data.title,ornaments:a.options.data.ornaments,mission:a.options.data.mission,mission50plus:a.options.data.mission50plus,artifactBrief:JSON.stringify(a.options.data.artifactBrief),mods:JSON.stringify(a.options.data.mods),resonators:JSON.stringify(a.options.data.resonators),owner:a.options.data.owner,artifactDetail:JSON.stringify(a.options.data.artifactDetail),history:a.options.data.history&&a.options.data.history._raw||0}:{}),2&t.$$.dirty&&n(2,o=a?{image:'<img src="'+a.options.data.image+'" style="width: 100px; height=100px"/>'}:{})},[r,a,o,i,l,()=>window.renderPortalDetails(r),function(e){_.call(this,t,e)},function(e){_.call(this,t,e)},function(e){_.call(this,t,e)}]}registerCSS("h3.svelte-176lmyd:hover{text-decoration:underline;cursor:pointer}");class Ht extends W{constructor(t){super(),V(this,t,Ft,zt,l,{guid:0})}}function Nt(t){let e,n;return e=new Et({props:{type:"portal",items:t[1].map(t[8]),selectedID:t[3],activeID:t[0]}}),e.$on("select",t[9]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,[n]){const i={};6&n&&(i.items=t[1].map(t[8])),8&n&&(i.selectedID=t[3]),1&n&&(i.activeID=t[0]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function Ut(t,e,n){let i,o,l;s(t,ot,(t=>n(2,i=t))),s(t,rt,(t=>n(7,o=t))),s(t,at,(t=>n(3,l=t)));let{activeID:r=!1}=e,{linkID:a=null}=e,{fieldID:c=null}=e,{tileID:d=null}=e,u=[];return t.$$set=t=>{"activeID"in t&&n(0,r=t.activeID),"linkID"in t&&n(4,a=t.linkID),"fieldID"in t&&n(5,c=t.fieldID),"tileID"in t&&n(6,d=t.tileID)},t.$$.update=()=>{if(246&t.$$.dirty)if(a){const t=window.links[a];n(1,u=t?[t.options.data.oGuid,t.options.data.dGuid]:[])}else if(c){const t=window.fields[c];n(1,u=t?t.options.data.points.map((t=>t.guid)):[])}else if(d){const t=o[d];n(1,u=t?t.entities.filter((t=>"p"==t[0])).map((t=>t[1])):[]),n(1,u=u.filter((t=>i[t])))}else n(1,u=Object.keys(i)),u.sort(((t,e)=>i[e].options.timestamp-i[t].options.timestamp))},[r,u,i,l,a,c,d,o,t=>[t,i[t].options.timestamp,i[t].options.data.title],function(e){_.call(this,t,e)}]}class Bt extends W{constructor(t){super(),V(this,t,Ut,Nt,l,{activeID:0,linkID:4,fieldID:5,tileID:6})}}function Jt(t){let e,n,i,o,l,s,r,a,c,d,u,p,f,g,w,x;return i=new ht({props:{properties:t[2]}}),r=new Bt({props:{linkID:t[0]}}),r.$on("select",t[4]),u=new Pt({props:{linkID:t[0]}}),u.$on("select",t[5]),w=new At({props:{linkID:t[0]}}),w.$on("select",t[6]),{c(){e=h("h3"),e.textContent="Link",n=v(),Q(i.$$.fragment),o=v(),l=h("h3"),l.textContent="Portals",s=v(),Q(r.$$.fragment),a=v(),c=h("h3"),c.textContent="Fields",d=v(),Q(u.$$.fragment),p=v(),f=h("h3"),f.textContent="Tiles",g=v(),Q(w.$$.fragment)},m(t,m){$(t,e,m),$(t,n,m),Y(i,t,m),$(t,o,m),$(t,l,m),$(t,s,m),Y(r,t,m),$(t,a,m),$(t,c,m),$(t,d,m),Y(u,t,m),$(t,p,m),$(t,f,m),$(t,g,m),Y(w,t,m),x=!0},p(t,e){const n={};4&e&&(n.properties=t[2]),i.$set(n);const o={};1&e&&(o.linkID=t[0]),r.$set(o);const l={};1&e&&(l.linkID=t[0]),u.$set(l);const s={};1&e&&(s.linkID=t[0]),w.$set(s)},i(t){x||(B(i.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(w.$$.fragment,t),x=!0)},o(t){J(i.$$.fragment,t),J(r.$$.fragment,t),J(u.$$.fragment,t),J(w.$$.fragment,t),x=!1},d(t){t&&m(e),t&&m(n),Z(i,t),t&&m(o),t&&m(l),t&&m(s),Z(r,t),t&&m(a),t&&m(c),t&&m(d),Z(u,t),t&&m(p),t&&m(f),t&&m(g),Z(w,t)}}}function Qt(t){let e,n,i=t[1]&&Jt(t);return{c(){e=h("div"),i&&i.c()},m(t,o){$(t,e,o),i&&i.m(e,null),n=!0},p(t,[n]){t[1]?i?(i.p(t,n),2&n&&B(i,1)):(i=Jt(t),i.c(),B(i,1),i.m(e,null)):i&&(N(),J(i,1,1,(()=>{i=null})),U())},i(t){n||(B(i),n=!0)},o(t){J(i),n=!1},d(t){t&&m(e),i&&i.d()}}}function Yt(t,e,n){let i,o;s(t,lt,(t=>n(3,o=t)));let{guid:l=null}=e,r=null;return t.$$set=t=>{"guid"in t&&n(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?n(1,r=o[l]):n(1,r=null)),2&t.$$.dirty&&n(2,i=r?{guid:r.options.guid,timestamp:xt(r.options.timestamp),team:r.options.team,oGuid:r.options.data.oGuid,oLatE6:r.options.data.oLatE6,oLngE6:r.options.data.oLngE6,dGuid:r.options.data.dGuid,dLatE6:r.options.data.dLatE6,dLngE6:r.options.data.dLngE6}:{})},[l,r,i,o,function(e){_.call(this,t,e)},function(e){_.call(this,t,e)},function(e){_.call(this,t,e)}]}class Zt extends W{constructor(t){super(),V(this,t,Yt,Qt,l,{guid:0})}}function Kt(t){let e,n,i,o,l,s,r,a,c,d,u,p,f,g,w,x;return i=new ht({props:{properties:t[2]}}),r=new Bt({props:{fieldID:t[0]}}),r.$on("select",t[4]),u=new _t({props:{fieldID:t[0]}}),u.$on("select",t[5]),w=new At({props:{fieldID:t[0]}}),w.$on("select",t[6]),{c(){e=h("h3"),e.textContent="Field",n=v(),Q(i.$$.fragment),o=v(),l=h("h3"),l.textContent="Portals",s=v(),Q(r.$$.fragment),a=v(),c=h("h3"),c.textContent="Links",d=v(),Q(u.$$.fragment),p=v(),f=h("h3"),f.textContent="Tiles",g=v(),Q(w.$$.fragment)},m(t,m){$(t,e,m),$(t,n,m),Y(i,t,m),$(t,o,m),$(t,l,m),$(t,s,m),Y(r,t,m),$(t,a,m),$(t,c,m),$(t,d,m),Y(u,t,m),$(t,p,m),$(t,f,m),$(t,g,m),Y(w,t,m),x=!0},p(t,e){const n={};4&e&&(n.properties=t[2]),i.$set(n);const o={};1&e&&(o.fieldID=t[0]),r.$set(o);const l={};1&e&&(l.fieldID=t[0]),u.$set(l);const s={};1&e&&(s.fieldID=t[0]),w.$set(s)},i(t){x||(B(i.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(w.$$.fragment,t),x=!0)},o(t){J(i.$$.fragment,t),J(r.$$.fragment,t),J(u.$$.fragment,t),J(w.$$.fragment,t),x=!1},d(t){t&&m(e),t&&m(n),Z(i,t),t&&m(o),t&&m(l),t&&m(s),Z(r,t),t&&m(a),t&&m(c),t&&m(d),Z(u,t),t&&m(p),t&&m(f),t&&m(g),Z(w,t)}}}function Vt(t){let e,n,i=t[1]&&Kt(t);return{c(){e=h("div"),i&&i.c()},m(t,o){$(t,e,o),i&&i.m(e,null),n=!0},p(t,[n]){t[1]?i?(i.p(t,n),2&n&&B(i,1)):(i=Kt(t),i.c(),B(i,1),i.m(e,null)):i&&(N(),J(i,1,1,(()=>{i=null})),U())},i(t){n||(B(i),n=!0)},o(t){J(i),n=!1},d(t){t&&m(e),i&&i.d()}}}function Wt(t,e,n){let i,o;s(t,st,(t=>n(3,o=t)));let{guid:l=null}=e,r=null;return t.$$set=t=>{"guid"in t&&n(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?n(1,r=o[l]):n(1,r=null)),2&t.$$.dirty&&n(2,i=r?{guid:r.options.guid,timestamp:xt(r.options.timestamp),team:r.options.team,"points[0].guid":r.options.data.points[0].guid,"points[0].latE6":r.options.data.points[0].latE6,"points[0].lngE6":r.options.data.points[0].lngE6,"points[1].guid":r.options.data.points[1].guid,"points[1].latE6":r.options.data.points[1].latE6,"points[1].lngE6":r.options.data.points[1].lngE6,"points[2].guid":r.options.data.points[2].guid,"points[2].latE6":r.options.data.points[2].latE6,"points[2].lngE6":r.options.data.points[2].lngE6}:{})},[l,r,i,o,function(e){_.call(this,t,e)},function(e){_.call(this,t,e)},function(e){_.call(this,t,e)}]}class Xt extends W{constructor(t){super(),V(this,t,Wt,Vt,l,{guid:0})}}function te(t){let e,n,i,o,l,s,r,a,c,d,u,p,f,g,w,x;return i=new ht({props:{properties:t[2]}}),r=new Bt({props:{tileID:t[0]}}),r.$on("select",t[4]),u=new _t({props:{tileID:t[0]}}),u.$on("select",t[5]),w=new Pt({props:{tileID:t[0]}}),w.$on("select",t[6]),{c(){e=h("h3"),e.textContent="Tile",n=v(),Q(i.$$.fragment),o=v(),l=h("h3"),l.textContent="Portals",s=v(),Q(r.$$.fragment),a=v(),c=h("h3"),c.textContent="Links",d=v(),Q(u.$$.fragment),p=v(),f=h("h3"),f.textContent="Fields",g=v(),Q(w.$$.fragment)},m(t,m){$(t,e,m),$(t,n,m),Y(i,t,m),$(t,o,m),$(t,l,m),$(t,s,m),Y(r,t,m),$(t,a,m),$(t,c,m),$(t,d,m),Y(u,t,m),$(t,p,m),$(t,f,m),$(t,g,m),Y(w,t,m),x=!0},p(t,e){const n={};4&e&&(n.properties=t[2]),i.$set(n);const o={};1&e&&(o.tileID=t[0]),r.$set(o);const l={};1&e&&(l.tileID=t[0]),u.$set(l);const s={};1&e&&(s.tileID=t[0]),w.$set(s)},i(t){x||(B(i.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(w.$$.fragment,t),x=!0)},o(t){J(i.$$.fragment,t),J(r.$$.fragment,t),J(u.$$.fragment,t),J(w.$$.fragment,t),x=!1},d(t){t&&m(e),t&&m(n),Z(i,t),t&&m(o),t&&m(l),t&&m(s),Z(r,t),t&&m(a),t&&m(c),t&&m(d),Z(u,t),t&&m(p),t&&m(f),t&&m(g),Z(w,t)}}}function ee(t){let e,n,i=t[1]&&te(t);return{c(){e=h("div"),i&&i.c()},m(t,o){$(t,e,o),i&&i.m(e,null),n=!0},p(t,[n]){t[1]?i?(i.p(t,n),2&n&&B(i,1)):(i=te(t),i.c(),B(i,1),i.m(e,null)):i&&(N(),J(i,1,1,(()=>{i=null})),U())},i(t){n||(B(i),n=!0)},o(t){J(i),n=!1},d(t){t&&m(e),i&&i.d()}}}function ne(t,e,n){let i;s(t,rt,(t=>n(3,i=t)));let{tid:o=null}=e,l=null,r={};return t.$$set=t=>{"tid"in t&&n(0,o=t.tid)},t.$$.update=()=>{if(9&t.$$.dirty&&n(1,l=o?i[o]:null),3&t.$$.dirty)if(l){const[t,e,i,s,a,c]=o.split("_");n(2,r={id:o,time:xt(l.time),zoom:t,x:e,y:i,minlvl:s,maxlvl:a,maxhealth:c})}else n(2,r={})},[o,l,r,i,function(e){_.call(this,t,e)},function(e){_.call(this,t,e)},function(e){_.call(this,t,e)}]}class ie extends W{constructor(t){super(),V(this,t,ne,ee,l,{tid:0})}}function oe(t){let e,n,i;return{c(){e=h("li"),e.textContent="Current portal",D(e,"class","svelte-ax0e4s"),y(e,"selected","portal"==t[0]&&t[1]==t[3])},m(o,l){$(o,e,l),n||(i=x(e,"click",t[5]),n=!0)},p(t,n){11&n&&y(e,"selected","portal"==t[0]&&t[1]==t[3])},d(t){t&&m(e),n=!1,i()}}}function le(t){let e,n;return e=new At({props:{activeID:"tile"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};3&n&&(i.activeID="tile"==t[0]&&t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function se(t){let e,n;return e=new Pt({props:{activeID:"field"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};3&n&&(i.activeID="field"==t[0]&&t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function re(t){let e,n;return e=new _t({props:{activeID:"link"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};3&n&&(i.activeID="link"==t[0]&&t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function ae(t){let e,n;return e=new Bt({props:{activeID:"portal"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};3&n&&(i.activeID="portal"==t[0]&&t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function ce(t){let e,n,i,o;const l=[fe,pe,ue,de],s=[];function r(t,e){return"portal"==t[0]?0:"link"==t[0]?1:"field"==t[0]?2:"tile"==t[0]?3:-1}return~(n=r(t))&&(i=s[n]=l[n](t)),{c(){e=h("div"),i&&i.c(),D(e,"class","card svelte-ax0e4s")},m(t,i){$(t,e,i),~n&&s[n].m(e,null),o=!0},p(t,o){let a=n;n=r(t),n===a?~n&&s[n].p(t,o):(i&&(N(),J(s[a],1,1,(()=>{s[a]=null})),U()),~n?(i=s[n],i?i.p(t,o):(i=s[n]=l[n](t),i.c()),B(i,1),i.m(e,null)):i=null)},i(t){o||(B(i),o=!0)},o(t){J(i),o=!1},d(t){t&&m(e),~n&&s[n].d()}}}function de(t){let e,n;return e=new ie({props:{tid:t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};2&n&&(i.tid=t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function ue(t){let e,n;return e=new Xt({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};2&n&&(i.guid=t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function pe(t){let e,n;return e=new Zt({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};2&n&&(i.guid=t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function fe(t){let e,n;return e=new Ht({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,n){const i={};2&n&&(i.guid=t[1]),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function $e(t){let e,n,o,l,s,r,a,c,d,u,p,g,w,I,b,k,E,C,S=t[3]&&oe(t);const _=[ae,re,se,le],L=[];function T(t,e){return"portals"==t[2]?0:"links"==t[2]?1:"fields"==t[2]?2:"tiles"==t[2]?3:-1}~(w=T(t))&&(I=L[w]=_[w](t));let P=t[0]&&ce(t);return{c(){e=h("div"),n=h("div"),o=h("ul"),l=h("li"),l.textContent="Portals",s=v(),r=h("li"),r.textContent="Links",a=v(),c=h("li"),c.textContent="Fields",d=v(),u=h("li"),u.textContent="Tiles",p=v(),S&&S.c(),g=v(),I&&I.c(),b=v(),P&&P.c(),D(l,"class","svelte-ax0e4s"),y(l,"active","portals"==t[2]),D(r,"class","svelte-ax0e4s"),y(r,"active","links"==t[2]),D(c,"class","svelte-ax0e4s"),y(c,"active","fields"==t[2]),D(u,"class","svelte-ax0e4s"),y(u,"active","tiles"==t[2]),D(o,"class","tablist svelte-ax0e4s"),D(n,"class","list svelte-ax0e4s"),D(e,"class","content svelte-ax0e4s")},m(i,m){$(i,e,m),f(e,n),f(n,o),f(o,l),f(o,s),f(o,r),f(o,a),f(o,c),f(o,d),f(o,u),f(o,p),S&&S.m(o,null),f(n,g),~w&&L[w].m(n,null),f(e,b),P&&P.m(e,null),k=!0,E||(C=[x(l,"click",t[6]),x(r,"click",t[7]),x(c,"click",t[8]),x(u,"click",t[9])],E=!0)},p(t,i){4&i&&y(l,"active","portals"==t[2]),4&i&&y(r,"active","links"==t[2]),4&i&&y(c,"active","fields"==t[2]),4&i&&y(u,"active","tiles"==t[2]),t[3]?S?S.p(t,i):(S=oe(t),S.c(),S.m(o,null)):S&&(S.d(1),S=null);let s=w;w=T(t),w===s?~w&&L[w].p(t,i):(I&&(N(),J(L[s],1,1,(()=>{L[s]=null})),U()),~w?(I=L[w],I?I.p(t,i):(I=L[w]=_[w](t),I.c()),B(I,1),I.m(n,null)):I=null),t[0]?P?(P.p(t,i),1&i&&B(P,1)):(P=ce(t),P.c(),B(P,1),P.m(e,null)):P&&(N(),J(P,1,1,(()=>{P=null})),U())},i(t){k||(B(I),B(P),k=!0)},o(t){J(I),J(P),k=!1},d(t){t&&m(e),S&&S.d(),~w&&L[w].d(),P&&P.d(),E=!1,i(C)}}}function me(t){let e,n;return e=new et({props:{options:{title:"Data Explorer",resizable:!0,width:"auto"},$$slots:{default:[$e]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){Q(e.$$.fragment)},m(t,i){Y(e,t,i),n=!0},p(t,[n]){const i={};32783&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i(t){n||(B(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function ge(t,e,n){let i,o;s(t,rt,(t=>n(13,i=t))),s(t,at,(t=>n(3,o=t)));let l=null,r=null,a=null,c=[];function d(t){for(const t of c){const[e,n]=t;switch(e){case"p":break;case"e":const t=window.links[n];t&&t.setStyle({color:COLORS[t.options.team]});break;case"r":const e=window.fields[n];e&&e.setStyle({fillColor:COLORS[e.options.team]})}}c=t;for(const t of c){const[e,n]=t;switch(e){case"p":break;case"e":const t=window.links[n];t&&(t.setStyle({color:"red"}),t.bringToFront());break;case"r":const e=window.fields[n];e&&(e.setStyle({fillColor:"red"}),e.bringToFront())}}}let u="portals";C((()=>{d([]),a&&a.remove()}));return[l,r,u,o,function(t){if(a&&(a.remove(),a=null),d([]),t.detail)switch(n(0,l=t.detail.type),n(1,r=t.detail.guid),l){case"portal":window.selectPortal(r);break;case"link":d([["e",r]]);break;case"field":d([["r",r]]);break;case"tile":const t=Dt(r),e=window.TILE_PARAMS.TILES_PER_EDGE[window.TILE_PARAMS.TILES_PER_EDGE.length-1],n={tilesPerEdge:window.TILE_PARAMS.TILES_PER_EDGE[t.zoom]||e},o=tileToLat(t.y,n),l=tileToLat(t.y+1,n),s=tileToLng(t.x,n),c=tileToLng(t.x+1,n),u=i[r];u&&d(u.entities),a=window.L.rectangle([[l,s],[o,c]],{color:"purple"}).addTo(window.map)}else n(1,r=null),n(0,l=null)},function(){window.selectedPortal&&(n(0,l="portal"),n(1,r=window.selectedPortal))},()=>n(2,u="portals"),()=>n(2,u="links"),()=>n(2,u="fields"),()=>n(2,u="tiles"),function(e){_.call(this,t,e)}]}registerCSS(".content.svelte-ax0e4s.svelte-ax0e4s{display:grid;grid-gap:24px;grid-auto-flow:column}.tablist.svelte-ax0e4s.svelte-ax0e4s{padding-left:1em}.tablist.svelte-ax0e4s li.svelte-ax0e4s{display:inline-block}.tablist.svelte-ax0e4s li.active.svelte-ax0e4s{font-weight:bold}.tablist.svelte-ax0e4s li.selected.svelte-ax0e4s{color:red;font-weight:bold}.tablist.svelte-ax0e4s li.svelte-ax0e4s:nth-child(n + 2)::before{content:'| '}.content.svelte-ax0e4s>div.svelte-ax0e4s{background-color:#0003;border-radius:10px;padding:0.5em}@media(max-width: 700px){.content.svelte-ax0e4s>div.svelte-ax0e4s{box-sizing:border-box;width:calc(100vw - 24px)}}");class he extends W{constructor(t){super(),V(this,t,ge,me,l,{})}}function we(e){let n,i,o;return{c(){n=h("a"),n.textContent="DataExplorer"},m(t,l){$(t,n,l),i||(o=x(n,"click",e[0]),i=!0)},p:t,i:t,o:t,d(t){t&&m(n),i=!1,o()}}}function ve(t,e,n){let i,o,l,r,a;s(t,rt,(t=>n(2,i=t))),s(t,at,(t=>n(3,o=t))),s(t,st,(t=>n(4,l=t))),s(t,lt,(t=>n(5,r=t))),s(t,ot,(t=>n(6,a=t))),p(ot,a=window.portals,a),p(lt,r=window.links,r),p(st,l=window.fields,l),p(at,o=window.selectedPortal,o),window.addHook("mapDataRefreshEnd",(()=>{p(ot,a=window.portals,a),p(lt,r=window.links,r),p(st,l=window.fields,l)})),window.addHook("portalAdded",(t=>{p(ot,a[t.portal.options.guid]=t.portal,a)})),window.addHook("linkAdded",(t=>{p(lt,r[t.link.options.guid]=t.link,r)})),window.addHook("fieldAdded",(t=>{p(st,l[t.field.options.guid]=t.field,l)})),window.addHook("portalSelected",(t=>{p(at,o=t.selectedPortalGuid,o)}));let c=0;window.addHook("mapDataRefreshStart",(()=>{c=Date.now()})),window.addHook("mapDataRefreshEnd",(()=>{const t=i,e=[],n=c-3e5;for(const i in t)t[i].time<n&&e.push(i);for(const n of e)delete t[n];p(rt,i=t,i)}));const d=window.MapDataRequest.prototype.pushRenderQueue;return window.MapDataRequest.prototype.pushRenderQueue=function(t,e,n){d.call(this,t,e,n),p(rt,i[t]={time:Date.now(),entities:e.gameEntities.map((t=>[t[2][0],t[0]]))},i)},[function(){const t=new he({target:document.body});t.$on("close",(()=>t.$destroy()))}]}class xe extends W{constructor(t){super(),V(this,t,ve,we,l,{})}}const De="dataExplorer";class Ie{init(){const t=document.querySelector("#toolbox");new xe({target:t})}}return()=>{window.plugin[De]=new Ie,window.plugin[De].init(),addCSSs()}}();
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
} // wrapper end
// inject code into site context
var script = document.createElement('script');
var info = {};
if (typeof GM_info !== 'undefined' && GM_info && GM_info.script) info.script = { version: GM_info.script.version, name: GM_info.script.name, description: GM_info.script.description };
script.appendChild(document.createTextNode('('+ wrapper +')('+JSON.stringify(info)+');'));
(document.body || document.head || document.documentElement).appendChild(script);
