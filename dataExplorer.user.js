// ==UserScript==
// @name        IITC plugin: Data Explorer
// @description UI to explore intel available data
// @namespace   https://github.com/le-jeu
// @version     0.1.2
// @match       https://intel.ingress.com/*
// @author      jaiperdu
// @updateURL   https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @downloadURL https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @grant       none
// ==/UserScript==

function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};

var cssList = [];
function registerCSS(css) {
	cssList.push(css);
}

function addCSS(css) {
	var s = document.createElement('style');
	s.textContent = css;
	document.head.appendChild(s);
}

function addCSSs(css) {
	cssList.forEach(addCSS);
}
var setup=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function r(t,e,n,o){if(t){const i=c(t,e,n,o);return t[0](i)}}function c(t,e,n,o){return t[1]&&o?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](o(e))):n.ctx}function a(t,e,n,o){if(t[2]&&o){const i=t[2](o(n));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],n=Math.max(e.dirty.length,i.length);for(let o=0;o<n;o+=1)t[o]=e.dirty[o]|i[o];return t}return e.dirty|i}return e.dirty}function d(t,e,n,o,i,l){if(i){const s=c(e,n,o,l);t.p(s,i)}}function u(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function p(t,e,n){return t.set(n),e}function f(t,e){t.appendChild(e)}function $(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function g(t){return document.createElement(t)}function h(t){return document.createTextNode(t)}function v(){return h(" ")}function w(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function k(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function b(t,e,n){t.classList[n?"add":"remove"](e)}let x;function D(t){x=t}function I(){if(!x)throw new Error("Function called outside component initialization");return x}function E(){const t=I();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const i=function(t,e,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,!1,e),o}(e,n);o.slice().forEach((e=>{e.call(t,i)}))}}}function C(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const S=[],q=[],O=[],_=[],L=Promise.resolve();let j=!1;function G(t){O.push(t)}let M=!1;const P=new Set;function T(){if(!M){M=!0;do{for(let t=0;t<S.length;t+=1){const e=S[t];D(e),A(e.$$)}for(D(null),S.length=0;q.length;)q.pop()();for(let t=0;t<O.length;t+=1){const e=O[t];P.has(e)||(P.add(e),e())}O.length=0}while(S.length);for(;_.length;)_.pop()();j=!1,M=!1,P.clear()}}function A(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(G)}}const F=new Set;let N;function U(){N={r:0,c:[],p:N}}function z(){N.r||o(N.c),N=N.p}function H(t,e){t&&t.i&&(F.delete(t),t.i(e))}function B(t,e,n,o){if(t&&t.o){if(F.has(t))return;F.add(t),N.c.push((()=>{F.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function J(t,e){t.d(1),e.delete(t.key)}function R(t,e,n,o,i,l,s,r,c,a,d,u){let p=t.length,f=l.length,$=p;const m={};for(;$--;)m[t[$].key]=$;const g=[],h=new Map,v=new Map;for($=f;$--;){const t=u(i,l,$),r=n(t);let c=s.get(r);c?o&&c.p(t,e):(c=a(r,t),c.c()),h.set(r,g[$]=c),r in m&&v.set(r,Math.abs($-m[r]))}const w=new Set,k=new Set;function y(t){H(t,1),t.m(r,d),s.set(t.key,t),d=t.first,f--}for(;p&&f;){const e=g[f-1],n=t[p-1],o=e.key,i=n.key;e===n?(d=e.first,p--,f--):h.has(i)?!s.has(o)||w.has(o)?y(e):k.has(i)?p--:v.get(o)>v.get(i)?(k.add(o),y(e)):(w.add(i),p--):(c(n,s),p--)}for(;p--;){const e=t[p];h.has(e.key)||c(e,s)}for(;f;)y(g[f-1]);return g}function Y(t){t&&t.c()}function Z(t,n,l,s){const{fragment:r,on_mount:c,on_destroy:a,after_update:d}=t.$$;r&&r.m(n,l),s||G((()=>{const n=c.map(e).filter(i);a?a.push(...n):o(n),t.$$.on_mount=[]})),d.forEach(G)}function K(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Q(t,e){-1===t.$$.dirty[0]&&(S.push(t),j||(j=!0,L.then(T)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function V(e,i,l,s,r,c,a,d=[-1]){const u=x;D(e);const p=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:r,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(u?u.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:i.target||u.$$.root};a&&a(p.root);let f=!1;if(p.ctx=l?l(e,i.props||{},((t,n,...o)=>{const i=o.length?o[0]:n;return p.ctx&&r(p.ctx[t],p.ctx[t]=i)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](i),f&&Q(e,t)),n})):[],p.update(),f=!0,o(p.before_update),p.fragment=!!s&&s(p.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();i.intro&&H(e.$$.fragment),Z(e,i.target,i.anchor,i.customElement),T()}D(u)}class W{$destroy(){K(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function X(t){let e,n;const o=t[3].default,i=r(o,t,t[2],null);return{c(){e=g("div"),i&&i.c()},m(o,l){$(o,e,l),i&&i.m(e,null),t[4](e),n=!0},p(t,[e]){i&&i.p&&(!n||4&e)&&d(i,o,t,t[2],n?a(o,t[2],e,null):u(t[2]),null)},i(t){n||(H(i,t),n=!0)},o(t){B(i,t),n=!1},d(n){n&&m(e),i&&i.d(n),t[4](null)}}}function tt(t,e,n){let o,{$$slots:i={},$$scope:l}=e,{options:s={}}=e;var r;return r=()=>{dialog(Object.assign(s,{html:o}))},I().$$.on_mount.push(r),t.$$set=t=>{"options"in t&&n(1,s=t.options),"$$scope"in t&&n(2,l=t.$$scope)},[o,s,l,i,function(t){q[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}class et extends W{constructor(t){super(),V(this,t,tt,X,l,{options:1})}}const nt=[];function ot(e,n=t){let o;const i=new Set;function s(t){if(l(e,t)&&(e=t,o)){const t=!nt.length;for(const t of i)t[1](),nt.push(t,e);if(t){for(let t=0;t<nt.length;t+=2)nt[t][0](nt[t+1]);nt.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(l,r=t){const c=[l,r];return i.add(c),1===i.size&&(o=n(s)||t),l(e),()=>{i.delete(c),0===i.size&&(o(),o=null)}}}}const it=ot({}),lt=ot({}),st=ot({}),rt=ot(null);function ct(t,e,n){const o=t.slice();return o[3]=e[n],o}registerCSS(".grid.svelte-l1q3nr{display:grid;grid-template-columns:max-content auto;grid-gap:4px;font-family:monospace}.grid.svelte-l1q3nr>div{overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:30em}");const at=t=>({key:1&t}),dt=t=>({key:t[3]}),ut=t=>({key:1&t}),pt=t=>({key:t[3]});function ft(t){let e,n;const o=t[2].key,i=r(o,t,t[1],pt),l=i||function(t){let e;return{c(){e=g("div")},m(t,n){$(t,e,n)},d(t){t&&m(e)}}}(),s=t[2].value,c=r(s,t,t[1],dt),p=c||function(t){let e;return{c(){e=g("div")},m(t,n){$(t,e,n)},d(t){t&&m(e)}}}();return{c(){l&&l.c(),e=v(),p&&p.c()},m(t,o){l&&l.m(t,o),$(t,e,o),p&&p.m(t,o),n=!0},p(t,e){i&&i.p&&(!n||3&e)&&d(i,o,t,t[1],n?a(o,t[1],e,ut):u(t[1]),pt),c&&c.p&&(!n||3&e)&&d(c,s,t,t[1],n?a(s,t[1],e,at):u(t[1]),dt)},i(t){n||(H(l,t),H(p,t),n=!0)},o(t){B(l,t),B(p,t),n=!1},d(t){l&&l.d(t),t&&m(e),p&&p.d(t)}}}function $t(t){let e,n,o=t[0],i=[];for(let e=0;e<o.length;e+=1)i[e]=ft(ct(t,o,e));const l=t=>B(i[t],1,1,(()=>{i[t]=null}));return{c(){e=g("div");for(let t=0;t<i.length;t+=1)i[t].c();k(e,"class","grid svelte-l1q3nr")},m(t,o){$(t,e,o);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n=!0},p(t,[n]){if(3&n){let s;for(o=t[0],s=0;s<o.length;s+=1){const l=ct(t,o,s);i[s]?(i[s].p(l,n),H(i[s],1)):(i[s]=ft(l),i[s].c(),H(i[s],1),i[s].m(e,null))}for(U(),s=o.length;s<i.length;s+=1)l(s);z()}},i(t){if(!n){for(let t=0;t<o.length;t+=1)H(i[t]);n=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)B(i[t]);n=!1},d(t){t&&m(e),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(i,t)}}}function mt(t,e,n){let{$$slots:o={},$$scope:i}=e,{properties:l=[]}=e;return t.$$set=t=>{"properties"in t&&n(0,l=t.properties),"$$scope"in t&&n(1,i=t.$$scope)},[l,i,o]}class gt extends W{constructor(t){super(),V(this,t,mt,$t,l,{properties:0})}}function ht(t,e){return!!window.fields[e]&&window.fields[e].options.data.points.some((e=>e.guid==t))}function vt(t,e){return!!window.links[e]&&(window.links[e].options.data.oGuid==t||window.links[e].options.data.dGuid==t)}function wt(t,e){const n=window.links[t];return!!n&&(ht(n.options.data.oGuid,e)&&ht(n.options.data.dGuid,e))}function kt(t){const e=new Date(t),n=e.getUTCFullYear()+"",o=e.getUTCMonth()+1+"",i=e.getUTCDate()+"",l=e.getUTCHours()+"",s=e.getUTCMinutes()+"",r=e.getUTCSeconds()+"",c=e.getUTCMilliseconds()+"";return`${n}-${o.padStart(2,"0")}-${i.padStart(2,"0")}T${l.padStart(2,"0")}:${s.padStart(2,"0")}:${r.padStart(2,"0")}.${c.padStart(3,"0")}Z`}function yt(t,e,n){const o=t.slice();return o[8]=e[n],o}function bt(t,e){let n,o,i,l,s,r,c,a=e[8]+"",d=kt(e[2][e[8]].options.timestamp)+"";function u(){return e[6](e[8])}return{key:t,first:null,c(){n=g("div"),o=h(a),i=v(),l=g("div"),s=h(d),k(n,"class","raw svelte-bq6hwe"),b(n,"active",e[8]==e[0]),k(l,"class","raw date svelte-bq6hwe"),b(l,"active",e[8]==e[0]),this.first=n},m(t,e){$(t,n,e),f(n,o),$(t,i,e),$(t,l,e),f(l,s),r||(c=w(n,"click",u),r=!0)},p(t,i){e=t,2&i&&a!==(a=e[8]+"")&&y(o,a),3&i&&b(n,"active",e[8]==e[0]),6&i&&d!==(d=kt(e[2][e[8]].options.timestamp)+"")&&y(s,d),3&i&&b(l,"active",e[8]==e[0])},d(t){t&&m(n),t&&m(i),t&&m(l),r=!1,c()}}}function xt(e){let n,o=[],i=new Map,l=e[1];const s=t=>t[8];for(let t=0;t<l.length;t+=1){let n=yt(e,l,t),r=s(n);i.set(r,o[t]=bt(r,n))}return{c(){n=g("div");for(let t=0;t<o.length;t+=1)o[t].c();k(n,"class","grid svelte-bq6hwe")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){15&e&&(l=t[1],o=R(o,e,s,1,t,l,i,n,J,bt,null,yt))},i:t,o:t,d(t){t&&m(n);for(let t=0;t<o.length;t+=1)o[t].d()}}}function Dt(t,e,n){let o;s(t,lt,(t=>n(2,o=t)));const i=E();let{portalID:l=null}=e,{activeID:r=!1}=e,{fieldID:c=null}=e,a=[];function d(t){i("select",{type:"link",guid:t})}return t.$$set=t=>{"portalID"in t&&n(4,l=t.portalID),"activeID"in t&&n(0,r=t.activeID),"fieldID"in t&&n(5,c=t.fieldID)},t.$$.update=()=>{52&t.$$.dirty&&n(1,a=Object.keys(o).filter((t=>(!l||vt(l,t))&&(!c||wt(t,c))))),54&t.$$.dirty&&(n(1,a=Object.keys(o).filter((t=>(!l||vt(l,t))&&(!c||wt(t,c))))),a.sort(((t,e)=>o[e].options.timestamp-o[t].options.timestamp)))},[r,a,o,d,l,c,t=>d(t)]}registerCSS(".grid.svelte-bq6hwe.svelte-bq6hwe{display:grid;grid-template-columns:auto max-content;grid-gap:4px;font-family:monospace}.grid.svelte-bq6hwe div.svelte-bq6hwe{white-space:nowrap;max-width:30em}.date.svelte-bq6hwe.svelte-bq6hwe{margin-left:auto}.active.svelte-bq6hwe.svelte-bq6hwe{color:green}");class It extends W{constructor(t){super(),V(this,t,Dt,xt,l,{portalID:4,activeID:0,fieldID:5})}}function Et(t,e,n){const o=t.slice();return o[8]=e[n],o}function Ct(t,e){let n,o,i,l,s,r,c,a=e[8]+"",d=kt(e[2][e[8]].options.timestamp)+"";function u(){return e[6](e[8])}return{key:t,first:null,c(){n=g("div"),o=h(a),i=v(),l=g("div"),s=h(d),k(n,"class","svelte-bq6hwe"),b(n,"active",e[8]==e[0]),k(l,"class","date svelte-bq6hwe"),b(l,"active",e[8]==e[0]),this.first=n},m(t,e){$(t,n,e),f(n,o),$(t,i,e),$(t,l,e),f(l,s),r||(c=w(n,"click",u),r=!0)},p(t,i){e=t,2&i&&a!==(a=e[8]+"")&&y(o,a),3&i&&b(n,"active",e[8]==e[0]),6&i&&d!==(d=kt(e[2][e[8]].options.timestamp)+"")&&y(s,d),3&i&&b(l,"active",e[8]==e[0])},d(t){t&&m(n),t&&m(i),t&&m(l),r=!1,c()}}}function St(e){let n,o=[],i=new Map,l=e[1];const s=t=>t[8];for(let t=0;t<l.length;t+=1){let n=Et(e,l,t),r=s(n);i.set(r,o[t]=Ct(r,n))}return{c(){n=g("div");for(let t=0;t<o.length;t+=1)o[t].c();k(n,"class","grid svelte-bq6hwe")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){15&e&&(l=t[1],o=R(o,e,s,1,t,l,i,n,J,Ct,null,Et))},i:t,o:t,d(t){t&&m(n);for(let t=0;t<o.length;t+=1)o[t].d()}}}function qt(t,e,n){let o;s(t,st,(t=>n(2,o=t)));const i=E();let{portalID:l=null}=e,{linkID:r=null}=e,{activeID:c=!1}=e,a=[];function d(t){i("select",{type:"field",guid:t})}return t.$$set=t=>{"portalID"in t&&n(4,l=t.portalID),"linkID"in t&&n(5,r=t.linkID),"activeID"in t&&n(0,c=t.activeID)},t.$$.update=()=>{54&t.$$.dirty&&(n(1,a=Object.keys(o).filter((t=>(!l||ht(l,t))&&(!r||wt(r,t))))),a.sort(((t,e)=>o[e].options.timestamp-o[t].options.timestamp)))},[c,a,o,d,l,r,t=>d(t)]}registerCSS(".grid.svelte-bq6hwe.svelte-bq6hwe{display:grid;grid-template-columns:auto max-content;grid-gap:4px;font-family:monospace}.grid.svelte-bq6hwe div.svelte-bq6hwe{white-space:nowrap;max-width:30em}.date.svelte-bq6hwe.svelte-bq6hwe{margin-left:auto}.active.svelte-bq6hwe.svelte-bq6hwe{color:green}");class Ot extends W{constructor(t){super(),V(this,t,qt,St,l,{portalID:4,linkID:5,activeID:0})}}function _t(t){let e,n,o,i,l,s,r,c,a,d,u,p,f,h;return o=new gt({props:{properties:Object.keys(t[3]),$$slots:{value:[Mt,({key:t})=>({8:t}),({key:t})=>t?256:0],key:[Lt,({key:t})=>({8:t}),({key:t})=>t?256:0]},$$scope:{ctx:t}}}),r=new It({props:{portalID:t[0]}}),r.$on("select",t[6]),u=new Ot({props:{portalID:t[0]}}),u.$on("select",t[7]),{c(){e=g("h3"),e.textContent="Portal ↻",n=v(),Y(o.$$.fragment),i=v(),l=g("h3"),l.textContent="Links",s=v(),Y(r.$$.fragment),c=v(),a=g("h3"),a.textContent="Fields",d=v(),Y(u.$$.fragment),k(e,"class","svelte-1ewhsux"),k(l,"class","svelte-1ewhsux"),k(a,"class","svelte-1ewhsux")},m(m,g){$(m,e,g),$(m,n,g),Z(o,m,g),$(m,i,g),$(m,l,g),$(m,s,g),Z(r,m,g),$(m,c,g),$(m,a,g),$(m,d,g),Z(u,m,g),p=!0,f||(h=w(e,"click",t[5]),f=!0)},p(t,e){const n={};8&e&&(n.properties=Object.keys(t[3])),780&e&&(n.$$scope={dirty:e,ctx:t}),o.$set(n);const i={};1&e&&(i.portalID=t[0]),r.$set(i);const l={};1&e&&(l.portalID=t[0]),u.$set(l)},i(t){p||(H(o.$$.fragment,t),H(r.$$.fragment,t),H(u.$$.fragment,t),p=!0)},o(t){B(o.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),p=!1},d(t){t&&m(e),t&&m(n),K(o,t),t&&m(i),t&&m(l),t&&m(s),K(r,t),t&&m(c),t&&m(a),t&&m(d),K(u,t),f=!1,h()}}}function Lt(t){let e,n,o=t[8]+"";return{c(){e=g("div"),n=h(o),k(e,"slot","key")},m(t,o){$(t,e,o),f(e,n)},p(t,e){256&e&&o!==(o=t[8]+"")&&y(n,o)},d(t){t&&m(e)}}}function jt(t){let e,n=t[3][t[8]]+"";return{c(){e=h(n)},m(t,n){$(t,e,n)},p(t,o){264&o&&n!==(n=t[3][t[8]]+"")&&y(e,n)},d(t){t&&m(e)}}}function Gt(t){let e,n,o,i=t[3][t[8]]+"";return{c(){e=g("a"),n=h(i),k(e,"href",o=t[3][t[8]])},m(t,o){$(t,e,o),f(e,n)},p(t,l){264&l&&i!==(i=t[3][t[8]]+"")&&y(n,i),264&l&&o!==(o=t[3][t[8]])&&k(e,"href",o)},d(t){t&&m(e)}}}function Mt(t){let e,n;function o(t,e){return"image"==t[8]?Gt:jt}let i=o(t),l=i(t);return{c(){e=g("div"),l.c(),k(e,"slot","value"),k(e,"title",n=t[2][t[8]]||t[3][t[8]])},m(t,n){$(t,e,n),l.m(e,null)},p(t,s){i===(i=o(t))&&l?l.p(t,s):(l.d(1),l=i(t),l&&(l.c(),l.m(e,null))),268&s&&n!==(n=t[2][t[8]]||t[3][t[8]])&&k(e,"title",n)},d(t){t&&m(e),l.d()}}}function Pt(t){let e,n,o=t[1]&&_t(t);return{c(){e=g("div"),o&&o.c()},m(t,i){$(t,e,i),o&&o.m(e,null),n=!0},p(t,[n]){t[1]?o?(o.p(t,n),2&n&&H(o,1)):(o=_t(t),o.c(),H(o,1),o.m(e,null)):o&&(U(),B(o,1,1,(()=>{o=null})),z())},i(t){n||(H(o),n=!0)},o(t){B(o),n=!1},d(t){t&&m(e),o&&o.d()}}}function Tt(t,e,n){let o,i,l;s(t,it,(t=>n(4,l=t)));let{guid:r=null}=e,c=null;return t.$$set=t=>{"guid"in t&&n(0,r=t.guid)},t.$$.update=()=>{17&t.$$.dirty&&(r&&l[r]?n(1,c=l[r]):n(1,c=null)),2&t.$$.dirty&&n(3,o=c?{guid:c.options.guid,timestamp:kt(c.options.timestamp),team:c.options.team,latE6:c.options.data.latE6,lngE6:c.options.data.lngE6,level:c.options.level,health:c.options.data.health,resCount:c.options.data.resCount,image:c.options.data.image,title:c.options.data.title,ornaments:c.options.data.ornaments,mission:c.options.data.mission,mission50plus:c.options.data.mission50plus,artifactBrief:JSON.stringify(c.options.data.artifactBrief),mods:JSON.stringify(c.options.data.mods),resonators:JSON.stringify(c.options.data.resonators),owner:c.options.data.owner,artifactDetail:JSON.stringify(c.options.data.artifactDetail),history:c.options.data.history&&c.options.data.history._raw||0}:{}),2&t.$$.dirty&&n(2,i=c?{image:'<img src="'+c.options.data.image+'" style="width: 100px; height=100px"/>'}:{})},[r,c,i,o,l,()=>window.renderPortalDetails(r),function(e){C.call(this,t,e)},function(e){C.call(this,t,e)}]}registerCSS("h3.svelte-1ewhsux:hover{text-decoration:underline;cursor:pointer}");class At extends W{constructor(t){super(),V(this,t,Tt,Pt,l,{guid:0})}}function Ft(t,e,n){const o=t.slice();return o[9]=e[n],o}function Nt(t,e){let n,o,i,l,s,r,c,a,d=(e[2][e[9]].options.data.title||e[9])+"",u=kt(e[2][e[9]].options.timestamp)+"";function p(){return e[7](e[9])}return{key:t,first:null,c(){n=g("div"),o=h(d),l=v(),s=g("div"),r=h(u),k(n,"title",i=e[9]),k(n,"class","svelte-8k4ao0"),b(n,"selected",e[9]==e[3]),b(n,"active",e[9]==e[0]),b(n,"raw",!e[2][e[9]].options.data.title),k(s,"class","raw date svelte-8k4ao0"),b(s,"selected",e[9]==e[3]),b(s,"active",e[9]==e[0]),this.first=n},m(t,e){$(t,n,e),f(n,o),$(t,l,e),$(t,s,e),f(s,r),c||(a=w(n,"click",p),c=!0)},p(t,l){e=t,6&l&&d!==(d=(e[2][e[9]].options.data.title||e[9])+"")&&y(o,d),2&l&&i!==(i=e[9])&&k(n,"title",i),10&l&&b(n,"selected",e[9]==e[3]),3&l&&b(n,"active",e[9]==e[0]),6&l&&b(n,"raw",!e[2][e[9]].options.data.title),6&l&&u!==(u=kt(e[2][e[9]].options.timestamp)+"")&&y(r,u),10&l&&b(s,"selected",e[9]==e[3]),3&l&&b(s,"active",e[9]==e[0])},d(t){t&&m(n),t&&m(l),t&&m(s),c=!1,a()}}}function Ut(e){let n,o=[],i=new Map,l=e[1];const s=t=>t[9];for(let t=0;t<l.length;t+=1){let n=Ft(e,l,t),r=s(n);i.set(r,o[t]=Nt(r,n))}return{c(){n=g("div");for(let t=0;t<o.length;t+=1)o[t].c();k(n,"class","grid svelte-8k4ao0")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){31&e&&(l=t[1],o=R(o,e,s,1,t,l,i,n,J,Nt,null,Ft))},i:t,o:t,d(t){t&&m(n);for(let t=0;t<o.length;t+=1)o[t].d()}}}function zt(t,e,n){let o,i;s(t,it,(t=>n(2,o=t))),s(t,rt,(t=>n(3,i=t)));const l=E();let{activeID:r=!1}=e,{linkID:c=null}=e,{fieldID:a=null}=e,d=[];function u(t){l("select",{type:"portal",guid:t})}return t.$$set=t=>{"activeID"in t&&n(0,r=t.activeID),"linkID"in t&&n(5,c=t.linkID),"fieldID"in t&&n(6,a=t.fieldID)},t.$$.update=()=>{if(102&t.$$.dirty)if(c){const t=window.links[c];n(1,d=t?[t.options.data.oGuid,t.options.data.dGuid]:[])}else if(a){const t=window.fields[a];n(1,d=t?t.options.data.points.map((t=>t.guid)):[])}else n(1,d=Object.keys(o)),d.sort(((t,e)=>o[e].options.timestamp-o[t].options.timestamp))},[r,d,o,i,u,c,a,t=>u(t)]}registerCSS(".grid.svelte-8k4ao0.svelte-8k4ao0{display:grid;grid-template-columns:auto max-content;grid-gap:4px}.grid.svelte-8k4ao0 div.svelte-8k4ao0:nth-child(2n+1){text-overflow:ellipsis;overflow:hidden}.grid.svelte-8k4ao0 div.svelte-8k4ao0{white-space:nowrap;max-width:30em}.grid.svelte-8k4ao0 div.raw.svelte-8k4ao0{font-family:monospace}.date.svelte-8k4ao0.svelte-8k4ao0{margin-left:auto}.selected.svelte-8k4ao0.svelte-8k4ao0{color:red}.active.svelte-8k4ao0.svelte-8k4ao0{color:green}");class Ht extends W{constructor(t){super(),V(this,t,zt,Ut,l,{activeID:0,linkID:5,fieldID:6})}}function Bt(t){let e,n,o,i,l,s,r,c,a,d,u,p;return o=new gt({props:{properties:Object.keys(t[2]),$$slots:{value:[Rt,({key:t})=>({6:t}),({key:t})=>t?64:0],key:[Jt,({key:t})=>({6:t}),({key:t})=>t?64:0]},$$scope:{ctx:t}}}),r=new Ht({props:{linkID:t[0]}}),r.$on("select",t[4]),u=new Ot({props:{linkID:t[0]}}),u.$on("select",t[5]),{c(){e=g("h3"),e.textContent="Link",n=v(),Y(o.$$.fragment),i=v(),l=g("h3"),l.textContent="Portals",s=v(),Y(r.$$.fragment),c=v(),a=g("h3"),a.textContent="Fields",d=v(),Y(u.$$.fragment)},m(t,f){$(t,e,f),$(t,n,f),Z(o,t,f),$(t,i,f),$(t,l,f),$(t,s,f),Z(r,t,f),$(t,c,f),$(t,a,f),$(t,d,f),Z(u,t,f),p=!0},p(t,e){const n={};4&e&&(n.properties=Object.keys(t[2])),196&e&&(n.$$scope={dirty:e,ctx:t}),o.$set(n);const i={};1&e&&(i.linkID=t[0]),r.$set(i);const l={};1&e&&(l.linkID=t[0]),u.$set(l)},i(t){p||(H(o.$$.fragment,t),H(r.$$.fragment,t),H(u.$$.fragment,t),p=!0)},o(t){B(o.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),p=!1},d(t){t&&m(e),t&&m(n),K(o,t),t&&m(i),t&&m(l),t&&m(s),K(r,t),t&&m(c),t&&m(a),t&&m(d),K(u,t)}}}function Jt(t){let e,n,o=t[6]+"";return{c(){e=g("div"),n=h(o),k(e,"slot","key")},m(t,o){$(t,e,o),f(e,n)},p(t,e){64&e&&o!==(o=t[6]+"")&&y(n,o)},d(t){t&&m(e)}}}function Rt(t){let e,n,o,i=t[2][t[6]]+"";return{c(){e=g("div"),n=h(i),k(e,"slot","value"),k(e,"title",o=t[2][t[6]])},m(t,o){$(t,e,o),f(e,n)},p(t,l){68&l&&i!==(i=t[2][t[6]]+"")&&y(n,i),68&l&&o!==(o=t[2][t[6]])&&k(e,"title",o)},d(t){t&&m(e)}}}function Yt(t){let e,n,o=t[1]&&Bt(t);return{c(){e=g("div"),o&&o.c()},m(t,i){$(t,e,i),o&&o.m(e,null),n=!0},p(t,[n]){t[1]?o?(o.p(t,n),2&n&&H(o,1)):(o=Bt(t),o.c(),H(o,1),o.m(e,null)):o&&(U(),B(o,1,1,(()=>{o=null})),z())},i(t){n||(H(o),n=!0)},o(t){B(o),n=!1},d(t){t&&m(e),o&&o.d()}}}function Zt(t,e,n){let o,i;s(t,lt,(t=>n(3,i=t)));let{guid:l=null}=e,r=null;return t.$$set=t=>{"guid"in t&&n(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&i[l]?n(1,r=i[l]):n(1,r=null)),2&t.$$.dirty&&n(2,o=r?{guid:r.options.guid,timestamp:kt(r.options.timestamp),team:r.options.team,oGuid:r.options.data.oGuid,oLatE6:r.options.data.oLatE6,oLngE6:r.options.data.oLngE6,dGuid:r.options.data.dGuid,dLatE6:r.options.data.dLatE6,dLngE6:r.options.data.dLngE6}:{})},[l,r,o,i,function(e){C.call(this,t,e)},function(e){C.call(this,t,e)}]}class Kt extends W{constructor(t){super(),V(this,t,Zt,Yt,l,{guid:0})}}function Qt(t){let e,n,o,i,l,s,r,c,a,d,u,p;return o=new gt({props:{properties:Object.keys(t[2]),$$slots:{value:[Wt,({key:t})=>({6:t}),({key:t})=>t?64:0],key:[Vt,({key:t})=>({6:t}),({key:t})=>t?64:0]},$$scope:{ctx:t}}}),r=new Ht({props:{fieldID:t[0]}}),r.$on("select",t[4]),u=new It({props:{fieldID:t[0]}}),u.$on("select",t[5]),{c(){e=g("h3"),e.textContent="Field",n=v(),Y(o.$$.fragment),i=v(),l=g("h3"),l.textContent="Portals",s=v(),Y(r.$$.fragment),c=v(),a=g("h3"),a.textContent="Links",d=v(),Y(u.$$.fragment)},m(t,f){$(t,e,f),$(t,n,f),Z(o,t,f),$(t,i,f),$(t,l,f),$(t,s,f),Z(r,t,f),$(t,c,f),$(t,a,f),$(t,d,f),Z(u,t,f),p=!0},p(t,e){const n={};4&e&&(n.properties=Object.keys(t[2])),196&e&&(n.$$scope={dirty:e,ctx:t}),o.$set(n);const i={};1&e&&(i.fieldID=t[0]),r.$set(i);const l={};1&e&&(l.fieldID=t[0]),u.$set(l)},i(t){p||(H(o.$$.fragment,t),H(r.$$.fragment,t),H(u.$$.fragment,t),p=!0)},o(t){B(o.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),p=!1},d(t){t&&m(e),t&&m(n),K(o,t),t&&m(i),t&&m(l),t&&m(s),K(r,t),t&&m(c),t&&m(a),t&&m(d),K(u,t)}}}function Vt(t){let e,n,o=t[6]+"";return{c(){e=g("div"),n=h(o),k(e,"slot","key")},m(t,o){$(t,e,o),f(e,n)},p(t,e){64&e&&o!==(o=t[6]+"")&&y(n,o)},d(t){t&&m(e)}}}function Wt(t){let e,n,o,i=t[2][t[6]]+"";return{c(){e=g("div"),n=h(i),k(e,"slot","value"),k(e,"title",o=t[2][t[6]])},m(t,o){$(t,e,o),f(e,n)},p(t,l){68&l&&i!==(i=t[2][t[6]]+"")&&y(n,i),68&l&&o!==(o=t[2][t[6]])&&k(e,"title",o)},d(t){t&&m(e)}}}function Xt(t){let e,n,o=t[1]&&Qt(t);return{c(){e=g("div"),o&&o.c()},m(t,i){$(t,e,i),o&&o.m(e,null),n=!0},p(t,[n]){t[1]?o?(o.p(t,n),2&n&&H(o,1)):(o=Qt(t),o.c(),H(o,1),o.m(e,null)):o&&(U(),B(o,1,1,(()=>{o=null})),z())},i(t){n||(H(o),n=!0)},o(t){B(o),n=!1},d(t){t&&m(e),o&&o.d()}}}function te(t,e,n){let o,i;s(t,st,(t=>n(3,i=t)));let{guid:l=null}=e,r=null;return t.$$set=t=>{"guid"in t&&n(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&i[l]?n(1,r=i[l]):n(1,r=null)),2&t.$$.dirty&&n(2,o=r?{guid:r.options.guid,timestamp:kt(r.options.timestamp),team:r.options.team,"points[0].guid":r.options.data.points[0].guid,"points[0].latE6":r.options.data.points[0].latE6,"points[0].lngE6":r.options.data.points[0].lngE6,"points[1].guid":r.options.data.points[1].guid,"points[1].latE6":r.options.data.points[1].latE6,"points[1].lngE6":r.options.data.points[1].lngE6,"points[2].guid":r.options.data.points[2].guid,"points[2].latE6":r.options.data.points[2].latE6,"points[2].lngE6":r.options.data.points[2].lngE6}:{})},[l,r,o,i,function(e){C.call(this,t,e)},function(e){C.call(this,t,e)}]}class ee extends W{constructor(t){super(),V(this,t,te,Xt,l,{guid:0})}}function ne(t){let e,n,o;return{c(){e=g("li"),e.textContent="Current portal",k(e,"class","svelte-616oef"),b(e,"selected","portal"==t[0]&&t[1]==t[3])},m(i,l){$(i,e,l),n||(o=w(e,"click",t[5]),n=!0)},p(t,n){11&n&&b(e,"selected","portal"==t[0]&&t[1]==t[3])},d(t){t&&m(e),n=!1,o()}}}function oe(t){let e,n;return e=new Ot({props:{activeID:"field"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.activeID="field"==t[0]&&t[1]),e.$set(o)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function ie(t){let e,n;return e=new It({props:{activeID:"link"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.activeID="link"==t[0]&&t[1]),e.$set(o)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function le(t){let e,n;return e=new Ht({props:{activeID:"portal"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.activeID="portal"==t[0]&&t[1]),e.$set(o)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function se(t){let e,n,o,i;const l=[ae,ce,re],s=[];function r(t,e){return"portal"==t[0]?0:"link"==t[0]?1:"field"==t[0]?2:-1}return~(n=r(t))&&(o=s[n]=l[n](t)),{c(){e=g("div"),o&&o.c(),k(e,"class","card svelte-616oef")},m(t,o){$(t,e,o),~n&&s[n].m(e,null),i=!0},p(t,i){let c=n;n=r(t),n===c?~n&&s[n].p(t,i):(o&&(U(),B(s[c],1,1,(()=>{s[c]=null})),z()),~n?(o=s[n],o?o.p(t,i):(o=s[n]=l[n](t),o.c()),H(o,1),o.m(e,null)):o=null)},i(t){i||(H(o),i=!0)},o(t){B(o),i=!1},d(t){t&&m(e),~n&&s[n].d()}}}function re(t){let e,n;return e=new ee({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.guid=t[1]),e.$set(o)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function ce(t){let e,n;return e=new Kt({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.guid=t[1]),e.$set(o)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function ae(t){let e,n;return e=new At({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.guid=t[1]),e.$set(o)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function de(t){let e,n,i,l,s,r,c,a,d,u,p,h,y,x,D,I,E=t[3]&&ne(t);const C=[le,ie,oe],S=[];function q(t,e){return"portals"==t[2]?0:"links"==t[2]?1:"fields"==t[2]?2:-1}~(p=q(t))&&(h=S[p]=C[p](t));let O=t[0]&&se(t);return{c(){e=g("div"),n=g("div"),i=g("ul"),l=g("li"),l.textContent="Portals",s=v(),r=g("li"),r.textContent="Links",c=v(),a=g("li"),a.textContent="Fields",d=v(),E&&E.c(),u=v(),h&&h.c(),y=v(),O&&O.c(),k(l,"class","svelte-616oef"),b(l,"active","portals"==t[2]),k(r,"class","svelte-616oef"),b(r,"active","links"==t[2]),k(a,"class","svelte-616oef"),b(a,"active","fields"==t[2]),k(i,"class","tablist svelte-616oef"),k(n,"class","list svelte-616oef"),k(e,"class","content svelte-616oef")},m(o,m){$(o,e,m),f(e,n),f(n,i),f(i,l),f(i,s),f(i,r),f(i,c),f(i,a),f(i,d),E&&E.m(i,null),f(n,u),~p&&S[p].m(n,null),f(e,y),O&&O.m(e,null),x=!0,D||(I=[w(l,"click",t[6]),w(r,"click",t[7]),w(a,"click",t[8])],D=!0)},p(t,o){4&o&&b(l,"active","portals"==t[2]),4&o&&b(r,"active","links"==t[2]),4&o&&b(a,"active","fields"==t[2]),t[3]?E?E.p(t,o):(E=ne(t),E.c(),E.m(i,null)):E&&(E.d(1),E=null);let s=p;p=q(t),p===s?~p&&S[p].p(t,o):(h&&(U(),B(S[s],1,1,(()=>{S[s]=null})),z()),~p?(h=S[p],h?h.p(t,o):(h=S[p]=C[p](t),h.c()),H(h,1),h.m(n,null)):h=null),t[0]?O?(O.p(t,o),1&o&&H(O,1)):(O=se(t),O.c(),H(O,1),O.m(e,null)):O&&(U(),B(O,1,1,(()=>{O=null})),z())},i(t){x||(H(h),H(O),x=!0)},o(t){B(h),B(O),x=!1},d(t){t&&m(e),E&&E.d(),~p&&S[p].d(),O&&O.d(),D=!1,o(I)}}}function ue(t){let e,n;return e=new et({props:{options:{title:"Data Explorer",resizable:!0,width:"auto"},$$slots:{default:[de]},$$scope:{ctx:t}}}),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,[n]){const o={};1039&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function pe(t,e,n){let o;s(t,rt,(t=>n(3,o=t)));let i=null,l=null;let r="portals";return[i,l,r,o,function(t){if(function(){let t,e;switch(i){case"portal":break;case"link":t=window.links[l],t&&t.setStyle({color:COLORS[t.options.team]});break;case"field":e=window.fields[l],e&&e.setStyle({fillColor:COLORS[e.options.team]})}}(),t.detail)switch(n(0,i=t.detail.type),n(1,l=t.detail.guid),i){case"portal":window.selectPortal(l);break;case"link":const t=window.links[l];t&&t.setStyle({color:"red"});break;case"field":const e=window.fields[l];e&&(e.setStyle({fillColor:"red"}),e.bringToFront())}else n(1,l=null),n(0,i=null)},function(){window.selectedPortal&&(n(0,i="portal"),n(1,l=window.selectedPortal))},()=>n(2,r="portals"),()=>n(2,r="links"),()=>n(2,r="fields")]}registerCSS('.content.svelte-616oef.svelte-616oef{display:grid;grid-gap:24px;grid-auto-flow:column}.tablist.svelte-616oef.svelte-616oef{padding-left:1em}.tablist.svelte-616oef li.svelte-616oef{display:inline-block}.tablist.svelte-616oef li.active.svelte-616oef{font-weight:bold}.tablist.svelte-616oef li.selected.svelte-616oef{color:red;font-weight:bold\n\t}.tablist.svelte-616oef li.svelte-616oef:nth-child(n+2)::before{content:"| "}.content.svelte-616oef>div.svelte-616oef{background-color:#0003;border-radius:10px;padding:0.5em}.content.svelte-616oef .grid{padding:.5em;border:1px solid #69a;background-color:#0001;box-sizing:border-box}@media(max-width: 700px){.content.svelte-616oef>div.svelte-616oef{box-sizing:border-box;width:calc(100vw - 24px)}}');class fe extends W{constructor(t){super(),V(this,t,pe,ue,l,{})}}function $e(e){let n,o,i;return{c(){n=g("a"),n.textContent="DataExplorer"},m(t,l){$(t,n,l),o||(i=w(n,"click",e[0]),o=!0)},p:t,i:t,o:t,d(t){t&&m(n),o=!1,i()}}}function me(t,e,n){let o,i,l,r;return s(t,rt,(t=>n(1,o=t))),s(t,st,(t=>n(2,i=t))),s(t,lt,(t=>n(3,l=t))),s(t,it,(t=>n(4,r=t))),p(it,r=window.portals,r),p(lt,l=window.links,l),p(st,i=window.fields,i),p(rt,o=window.selectedPortal,o),window.addHook("mapDataRefreshEnd",(()=>{p(it,r=window.portals,r),p(lt,l=window.links,l),p(st,i=window.fields,i)})),window.addHook("portalAdded",(t=>{p(it,r[t.portal.options.guid]=t.portal,r)})),window.addHook("linkAdded",(t=>{p(lt,l[t.link.options.guid]=t.link,l)})),window.addHook("fieldAdded",(t=>{p(st,i[t.field.options.guid]=t.field,i)})),window.addHook("portalSelected",(t=>{p(rt,o=t.selectedPortalGuid,o)})),[function(){new fe({target:document.body})}]}class ge extends W{constructor(t){super(),V(this,t,me,$e,l,{})}}const he="dataExplorer";class ve{init(){const t=document.querySelector("#toolbox");new ge({target:t})}}return()=>{window.plugin[he]=new ve,window.plugin[he].init(),addCSSs()}}();
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
} // wrapper end
// inject code into site context
var script = document.createElement('script');
var info = {};
if (typeof GM_info !== 'undefined' && GM_info && GM_info.script) info.script = { version: GM_info.script.version, name: GM_info.script.name, description: GM_info.script.description };
script.appendChild(document.createTextNode('('+ wrapper +')('+JSON.stringify(info)+');'));
(document.body || document.head || document.documentElement).appendChild(script);
