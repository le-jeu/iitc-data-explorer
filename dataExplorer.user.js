// ==UserScript==
// @name        IITC plugin: Data Explorer
// @description UI to explore intel available data
// @namespace   https://github.com/le-jeu
// @version     0.1.7
// @match       https://intel.ingress.com/*
// @author      jaiperdu
// @updateURL   https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @downloadURL https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @grant       none
// ==/UserScript==

function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};

var cssList = [];
function registerCSS(css) {
	cssList.push(css);
}

function addCSS(css) {
	var s = document.createElement('style');
	s.textContent = css;
	document.head.appendChild(s);
}

function addCSSs(css) {
	cssList.forEach(addCSS);
}
var setup=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function r(t,e,n,o){if(t){const i=a(t,e,n,o);return t[0](i)}}function a(t,e,n,o){return t[1]&&o?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](o(e))):n.ctx}function c(t,e,n,o){if(t[2]&&o){const i=t[2](o(n));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],n=Math.max(e.dirty.length,i.length);for(let o=0;o<n;o+=1)t[o]=e.dirty[o]|i[o];return t}return e.dirty|i}return e.dirty}function d(t,e,n,o,i,l){if(i){const s=a(e,n,o,l);t.p(s,i)}}function u(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function p(t,e,n){return t.set(n),e}function f(t,e){t.appendChild(e)}function $(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function g(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function h(){return v(" ")}function w(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function k(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function x(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function y(t,e,n){t.classList[n?"add":"remove"](e)}let D;function I(t){D=t}function b(){if(!D)throw new Error("Function called outside component initialization");return D}function E(t){b().$$.on_destroy.push(t)}function S(){const t=b();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const i=function(t,e,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,!1,e),o}(e,n);o.slice().forEach((e=>{e.call(t,i)}))}}}function C(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const _=[],L=[],T=[],z=[],q=Promise.resolve();let P=!1;function R(t){T.push(t)}let M=!1;const A=new Set;function G(){if(!M){M=!0;do{for(let t=0;t<_.length;t+=1){const e=_[t];I(e),O(e.$$)}for(I(null),_.length=0;L.length;)L.pop()();for(let t=0;t<T.length;t+=1){const e=T[t];A.has(e)||(A.add(e),e())}T.length=0}while(_.length);for(;z.length;)z.pop()();P=!1,M=!1,A.clear()}}function O(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(R)}}const j=new Set;let F;function H(){F={r:0,c:[],p:F}}function N(){F.r||o(F.c),F=F.p}function U(t,e){t&&t.i&&(j.delete(t),t.i(e))}function B(t,e,n,o){if(t&&t.o){if(j.has(t))return;j.add(t),F.c.push((()=>{j.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function J(t,e){t.d(1),e.delete(t.key)}function Q(t,e,n,o,i,l,s,r,a,c,d,u){let p=t.length,f=l.length,$=p;const m={};for(;$--;)m[t[$].key]=$;const g=[],v=new Map,h=new Map;for($=f;$--;){const t=u(i,l,$),r=n(t);let a=s.get(r);a?o&&a.p(t,e):(a=c(r,t),a.c()),v.set(r,g[$]=a),r in m&&h.set(r,Math.abs($-m[r]))}const w=new Set,k=new Set;function x(t){U(t,1),t.m(r,d),s.set(t.key,t),d=t.first,f--}for(;p&&f;){const e=g[f-1],n=t[p-1],o=e.key,i=n.key;e===n?(d=e.first,p--,f--):v.has(i)?!s.has(o)||w.has(o)?x(e):k.has(i)?p--:h.get(o)>h.get(i)?(k.add(o),x(e)):(w.add(i),p--):(a(n,s),p--)}for(;p--;){const e=t[p];v.has(e.key)||a(e,s)}for(;f;)x(g[f-1]);return g}function Y(t){t&&t.c()}function Z(t,n,l,s){const{fragment:r,on_mount:a,on_destroy:c,after_update:d}=t.$$;r&&r.m(n,l),s||R((()=>{const n=a.map(e).filter(i);c?c.push(...n):o(n),t.$$.on_mount=[]})),d.forEach(R)}function K(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function V(t,e){-1===t.$$.dirty[0]&&(_.push(t),P||(P=!0,q.then(G)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function W(e,i,l,s,r,a,c,d=[-1]){const u=D;I(e);const p=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:r,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(u?u.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:i.target||u.$$.root};c&&c(p.root);let f=!1;if(p.ctx=l?l(e,i.props||{},((t,n,...o)=>{const i=o.length?o[0]:n;return p.ctx&&r(p.ctx[t],p.ctx[t]=i)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](i),f&&V(e,t)),n})):[],p.update(),f=!0,o(p.before_update),p.fragment=!!s&&s(p.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();i.intro&&U(e.$$.fragment),Z(e,i.target,i.anchor,i.customElement),G()}I(u)}class X{$destroy(){K(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const tt=window.L;function et(t){let e,n;const o=t[3].default,i=r(o,t,t[2],null);return{c(){e=g("div"),i&&i.c()},m(o,l){$(o,e,l),i&&i.m(e,null),t[4](e),n=!0},p(t,[e]){i&&i.p&&(!n||4&e)&&d(i,o,t,t[2],n?c(o,t[2],e,null):u(t[2]),null)},i(t){n||(U(i,t),n=!0)},o(t){B(i,t),n=!1},d(n){n&&m(e),i&&i.d(n),t[4](null)}}}function nt(t,e,n){let o,{$$slots:i={},$$scope:l}=e,{options:s={}}=e,r=S();var a;return a=()=>{const t=s.closeCallback;dialog(Object.assign(s,{html:o,closeCallback:()=>{t&&t(),r("close")}}))},b().$$.on_mount.push(a),t.$$set=t=>{"options"in t&&n(1,s=t.options),"$$scope"in t&&n(2,l=t.$$scope)},[o,s,l,i,function(t){L[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}class ot extends X{constructor(t){super(),W(this,t,nt,et,l,{options:1})}}const it=[];function lt(e,n=t){let o;const i=new Set;function s(t){if(l(e,t)&&(e=t,o)){const t=!it.length;for(const t of i)t[1](),it.push(t,e);if(t){for(let t=0;t<it.length;t+=2)it[t][0](it[t+1]);it.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(l,r=t){const a=[l,r];return i.add(a),1===i.size&&(o=n(s)||t),l(e),()=>{i.delete(a),0===i.size&&(o(),o=null)}}}}const st=lt({}),rt=lt({}),at=lt({}),ct=lt({}),dt=lt(null);function ut(t,e,n){const o=t.slice();return o[3]=e[n][0],o[4]=e[n][1],o}registerCSS(".grid.svelte-nryyad{display:grid;grid-template-columns:max-content auto;grid-gap:4px;font-family:monospace}.grid.svelte-nryyad>div{overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:30em}");const pt=t=>({key:1&t}),ft=t=>({key:t[3]}),$t=t=>({key:1&t}),mt=t=>({key:t[3]});function gt(t){let e,n;const o=t[2].key,i=r(o,t,t[1],mt),l=i||function(t){let e,n,o=t[3]+"";return{c(){e=g("div"),n=v(o)},m(t,o){$(t,e,o),f(e,n)},p(t,e){1&e&&o!==(o=t[3]+"")&&x(n,o)},d(t){t&&m(e)}}}(t),s=t[2].value,a=r(s,t,t[1],ft),p=a||function(t){let e,n,o,i,l=t[4]+"";return{c(){e=g("div"),n=v(l),i=h(),k(e,"title",o=t[4])},m(t,o){$(t,e,o),f(e,n),$(t,i,o)},p(t,i){1&i&&l!==(l=t[4]+"")&&x(n,l),1&i&&o!==(o=t[4])&&k(e,"title",o)},d(t){t&&m(e),t&&m(i)}}}(t);return{c(){l&&l.c(),e=h(),p&&p.c()},m(t,o){l&&l.m(t,o),$(t,e,o),p&&p.m(t,o),n=!0},p(t,e){i?i.p&&(!n||3&e)&&d(i,o,t,t[1],n?c(o,t[1],e,$t):u(t[1]),mt):l&&l.p&&(!n||1&e)&&l.p(t,n?e:-1),a?a.p&&(!n||3&e)&&d(a,s,t,t[1],n?c(s,t[1],e,pt):u(t[1]),ft):p&&p.p&&(!n||1&e)&&p.p(t,n?e:-1)},i(t){n||(U(l,t),U(p,t),n=!0)},o(t){B(l,t),B(p,t),n=!1},d(t){l&&l.d(t),t&&m(e),p&&p.d(t)}}}function vt(t){let e,n,o=Object.entries(t[0]),i=[];for(let e=0;e<o.length;e+=1)i[e]=gt(ut(t,o,e));const l=t=>B(i[t],1,1,(()=>{i[t]=null}));return{c(){e=g("div");for(let t=0;t<i.length;t+=1)i[t].c();k(e,"class","grid svelte-nryyad")},m(t,o){$(t,e,o);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n=!0},p(t,[n]){if(3&n){let s;for(o=Object.entries(t[0]),s=0;s<o.length;s+=1){const l=ut(t,o,s);i[s]?(i[s].p(l,n),U(i[s],1)):(i[s]=gt(l),i[s].c(),U(i[s],1),i[s].m(e,null))}for(H(),s=o.length;s<i.length;s+=1)l(s);N()}},i(t){if(!n){for(let t=0;t<o.length;t+=1)U(i[t]);n=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)B(i[t]);n=!1},d(t){t&&m(e),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(i,t)}}}function ht(t,e,n){let{$$slots:o={},$$scope:i}=e,{properties:l={}}=e;return t.$$set=t=>{"properties"in t&&n(0,l=t.properties),"$$scope"in t&&n(1,i=t.$$scope)},[l,i,o]}class wt extends X{constructor(t){super(),W(this,t,ht,vt,l,{properties:0})}}function kt(t,e){return!!window.fields[e]&&window.fields[e].options.data.points.some((e=>e.guid==t))}function xt(t,e){const n=window.links[t];return!!n&&(kt(n.options.data.oGuid,e)&&kt(n.options.data.dGuid,e))}function yt(t){const e=new Date(t),n=e.getUTCFullYear()+"",o=e.getUTCMonth()+1+"",i=e.getUTCDate()+"",l=e.getUTCHours()+"",s=e.getUTCMinutes()+"",r=e.getUTCSeconds()+"",a=e.getUTCMilliseconds()+"";return`${n}-${o.padStart(2,"0")}-${i.padStart(2,"0")}T${l.padStart(2,"0")}:${s.padStart(2,"0")}:${r.padStart(2,"0")}.${a.padStart(3,"0")}Z`}function Dt(t){const[e,n,o,i,l,s]=t.split("_");return{zoom:+e,x:+n,y:+o,minlvl:+i,maxlvl:+l,maxhealth:+s}}function It(t,e,n){const o=t.slice();return o[10]=e[n],o}function bt(t,e){let n,o,i,l,s,r,a,c,d=e[10]+"",u=yt(e[2][e[10]].options.timestamp)+"";function p(){return e[8](e[10])}return{key:t,first:null,c(){n=g("div"),o=v(d),i=h(),l=g("div"),s=v(u),r=h(),k(n,"class","raw svelte-okcb76"),y(n,"active",e[10]==e[0]),k(l,"class","raw date svelte-okcb76"),y(l,"active",e[10]==e[0]),this.first=n},m(t,e){$(t,n,e),f(n,o),$(t,i,e),$(t,l,e),f(l,s),f(l,r),a||(c=w(n,"click",p),a=!0)},p(t,i){e=t,2&i&&d!==(d=e[10]+"")&&x(o,d),3&i&&y(n,"active",e[10]==e[0]),6&i&&u!==(u=yt(e[2][e[10]].options.timestamp)+"")&&x(s,u),3&i&&y(l,"active",e[10]==e[0])},d(t){t&&m(n),t&&m(i),t&&m(l),a=!1,c()}}}function Et(e){let n,o=[],i=new Map,l=e[1];const s=t=>t[10];for(let t=0;t<l.length;t+=1){let n=It(e,l,t),r=s(n);i.set(r,o[t]=bt(r,n))}return{c(){n=g("div");for(let t=0;t<o.length;t+=1)o[t].c();k(n,"class","grid svelte-okcb76")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){15&e&&(l=t[1],o=Q(o,e,s,1,t,l,i,n,J,bt,null,It))},i:t,o:t,d(t){t&&m(n);for(let t=0;t<o.length;t+=1)o[t].d()}}}function St(t,e,n){let o,i;s(t,rt,(t=>n(2,o=t))),s(t,ct,(t=>n(7,i=t)));const l=S();let{portalID:r=null}=e,{activeID:a=!1}=e,{fieldID:c=null}=e,{tileID:d=null}=e,u=[];function p(t){l("select",{type:"link",guid:t})}return t.$$set=t=>{"portalID"in t&&n(4,r=t.portalID),"activeID"in t&&n(0,a=t.activeID),"fieldID"in t&&n(5,c=t.fieldID),"tileID"in t&&n(6,d=t.tileID)},t.$$.update=()=>{if(246&t.$$.dirty){if(d){const t=i[d];n(1,u=t?t.entities.filter((t=>"e"==t[0])).map((t=>t[1])):[]),n(1,u=u.filter((t=>o[t])))}else n(1,u=Object.keys(o).filter((t=>{return(!r||(e=r,n=t,!!window.links[n]&&(window.links[n].options.data.oGuid==e||window.links[n].options.data.dGuid==e)))&&(!c||xt(t,c));var e,n})));u.sort(((t,e)=>o[e].options.timestamp-o[t].options.timestamp))}},[a,u,o,p,r,c,d,i,t=>p(t)]}registerCSS(".grid.svelte-okcb76.svelte-okcb76{display:grid;grid-template-columns:auto max-content;grid-gap:4px;font-family:monospace}.grid.svelte-okcb76 div.svelte-okcb76{white-space:nowrap;max-width:30em}.date.svelte-okcb76.svelte-okcb76{margin-left:auto}.active.svelte-okcb76.svelte-okcb76{color:green}");class Ct extends X{constructor(t){super(),W(this,t,St,Et,l,{portalID:4,activeID:0,fieldID:5,tileID:6})}}function _t(t,e,n){const o=t.slice();return o[10]=e[n],o}function Lt(t,e){let n,o,i,l,s,r,a,c,d=e[10]+"",u=yt(e[2][e[10]].options.timestamp)+"";function p(){return e[8](e[10])}return{key:t,first:null,c(){n=g("div"),o=v(d),i=h(),l=g("div"),s=v(u),r=h(),k(n,"class","svelte-okcb76"),y(n,"active",e[10]==e[0]),k(l,"class","date svelte-okcb76"),y(l,"active",e[10]==e[0]),this.first=n},m(t,e){$(t,n,e),f(n,o),$(t,i,e),$(t,l,e),f(l,s),f(l,r),a||(c=w(n,"click",p),a=!0)},p(t,i){e=t,2&i&&d!==(d=e[10]+"")&&x(o,d),3&i&&y(n,"active",e[10]==e[0]),6&i&&u!==(u=yt(e[2][e[10]].options.timestamp)+"")&&x(s,u),3&i&&y(l,"active",e[10]==e[0])},d(t){t&&m(n),t&&m(i),t&&m(l),a=!1,c()}}}function Tt(e){let n,o=[],i=new Map,l=e[1];const s=t=>t[10];for(let t=0;t<l.length;t+=1){let n=_t(e,l,t),r=s(n);i.set(r,o[t]=Lt(r,n))}return{c(){n=g("div");for(let t=0;t<o.length;t+=1)o[t].c();k(n,"class","grid svelte-okcb76")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){15&e&&(l=t[1],o=Q(o,e,s,1,t,l,i,n,J,Lt,null,_t))},i:t,o:t,d(t){t&&m(n);for(let t=0;t<o.length;t+=1)o[t].d()}}}function zt(t,e,n){let o,i;s(t,at,(t=>n(2,o=t))),s(t,ct,(t=>n(7,i=t)));const l=S();let{portalID:r=null}=e,{linkID:a=null}=e,{activeID:c=!1}=e,{tileID:d=null}=e,u=[];function p(t){l("select",{type:"field",guid:t})}return t.$$set=t=>{"portalID"in t&&n(4,r=t.portalID),"linkID"in t&&n(5,a=t.linkID),"activeID"in t&&n(0,c=t.activeID),"tileID"in t&&n(6,d=t.tileID)},t.$$.update=()=>{if(246&t.$$.dirty){if(d){const t=i[d];n(1,u=t?t.entities.filter((t=>"r"==t[0])).map((t=>t[1])):[]),n(1,u=u.filter((t=>o[t])))}else n(1,u=Object.keys(o).filter((t=>(!r||kt(r,t))&&(!a||xt(a,t)))));u.sort(((t,e)=>o[e].options.timestamp-o[t].options.timestamp))}},[c,u,o,p,r,a,d,i,t=>p(t)]}registerCSS(".grid.svelte-okcb76.svelte-okcb76{display:grid;grid-template-columns:auto max-content;grid-gap:4px;font-family:monospace}.grid.svelte-okcb76 div.svelte-okcb76{white-space:nowrap;max-width:30em}.date.svelte-okcb76.svelte-okcb76{margin-left:auto}.active.svelte-okcb76.svelte-okcb76{color:green}");class qt extends X{constructor(t){super(),W(this,t,zt,Tt,l,{portalID:4,linkID:5,activeID:0,tileID:6})}}function Pt(t,e,n){const o=t.slice();return o[10]=e[n],o}function Rt(t,e){let n,o,i,l,s,r,a,c,d=e[10]+"",u=yt(e[2][e[10]].time)+"";function p(){return e[7](e[10])}return{key:t,first:null,c(){n=g("div"),o=v(d),i=h(),l=g("div"),s=v(u),r=h(),k(n,"class","svelte-okcb76"),y(n,"active",e[10]==e[0]),k(l,"class","date svelte-okcb76"),y(l,"active",e[10]==e[0]),this.first=n},m(t,e){$(t,n,e),f(n,o),$(t,i,e),$(t,l,e),f(l,s),f(l,r),a||(c=w(n,"click",p),a=!0)},p(t,i){e=t,2&i&&d!==(d=e[10]+"")&&x(o,d),3&i&&y(n,"active",e[10]==e[0]),6&i&&u!==(u=yt(e[2][e[10]].time)+"")&&x(s,u),3&i&&y(l,"active",e[10]==e[0])},d(t){t&&m(n),t&&m(i),t&&m(l),a=!1,c()}}}function Mt(e){let n,o=[],i=new Map,l=e[1];const s=t=>t[10];for(let t=0;t<l.length;t+=1){let n=Pt(e,l,t),r=s(n);i.set(r,o[t]=Rt(r,n))}return{c(){n=g("div");for(let t=0;t<o.length;t+=1)o[t].c();k(n,"class","grid svelte-okcb76")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){15&e&&(l=t[1],o=Q(o,e,s,1,t,l,i,n,J,Rt,null,Pt))},i:t,o:t,d(t){t&&m(n);for(let t=0;t<o.length;t+=1)o[t].d()}}}function At(t,e,n){let o;s(t,ct,(t=>n(2,o=t)));const i=S();let{portalID:l=null}=e,{linkID:r=null}=e,{fieldID:a=null}=e,{activeID:c=!1}=e,d=[],u=tt.layerGroup().addTo(window.map);function p(t){i("select",{type:"tile",guid:t})}E((()=>{u.remove()}));return t.$$set=t=>{"portalID"in t&&n(4,l=t.portalID),"linkID"in t&&n(5,r=t.linkID),"fieldID"in t&&n(6,a=t.fieldID),"activeID"in t&&n(0,c=t.activeID)},t.$$.update=()=>{if(118&t.$$.dirty&&(n(1,d=Object.keys(o).filter((t=>(!l||o[t].entities.some((t=>t[1]==l)))&&(!r||o[t].entities.some((t=>t[1]==r)))&&(!a||o[t].entities.some((t=>t[1]==a)))))),d.sort(((t,e)=>o[e].time-o[t].time))),114&t.$$.dirty&&(u.clearLayers(),l||r||a)){const t=window.TILE_PARAMS.TILES_PER_EDGE[window.TILE_PARAMS.TILES_PER_EDGE.length-1];for(const e of d){const n=Dt(e),o={tilesPerEdge:window.TILE_PARAMS.TILES_PER_EDGE[n.zoom]||t},i=tileToLat(n.y,o),l=tileToLat(n.y+1,o),s=tileToLng(n.x,o),r=tileToLng(n.x+1,o);tt.rectangle([[l,s],[i,r]],{color:"purple",interactive:!1}).addTo(u)}}},[c,d,o,p,l,r,a,t=>p(t)]}registerCSS(".grid.svelte-okcb76.svelte-okcb76{display:grid;grid-template-columns:auto max-content;grid-gap:4px;font-family:monospace}.grid.svelte-okcb76 div.svelte-okcb76{white-space:nowrap;max-width:30em}.date.svelte-okcb76.svelte-okcb76{margin-left:auto}.active.svelte-okcb76.svelte-okcb76{color:green}");class Gt extends X{constructor(t){super(),W(this,t,At,Mt,l,{portalID:4,linkID:5,fieldID:6,activeID:0})}}function Ot(t){let e,n,o,i,l,s,r,a,c,d,u,p,f,v,x,y,D,I;return o=new wt({props:{properties:t[3],$$slots:{value:[Ht,({key:t})=>({9:t}),({key:t})=>t?512:0]},$$scope:{ctx:t}}}),r=new Ct({props:{portalID:t[0]}}),r.$on("select",t[6]),u=new qt({props:{portalID:t[0]}}),u.$on("select",t[7]),x=new Gt({props:{portalID:t[0]}}),x.$on("select",t[8]),{c(){e=g("h3"),e.textContent="Portal ↻",n=h(),Y(o.$$.fragment),i=h(),l=g("h3"),l.textContent="Links",s=h(),Y(r.$$.fragment),a=h(),c=g("h3"),c.textContent="Fields",d=h(),Y(u.$$.fragment),p=h(),f=g("h3"),f.textContent="Tiles",v=h(),Y(x.$$.fragment),k(e,"class","svelte-176lmyd"),k(l,"class","svelte-176lmyd"),k(c,"class","svelte-176lmyd"),k(f,"class","svelte-176lmyd")},m(m,g){$(m,e,g),$(m,n,g),Z(o,m,g),$(m,i,g),$(m,l,g),$(m,s,g),Z(r,m,g),$(m,a,g),$(m,c,g),$(m,d,g),Z(u,m,g),$(m,p,g),$(m,f,g),$(m,v,g),Z(x,m,g),y=!0,D||(I=w(e,"click",t[5]),D=!0)},p(t,e){const n={};8&e&&(n.properties=t[3]),1548&e&&(n.$$scope={dirty:e,ctx:t}),o.$set(n);const i={};1&e&&(i.portalID=t[0]),r.$set(i);const l={};1&e&&(l.portalID=t[0]),u.$set(l);const s={};1&e&&(s.portalID=t[0]),x.$set(s)},i(t){y||(U(o.$$.fragment,t),U(r.$$.fragment,t),U(u.$$.fragment,t),U(x.$$.fragment,t),y=!0)},o(t){B(o.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(x.$$.fragment,t),y=!1},d(t){t&&m(e),t&&m(n),K(o,t),t&&m(i),t&&m(l),t&&m(s),K(r,t),t&&m(a),t&&m(c),t&&m(d),K(u,t),t&&m(p),t&&m(f),t&&m(v),K(x,t),D=!1,I()}}}function jt(t){let e,n=t[3][t[9]]+"";return{c(){e=v(n)},m(t,n){$(t,e,n)},p(t,o){520&o&&n!==(n=t[3][t[9]]+"")&&x(e,n)},d(t){t&&m(e)}}}function Ft(t){let e,n,o,i=t[3][t[9]]+"";return{c(){e=g("a"),n=v(i),k(e,"href",o=t[3][t[9]])},m(t,o){$(t,e,o),f(e,n)},p(t,l){520&l&&i!==(i=t[3][t[9]]+"")&&x(n,i),520&l&&o!==(o=t[3][t[9]])&&k(e,"href",o)},d(t){t&&m(e)}}}function Ht(t){let e,n;function o(t,e){return"image"==t[9]?Ft:jt}let i=o(t),l=i(t);return{c(){e=g("div"),l.c(),k(e,"slot","value"),k(e,"title",n=t[2][t[9]]||t[3][t[9]])},m(t,n){$(t,e,n),l.m(e,null)},p(t,s){i===(i=o(t))&&l?l.p(t,s):(l.d(1),l=i(t),l&&(l.c(),l.m(e,null))),524&s&&n!==(n=t[2][t[9]]||t[3][t[9]])&&k(e,"title",n)},d(t){t&&m(e),l.d()}}}function Nt(t){let e,n,o=t[1]&&Ot(t);return{c(){e=g("div"),o&&o.c()},m(t,i){$(t,e,i),o&&o.m(e,null),n=!0},p(t,[n]){t[1]?o?(o.p(t,n),2&n&&U(o,1)):(o=Ot(t),o.c(),U(o,1),o.m(e,null)):o&&(H(),B(o,1,1,(()=>{o=null})),N())},i(t){n||(U(o),n=!0)},o(t){B(o),n=!1},d(t){t&&m(e),o&&o.d()}}}function Ut(t,e,n){let o,i,l;s(t,st,(t=>n(4,l=t)));let{guid:r=null}=e,a=null;return t.$$set=t=>{"guid"in t&&n(0,r=t.guid)},t.$$.update=()=>{17&t.$$.dirty&&(r&&l[r]?n(1,a=l[r]):n(1,a=null)),2&t.$$.dirty&&n(3,o=a?{guid:a.options.guid,timestamp:yt(a.options.timestamp),team:a.options.team,latE6:a.options.data.latE6,lngE6:a.options.data.lngE6,level:a.options.level,health:a.options.data.health,resCount:a.options.data.resCount,image:a.options.data.image,title:a.options.data.title,ornaments:a.options.data.ornaments,mission:a.options.data.mission,mission50plus:a.options.data.mission50plus,artifactBrief:JSON.stringify(a.options.data.artifactBrief),mods:JSON.stringify(a.options.data.mods),resonators:JSON.stringify(a.options.data.resonators),owner:a.options.data.owner,artifactDetail:JSON.stringify(a.options.data.artifactDetail),history:a.options.data.history&&a.options.data.history._raw||0}:{}),2&t.$$.dirty&&n(2,i=a?{image:'<img src="'+a.options.data.image+'" style="width: 100px; height=100px"/>'}:{})},[r,a,i,o,l,()=>window.renderPortalDetails(r),function(e){C.call(this,t,e)},function(e){C.call(this,t,e)},function(e){C.call(this,t,e)}]}registerCSS("h3.svelte-176lmyd:hover{text-decoration:underline;cursor:pointer}");class Bt extends X{constructor(t){super(),W(this,t,Ut,Nt,l,{guid:0})}}function Jt(t,e,n){const o=t.slice();return o[11]=e[n],o}function Qt(t,e){let n,o,i,l,s,r,a,c,d,u=(e[2][e[11]].options.data.title||e[11])+"",p=yt(e[2][e[11]].options.timestamp)+"";function D(){return e[9](e[11])}return{key:t,first:null,c(){n=g("div"),o=v(u),l=h(),s=g("div"),r=v(p),a=h(),k(n,"title",i=e[11]),k(n,"class","svelte-1agsx3x"),y(n,"selected",e[11]==e[3]),y(n,"active",e[11]==e[0]),y(n,"raw",!e[2][e[11]].options.data.title),k(s,"class","raw date svelte-1agsx3x"),y(s,"selected",e[11]==e[3]),y(s,"active",e[11]==e[0]),this.first=n},m(t,e){$(t,n,e),f(n,o),$(t,l,e),$(t,s,e),f(s,r),f(s,a),c||(d=w(n,"click",D),c=!0)},p(t,l){e=t,6&l&&u!==(u=(e[2][e[11]].options.data.title||e[11])+"")&&x(o,u),2&l&&i!==(i=e[11])&&k(n,"title",i),10&l&&y(n,"selected",e[11]==e[3]),3&l&&y(n,"active",e[11]==e[0]),6&l&&y(n,"raw",!e[2][e[11]].options.data.title),6&l&&p!==(p=yt(e[2][e[11]].options.timestamp)+"")&&x(r,p),10&l&&y(s,"selected",e[11]==e[3]),3&l&&y(s,"active",e[11]==e[0])},d(t){t&&m(n),t&&m(l),t&&m(s),c=!1,d()}}}function Yt(e){let n,o=[],i=new Map,l=e[1];const s=t=>t[11];for(let t=0;t<l.length;t+=1){let n=Jt(e,l,t),r=s(n);i.set(r,o[t]=Qt(r,n))}return{c(){n=g("div");for(let t=0;t<o.length;t+=1)o[t].c();k(n,"class","grid svelte-1agsx3x")},m(t,e){$(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){31&e&&(l=t[1],o=Q(o,e,s,1,t,l,i,n,J,Qt,null,Jt))},i:t,o:t,d(t){t&&m(n);for(let t=0;t<o.length;t+=1)o[t].d()}}}function Zt(t,e,n){let o,i,l;s(t,st,(t=>n(2,o=t))),s(t,ct,(t=>n(8,i=t))),s(t,dt,(t=>n(3,l=t)));const r=S();let{activeID:a=!1}=e,{linkID:c=null}=e,{fieldID:d=null}=e,{tileID:u=null}=e,p=[];function f(t){r("select",{type:"portal",guid:t})}return t.$$set=t=>{"activeID"in t&&n(0,a=t.activeID),"linkID"in t&&n(5,c=t.linkID),"fieldID"in t&&n(6,d=t.fieldID),"tileID"in t&&n(7,u=t.tileID)},t.$$.update=()=>{if(486&t.$$.dirty)if(c){const t=window.links[c];n(1,p=t?[t.options.data.oGuid,t.options.data.dGuid]:[])}else if(d){const t=window.fields[d];n(1,p=t?t.options.data.points.map((t=>t.guid)):[])}else if(u){const t=i[u];n(1,p=t?t.entities.filter((t=>"p"==t[0])).map((t=>t[1])):[]),n(1,p=p.filter((t=>o[t])))}else n(1,p=Object.keys(o)),p.sort(((t,e)=>o[e].options.timestamp-o[t].options.timestamp))},[a,p,o,l,f,c,d,u,i,t=>f(t)]}registerCSS(".grid.svelte-1agsx3x.svelte-1agsx3x{display:grid;grid-template-columns:auto max-content;grid-gap:4px}.grid.svelte-1agsx3x div.svelte-1agsx3x:nth-child(2n + 1){text-overflow:ellipsis;overflow:hidden}.grid.svelte-1agsx3x div.svelte-1agsx3x{white-space:nowrap;max-width:30em}.grid.svelte-1agsx3x div.raw.svelte-1agsx3x{font-family:monospace}.date.svelte-1agsx3x.svelte-1agsx3x{margin-left:auto}.selected.svelte-1agsx3x.svelte-1agsx3x{color:red}.active.svelte-1agsx3x.svelte-1agsx3x{color:green}");class Kt extends X{constructor(t){super(),W(this,t,Zt,Yt,l,{activeID:0,linkID:5,fieldID:6,tileID:7})}}function Vt(t){let e,n,o,i,l,s,r,a,c,d,u,p,f,v,w,k;return o=new wt({props:{properties:t[2]}}),r=new Kt({props:{linkID:t[0]}}),r.$on("select",t[4]),u=new qt({props:{linkID:t[0]}}),u.$on("select",t[5]),w=new Gt({props:{linkID:t[0]}}),w.$on("select",t[6]),{c(){e=g("h3"),e.textContent="Link",n=h(),Y(o.$$.fragment),i=h(),l=g("h3"),l.textContent="Portals",s=h(),Y(r.$$.fragment),a=h(),c=g("h3"),c.textContent="Fields",d=h(),Y(u.$$.fragment),p=h(),f=g("h3"),f.textContent="Tiles",v=h(),Y(w.$$.fragment)},m(t,m){$(t,e,m),$(t,n,m),Z(o,t,m),$(t,i,m),$(t,l,m),$(t,s,m),Z(r,t,m),$(t,a,m),$(t,c,m),$(t,d,m),Z(u,t,m),$(t,p,m),$(t,f,m),$(t,v,m),Z(w,t,m),k=!0},p(t,e){const n={};4&e&&(n.properties=t[2]),o.$set(n);const i={};1&e&&(i.linkID=t[0]),r.$set(i);const l={};1&e&&(l.linkID=t[0]),u.$set(l);const s={};1&e&&(s.linkID=t[0]),w.$set(s)},i(t){k||(U(o.$$.fragment,t),U(r.$$.fragment,t),U(u.$$.fragment,t),U(w.$$.fragment,t),k=!0)},o(t){B(o.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(w.$$.fragment,t),k=!1},d(t){t&&m(e),t&&m(n),K(o,t),t&&m(i),t&&m(l),t&&m(s),K(r,t),t&&m(a),t&&m(c),t&&m(d),K(u,t),t&&m(p),t&&m(f),t&&m(v),K(w,t)}}}function Wt(t){let e,n,o=t[1]&&Vt(t);return{c(){e=g("div"),o&&o.c()},m(t,i){$(t,e,i),o&&o.m(e,null),n=!0},p(t,[n]){t[1]?o?(o.p(t,n),2&n&&U(o,1)):(o=Vt(t),o.c(),U(o,1),o.m(e,null)):o&&(H(),B(o,1,1,(()=>{o=null})),N())},i(t){n||(U(o),n=!0)},o(t){B(o),n=!1},d(t){t&&m(e),o&&o.d()}}}function Xt(t,e,n){let o,i;s(t,rt,(t=>n(3,i=t)));let{guid:l=null}=e,r=null;return t.$$set=t=>{"guid"in t&&n(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&i[l]?n(1,r=i[l]):n(1,r=null)),2&t.$$.dirty&&n(2,o=r?{guid:r.options.guid,timestamp:yt(r.options.timestamp),team:r.options.team,oGuid:r.options.data.oGuid,oLatE6:r.options.data.oLatE6,oLngE6:r.options.data.oLngE6,dGuid:r.options.data.dGuid,dLatE6:r.options.data.dLatE6,dLngE6:r.options.data.dLngE6}:{})},[l,r,o,i,function(e){C.call(this,t,e)},function(e){C.call(this,t,e)},function(e){C.call(this,t,e)}]}class te extends X{constructor(t){super(),W(this,t,Xt,Wt,l,{guid:0})}}function ee(t){let e,n,o,i,l,s,r,a,c,d,u,p,f,v,w,k;return o=new wt({props:{properties:t[2]}}),r=new Kt({props:{fieldID:t[0]}}),r.$on("select",t[4]),u=new Ct({props:{fieldID:t[0]}}),u.$on("select",t[5]),w=new Gt({props:{fieldID:t[0]}}),w.$on("select",t[6]),{c(){e=g("h3"),e.textContent="Field",n=h(),Y(o.$$.fragment),i=h(),l=g("h3"),l.textContent="Portals",s=h(),Y(r.$$.fragment),a=h(),c=g("h3"),c.textContent="Links",d=h(),Y(u.$$.fragment),p=h(),f=g("h3"),f.textContent="Tiles",v=h(),Y(w.$$.fragment)},m(t,m){$(t,e,m),$(t,n,m),Z(o,t,m),$(t,i,m),$(t,l,m),$(t,s,m),Z(r,t,m),$(t,a,m),$(t,c,m),$(t,d,m),Z(u,t,m),$(t,p,m),$(t,f,m),$(t,v,m),Z(w,t,m),k=!0},p(t,e){const n={};4&e&&(n.properties=t[2]),o.$set(n);const i={};1&e&&(i.fieldID=t[0]),r.$set(i);const l={};1&e&&(l.fieldID=t[0]),u.$set(l);const s={};1&e&&(s.fieldID=t[0]),w.$set(s)},i(t){k||(U(o.$$.fragment,t),U(r.$$.fragment,t),U(u.$$.fragment,t),U(w.$$.fragment,t),k=!0)},o(t){B(o.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(w.$$.fragment,t),k=!1},d(t){t&&m(e),t&&m(n),K(o,t),t&&m(i),t&&m(l),t&&m(s),K(r,t),t&&m(a),t&&m(c),t&&m(d),K(u,t),t&&m(p),t&&m(f),t&&m(v),K(w,t)}}}function ne(t){let e,n,o=t[1]&&ee(t);return{c(){e=g("div"),o&&o.c()},m(t,i){$(t,e,i),o&&o.m(e,null),n=!0},p(t,[n]){t[1]?o?(o.p(t,n),2&n&&U(o,1)):(o=ee(t),o.c(),U(o,1),o.m(e,null)):o&&(H(),B(o,1,1,(()=>{o=null})),N())},i(t){n||(U(o),n=!0)},o(t){B(o),n=!1},d(t){t&&m(e),o&&o.d()}}}function oe(t,e,n){let o,i;s(t,at,(t=>n(3,i=t)));let{guid:l=null}=e,r=null;return t.$$set=t=>{"guid"in t&&n(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&i[l]?n(1,r=i[l]):n(1,r=null)),2&t.$$.dirty&&n(2,o=r?{guid:r.options.guid,timestamp:yt(r.options.timestamp),team:r.options.team,"points[0].guid":r.options.data.points[0].guid,"points[0].latE6":r.options.data.points[0].latE6,"points[0].lngE6":r.options.data.points[0].lngE6,"points[1].guid":r.options.data.points[1].guid,"points[1].latE6":r.options.data.points[1].latE6,"points[1].lngE6":r.options.data.points[1].lngE6,"points[2].guid":r.options.data.points[2].guid,"points[2].latE6":r.options.data.points[2].latE6,"points[2].lngE6":r.options.data.points[2].lngE6}:{})},[l,r,o,i,function(e){C.call(this,t,e)},function(e){C.call(this,t,e)},function(e){C.call(this,t,e)}]}class ie extends X{constructor(t){super(),W(this,t,oe,ne,l,{guid:0})}}function le(t){let e,n,o,i,l,s,r,a,c,d,u,p,f,v,w,k;return o=new wt({props:{properties:t[2]}}),r=new Kt({props:{tileID:t[0]}}),r.$on("select",t[4]),u=new Ct({props:{tileID:t[0]}}),u.$on("select",t[5]),w=new qt({props:{tileID:t[0]}}),w.$on("select",t[6]),{c(){e=g("h3"),e.textContent="Tile",n=h(),Y(o.$$.fragment),i=h(),l=g("h3"),l.textContent="Portals",s=h(),Y(r.$$.fragment),a=h(),c=g("h3"),c.textContent="Links",d=h(),Y(u.$$.fragment),p=h(),f=g("h3"),f.textContent="Fields",v=h(),Y(w.$$.fragment)},m(t,m){$(t,e,m),$(t,n,m),Z(o,t,m),$(t,i,m),$(t,l,m),$(t,s,m),Z(r,t,m),$(t,a,m),$(t,c,m),$(t,d,m),Z(u,t,m),$(t,p,m),$(t,f,m),$(t,v,m),Z(w,t,m),k=!0},p(t,e){const n={};4&e&&(n.properties=t[2]),o.$set(n);const i={};1&e&&(i.tileID=t[0]),r.$set(i);const l={};1&e&&(l.tileID=t[0]),u.$set(l);const s={};1&e&&(s.tileID=t[0]),w.$set(s)},i(t){k||(U(o.$$.fragment,t),U(r.$$.fragment,t),U(u.$$.fragment,t),U(w.$$.fragment,t),k=!0)},o(t){B(o.$$.fragment,t),B(r.$$.fragment,t),B(u.$$.fragment,t),B(w.$$.fragment,t),k=!1},d(t){t&&m(e),t&&m(n),K(o,t),t&&m(i),t&&m(l),t&&m(s),K(r,t),t&&m(a),t&&m(c),t&&m(d),K(u,t),t&&m(p),t&&m(f),t&&m(v),K(w,t)}}}function se(t){let e,n,o=t[1]&&le(t);return{c(){e=g("div"),o&&o.c()},m(t,i){$(t,e,i),o&&o.m(e,null),n=!0},p(t,[n]){t[1]?o?(o.p(t,n),2&n&&U(o,1)):(o=le(t),o.c(),U(o,1),o.m(e,null)):o&&(H(),B(o,1,1,(()=>{o=null})),N())},i(t){n||(U(o),n=!0)},o(t){B(o),n=!1},d(t){t&&m(e),o&&o.d()}}}function re(t,e,n){let o;s(t,ct,(t=>n(3,o=t)));let{tid:i=null}=e,l=null,r={};return t.$$set=t=>{"tid"in t&&n(0,i=t.tid)},t.$$.update=()=>{if(9&t.$$.dirty&&n(1,l=i?o[i]:null),3&t.$$.dirty)if(l){const[t,e,o,s,a,c]=i.split("_");n(2,r={id:i,time:yt(l.time),zoom:t,x:e,y:o,minlvl:s,maxlvl:a,maxhealth:c})}else n(2,r={})},[i,l,r,o,function(e){C.call(this,t,e)},function(e){C.call(this,t,e)},function(e){C.call(this,t,e)}]}class ae extends X{constructor(t){super(),W(this,t,re,se,l,{tid:0})}}function ce(t){let e,n,o;return{c(){e=g("li"),e.textContent="Current portal",k(e,"class","svelte-v62zqa"),y(e,"selected","portal"==t[0]&&t[1]==t[3])},m(i,l){$(i,e,l),n||(o=w(e,"click",t[5]),n=!0)},p(t,n){11&n&&y(e,"selected","portal"==t[0]&&t[1]==t[3])},d(t){t&&m(e),n=!1,o()}}}function de(t){let e,n;return e=new Gt({props:{activeID:"tile"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.activeID="tile"==t[0]&&t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function ue(t){let e,n;return e=new qt({props:{activeID:"field"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.activeID="field"==t[0]&&t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function pe(t){let e,n;return e=new Ct({props:{activeID:"link"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.activeID="link"==t[0]&&t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function fe(t){let e,n;return e=new Kt({props:{activeID:"portal"==t[0]&&t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.activeID="portal"==t[0]&&t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function $e(t){let e,n,o,i;const l=[he,ve,ge,me],s=[];function r(t,e){return"portal"==t[0]?0:"link"==t[0]?1:"field"==t[0]?2:"tile"==t[0]?3:-1}return~(n=r(t))&&(o=s[n]=l[n](t)),{c(){e=g("div"),o&&o.c(),k(e,"class","card svelte-v62zqa")},m(t,o){$(t,e,o),~n&&s[n].m(e,null),i=!0},p(t,i){let a=n;n=r(t),n===a?~n&&s[n].p(t,i):(o&&(H(),B(s[a],1,1,(()=>{s[a]=null})),N()),~n?(o=s[n],o?o.p(t,i):(o=s[n]=l[n](t),o.c()),U(o,1),o.m(e,null)):o=null)},i(t){i||(U(o),i=!0)},o(t){B(o),i=!1},d(t){t&&m(e),~n&&s[n].d()}}}function me(t){let e,n;return e=new ae({props:{tid:t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.tid=t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function ge(t){let e,n;return e=new ie({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.guid=t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function ve(t){let e,n;return e=new te({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.guid=t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function he(t){let e,n;return e=new Bt({props:{guid:t[1]}}),e.$on("select",t[4]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.guid=t[1]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function we(t){let e,n,i,l,s,r,a,c,d,u,p,v,x,D,I,b,E,S,C=t[3]&&ce(t);const _=[fe,pe,ue,de],L=[];function T(t,e){return"portals"==t[2]?0:"links"==t[2]?1:"fields"==t[2]?2:"tiles"==t[2]?3:-1}~(x=T(t))&&(D=L[x]=_[x](t));let z=t[0]&&$e(t);return{c(){e=g("div"),n=g("div"),i=g("ul"),l=g("li"),l.textContent="Portals",s=h(),r=g("li"),r.textContent="Links",a=h(),c=g("li"),c.textContent="Fields",d=h(),u=g("li"),u.textContent="Tiles",p=h(),C&&C.c(),v=h(),D&&D.c(),I=h(),z&&z.c(),k(l,"class","svelte-v62zqa"),y(l,"active","portals"==t[2]),k(r,"class","svelte-v62zqa"),y(r,"active","links"==t[2]),k(c,"class","svelte-v62zqa"),y(c,"active","fields"==t[2]),k(u,"class","svelte-v62zqa"),y(u,"active","tiles"==t[2]),k(i,"class","tablist svelte-v62zqa"),k(n,"class","list svelte-v62zqa"),k(e,"class","content svelte-v62zqa")},m(o,m){$(o,e,m),f(e,n),f(n,i),f(i,l),f(i,s),f(i,r),f(i,a),f(i,c),f(i,d),f(i,u),f(i,p),C&&C.m(i,null),f(n,v),~x&&L[x].m(n,null),f(e,I),z&&z.m(e,null),b=!0,E||(S=[w(l,"click",t[6]),w(r,"click",t[7]),w(c,"click",t[8]),w(u,"click",t[9])],E=!0)},p(t,o){4&o&&y(l,"active","portals"==t[2]),4&o&&y(r,"active","links"==t[2]),4&o&&y(c,"active","fields"==t[2]),4&o&&y(u,"active","tiles"==t[2]),t[3]?C?C.p(t,o):(C=ce(t),C.c(),C.m(i,null)):C&&(C.d(1),C=null);let s=x;x=T(t),x===s?~x&&L[x].p(t,o):(D&&(H(),B(L[s],1,1,(()=>{L[s]=null})),N()),~x?(D=L[x],D?D.p(t,o):(D=L[x]=_[x](t),D.c()),U(D,1),D.m(n,null)):D=null),t[0]?z?(z.p(t,o),1&o&&U(z,1)):(z=$e(t),z.c(),U(z,1),z.m(e,null)):z&&(H(),B(z,1,1,(()=>{z=null})),N())},i(t){b||(U(D),U(z),b=!0)},o(t){B(D),B(z),b=!1},d(t){t&&m(e),C&&C.d(),~x&&L[x].d(),z&&z.d(),E=!1,o(S)}}}function ke(t){let e,n;return e=new ot({props:{options:{title:"Data Explorer",resizable:!0,width:"auto"},$$slots:{default:[we]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){Y(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(t,[n]){const o={};32783&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function xe(t,e,n){let o,i;s(t,ct,(t=>n(13,o=t))),s(t,dt,(t=>n(3,i=t)));let l=null,r=null,a=null,c=[];function d(t){for(const t of c){const[e,n]=t;switch(e){case"p":break;case"e":const t=window.links[n];t&&t.setStyle({color:COLORS[t.options.team]});break;case"r":const e=window.fields[n];e&&e.setStyle({fillColor:COLORS[e.options.team]})}}c=t;for(const t of c){const[e,n]=t;switch(e){case"p":break;case"e":const t=window.links[n];t&&t.setStyle({color:"red"});break;case"r":const e=window.fields[n];e&&(e.setStyle({fillColor:"red"}),e.bringToFront())}}}let u="portals";E((()=>{d([]),a&&a.remove()}));return[l,r,u,i,function(t){if(a&&(a.remove(),a=null),d([]),t.detail)switch(n(0,l=t.detail.type),n(1,r=t.detail.guid),l){case"portal":window.selectPortal(r);break;case"link":d([["e",r]]);break;case"field":d([["r",r]]);break;case"tile":const t=Dt(r),e=window.TILE_PARAMS.TILES_PER_EDGE[window.TILE_PARAMS.TILES_PER_EDGE.length-1],n={tilesPerEdge:window.TILE_PARAMS.TILES_PER_EDGE[t.zoom]||e},i=tileToLat(t.y,n),l=tileToLat(t.y+1,n),s=tileToLng(t.x,n),c=tileToLng(t.x+1,n),u=o[r];u&&d(u.entities),a=tt.rectangle([[l,s],[i,c]],{color:"purple"}).addTo(window.map)}else n(1,r=null),n(0,l=null)},function(){window.selectedPortal&&(n(0,l="portal"),n(1,r=window.selectedPortal))},()=>n(2,u="portals"),()=>n(2,u="links"),()=>n(2,u="fields"),()=>n(2,u="tiles"),function(e){C.call(this,t,e)}]}registerCSS(".content.svelte-v62zqa.svelte-v62zqa{display:grid;grid-gap:24px;grid-auto-flow:column}.tablist.svelte-v62zqa.svelte-v62zqa{padding-left:1em}.tablist.svelte-v62zqa li.svelte-v62zqa{display:inline-block}.tablist.svelte-v62zqa li.active.svelte-v62zqa{font-weight:bold}.tablist.svelte-v62zqa li.selected.svelte-v62zqa{color:red;font-weight:bold}.tablist.svelte-v62zqa li.svelte-v62zqa:nth-child(n + 2)::before{content:'| '}.content.svelte-v62zqa>div.svelte-v62zqa{background-color:#0003;border-radius:10px;padding:0.5em}.content.svelte-v62zqa .grid{padding:0.5em;border:1px solid #69a;background-color:#0001;box-sizing:border-box}@media(max-width: 700px){.content.svelte-v62zqa>div.svelte-v62zqa{box-sizing:border-box;width:calc(100vw - 24px)}}");class ye extends X{constructor(t){super(),W(this,t,xe,ke,l,{})}}function De(e){let n,o,i;return{c(){n=g("a"),n.textContent="DataExplorer"},m(t,l){$(t,n,l),o||(i=w(n,"click",e[0]),o=!0)},p:t,i:t,o:t,d(t){t&&m(n),o=!1,i()}}}function Ie(t,e,n){let o,i,l,r,a;s(t,ct,(t=>n(2,o=t))),s(t,dt,(t=>n(3,i=t))),s(t,at,(t=>n(4,l=t))),s(t,rt,(t=>n(5,r=t))),s(t,st,(t=>n(6,a=t))),p(st,a=window.portals,a),p(rt,r=window.links,r),p(at,l=window.fields,l),p(dt,i=window.selectedPortal,i),window.addHook("mapDataRefreshEnd",(()=>{p(st,a=window.portals,a),p(rt,r=window.links,r),p(at,l=window.fields,l)})),window.addHook("portalAdded",(t=>{p(st,a[t.portal.options.guid]=t.portal,a)})),window.addHook("linkAdded",(t=>{p(rt,r[t.link.options.guid]=t.link,r)})),window.addHook("fieldAdded",(t=>{p(at,l[t.field.options.guid]=t.field,l)})),window.addHook("portalSelected",(t=>{p(dt,i=t.selectedPortalGuid,i)}));let c=0;window.addHook("mapDataRefreshStart",(()=>{c=Date.now()})),window.addHook("mapDataRefreshEnd",(()=>{const t=o,e=[],n=c-3e5;for(const o in t)t[o].time<n&&e.push(o);for(const n of e)delete t[n];p(ct,o=t,o)}));const d=window.MapDataRequest.prototype.pushRenderQueue;return window.MapDataRequest.prototype.pushRenderQueue=function(t,e,n){d.call(this,t,e,n),p(ct,o[t]={time:Date.now(),entities:e.gameEntities.map((t=>[t[2][0],t[0]]))},o)},[function(){const t=new ye({target:document.body});t.$on("close",(()=>t.$destroy()))}]}class be extends X{constructor(t){super(),W(this,t,Ie,De,l,{})}}const Ee="dataExplorer";class Se{init(){const t=document.querySelector("#toolbox");new be({target:t})}}return()=>{window.plugin[Ee]=new Se,window.plugin[Ee].init(),addCSSs()}}();
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
} // wrapper end
// inject code into site context
var script = document.createElement('script');
var info = {};
if (typeof GM_info !== 'undefined' && GM_info && GM_info.script) info.script = { version: GM_info.script.version, name: GM_info.script.name, description: GM_info.script.description };
script.appendChild(document.createTextNode('('+ wrapper +')('+JSON.stringify(info)+');'));
(document.body || document.head || document.documentElement).appendChild(script);
