// ==UserScript==
// @name        IITC plugin: Data Explorer
// @description UI to explore intel available data
// @namespace   https://github.com/le-jeu
// @version     0.1.1
// @match       https://intel.ingress.com/*
// @author      jaiperdu
// @updateURL   https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @downloadURL https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @grant       none
// ==/UserScript==

function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};

function addCSS(css) {
	var s = document.createElement('style');
	s.textContent = css;
	document.head.appendChild(s);
}
var setup=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function l(t){return"function"==typeof t}function i(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function s(n,e,o){n.$$.on_destroy.push(function(n,...e){if(null==n)return t;const o=n.subscribe(...e);return o.unsubscribe?()=>o.unsubscribe():o}(e,o))}function r(t,n,e,o){return t[1]&&o?function(t,n){for(const e in n)t[e]=n[e];return t}(e.ctx.slice(),t[1](o(n))):e.ctx}function c(t,n,e){return t.set(e),n}function a(t,n){t.appendChild(n)}function u(t,n,e){t.insertBefore(n,e||null)}function d(t){t.parentNode.removeChild(t)}function f(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}function p(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function g(){return m(" ")}function $(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function h(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function w(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}function v(t,n,e){t.classList[e?"add":"remove"](n)}let k;function y(t){k=t}function b(){if(!k)throw new Error("Function called outside component initialization");return k}function x(){const t=b();return(n,e)=>{const o=t.$$.callbacks[n];if(o){const l=function(t,n,e=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,e,!1,n),o}(n,e);o.slice().forEach((n=>{n.call(t,l)}))}}}function D(t,n){const e=t.$$.callbacks[n.type];e&&e.slice().forEach((t=>t.call(this,n)))}const E=[],C=[],I=[],S=[],j=Promise.resolve();let O=!1;function _(t){I.push(t)}let L=!1;const z=new Set;function q(){if(!L){L=!0;do{for(let t=0;t<E.length;t+=1){const n=E[t];y(n),G(n.$$)}for(y(null),E.length=0;C.length;)C.pop()();for(let t=0;t<I.length;t+=1){const n=I[t];z.has(n)||(z.add(n),n())}I.length=0}while(E.length);for(;S.length;)S.pop()();O=!1,L=!1,z.clear()}}function G(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(_)}}const M=new Set;let P;function T(){P={r:0,c:[],p:P}}function A(){P.r||o(P.c),P=P.p}function F(t,n){t&&t.i&&(M.delete(t),t.i(n))}function N(t,n,e,o){if(t&&t.o){if(M.has(t))return;M.add(t),P.c.push((()=>{M.delete(t),o&&(e&&t.d(1),o())})),t.o(n)}}function U(t,n){t.d(1),n.delete(t.key)}function H(t,n,e,o,l,i,s,r,c,a,u,d){let f=t.length,p=i.length,m=f;const g={};for(;m--;)g[t[m].key]=m;const $=[],h=new Map,w=new Map;for(m=p;m--;){const t=d(l,i,m),r=e(t);let c=s.get(r);c?o&&c.p(t,n):(c=a(r,t),c.c()),h.set(r,$[m]=c),r in g&&w.set(r,Math.abs(m-g[r]))}const v=new Set,k=new Set;function y(t){F(t,1),t.m(r,u),s.set(t.key,t),u=t.first,p--}for(;f&&p;){const n=$[p-1],e=t[f-1],o=n.key,l=e.key;n===e?(u=n.first,f--,p--):h.has(l)?!s.has(o)||v.has(o)?y(n):k.has(l)?f--:w.get(o)>w.get(l)?(k.add(o),y(n)):(v.add(l),f--):(c(e,s),f--)}for(;f--;){const n=t[f];h.has(n.key)||c(n,s)}for(;p;)y($[p-1]);return $}function J(t){t&&t.c()}function B(t,e,i,s){const{fragment:r,on_mount:c,on_destroy:a,after_update:u}=t.$$;r&&r.m(e,i),s||_((()=>{const e=c.map(n).filter(l);a?a.push(...e):o(e),t.$$.on_mount=[]})),u.forEach(_)}function R(t,n){const e=t.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function Y(t,n){-1===t.$$.dirty[0]&&(E.push(t),O||(O=!0,j.then(q)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function Z(n,l,i,s,r,c,a,u=[-1]){const f=k;y(n);const p=n.$$={fragment:null,ctx:null,props:c,update:t,not_equal:r,bound:e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(f?f.$$.context:[])),callbacks:e(),dirty:u,skip_bound:!1,root:l.target||f.$$.root};a&&a(p.root);let m=!1;if(p.ctx=i?i(n,l.props||{},((t,e,...o)=>{const l=o.length?o[0]:e;return p.ctx&&r(p.ctx[t],p.ctx[t]=l)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](l),m&&Y(n,t)),e})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!s&&s(p.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();l.intro&&F(n.$$.fragment),B(n,l.target,l.anchor,l.customElement),q()}y(f)}class K{$destroy(){R(this,1),this.$destroy=t}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Q(t){let n,e;const o=t[3].default,l=function(t,n,e,o){if(t){const l=r(t,n,e,o);return t[0](l)}}(o,t,t[2],null);return{c(){n=p("div"),l&&l.c()},m(o,i){u(o,n,i),l&&l.m(n,null),t[4](n),e=!0},p(t,[n]){l&&l.p&&(!e||4&n)&&function(t,n,e,o,l,i){if(l){const s=r(n,e,o,i);t.p(s,l)}}(l,o,t,t[2],e?function(t,n,e,o){if(t[2]&&o){const l=t[2](o(e));if(void 0===n.dirty)return l;if("object"==typeof l){const t=[],e=Math.max(n.dirty.length,l.length);for(let o=0;o<e;o+=1)t[o]=n.dirty[o]|l[o];return t}return n.dirty|l}return n.dirty}(o,t[2],n,null):function(t){if(t.ctx.length>32){const n=[],e=t.ctx.length/32;for(let t=0;t<e;t++)n[t]=-1;return n}return-1}(t[2]),null)},i(t){e||(F(l,t),e=!0)},o(t){N(l,t),e=!1},d(e){e&&d(n),l&&l.d(e),t[4](null)}}}function V(t,n,e){let o,{$$slots:l={},$$scope:i}=n,{options:s={}}=n;var r;return r=()=>{dialog(Object.assign(s,{html:o}))},b().$$.on_mount.push(r),t.$$set=t=>{"options"in t&&e(1,s=t.options),"$$scope"in t&&e(2,i=t.$$scope)},[o,s,i,l,function(t){C[t?"unshift":"push"]((()=>{o=t,e(0,o)}))}]}class W extends K{constructor(t){super(),Z(this,t,V,Q,i,{options:1})}}const X=[];function tt(n,e=t){let o;const l=new Set;function s(t){if(i(n,t)&&(n=t,o)){const t=!X.length;for(const t of l)t[1](),X.push(t,n);if(t){for(let t=0;t<X.length;t+=2)X[t][0](X[t+1]);X.length=0}}}return{set:s,update:function(t){s(t(n))},subscribe:function(i,r=t){const c=[i,r];return l.add(c),1===l.size&&(o=e(s)||t),i(n),()=>{l.delete(c),0===l.size&&(o(),o=null)}}}}const nt=tt({}),et=tt({}),ot=tt({}),lt=tt(null);function it(t,n){return!!window.fields[n]&&window.fields[n].options.data.points.some((n=>n.guid==t))}function st(t,n){return!!window.links[n]&&(window.links[n].options.data.oGuid==t||window.links[n].options.data.dGuid==t)}function rt(t,n){const e=window.links[t];return!!e&&(it(e.options.data.oGuid,n)&&it(e.options.data.dGuid,n))}function ct(t){const n=new Date(t),e=n.getUTCFullYear()+"",o=n.getUTCMonth()+1+"",l=n.getUTCDate()+"",i=n.getUTCHours()+"",s=n.getUTCMinutes()+"",r=n.getUTCSeconds()+"",c=n.getUTCMilliseconds()+"";return`${e}-${o.padStart(2,"0")}-${l.padStart(2,"0")}T${i.padStart(2,"0")}:${s.padStart(2,"0")}:${r.padStart(2,"0")}.${c.padStart(3,"0")}Z`}function at(t,n,e){const o=t.slice();return o[7]=n[e],o}function ut(t,n){let e,o,l,i,s,r,c,f,v,k=n[7]+"",y=ct(n[1][n[7]].options.timestamp)+"";function b(){return n[5](n[7])}return{key:t,first:null,c(){e=p("tr"),o=p("td"),l=m(k),i=g(),s=p("td"),r=m(y),c=g(),h(o,"class","svelte-qpnx6v"),h(s,"class","svelte-qpnx6v"),this.first=e},m(t,n){u(t,e,n),a(e,o),a(o,l),a(e,i),a(e,s),a(s,r),a(e,c),f||(v=$(o,"click",b),f=!0)},p(t,e){n=t,1&e&&k!==(k=n[7]+"")&&w(l,k),3&e&&y!==(y=ct(n[1][n[7]].options.timestamp)+"")&&w(r,y)},d(t){t&&d(e),f=!1,v()}}}function dt(n){let e,o=[],l=new Map,i=n[0];const s=t=>t[7];for(let t=0;t<i.length;t+=1){let e=at(n,i,t),r=s(e);l.set(r,o[t]=ut(r,e))}return{c(){e=p("table");for(let t=0;t<o.length;t+=1)o[t].c();h(e,"class","svelte-qpnx6v")},m(t,n){u(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,[n]){7&n&&(i=t[0],o=H(o,n,s,1,t,i,l,e,U,ut,null,at))},i:t,o:t,d(t){t&&d(e);for(let t=0;t<o.length;t+=1)o[t].d()}}}function ft(t,n,e){let o;s(t,et,(t=>e(1,o=t)));const l=x();let{fieldID:i=null}=n,{portalID:r=null}=n,c=[];function a(t){l("select",{type:"link",guid:t})}return t.$$set=t=>{"fieldID"in t&&e(3,i=t.fieldID),"portalID"in t&&e(4,r=t.portalID)},t.$$.update=()=>{26&t.$$.dirty&&e(0,c=Object.keys(o).filter((t=>(!r||st(r,t))&&(!i||rt(t,i))))),27&t.$$.dirty&&(e(0,c=Object.keys(o).filter((t=>(!r||st(r,t))&&(!i||rt(t,i))))),c.sort(((t,n)=>o[n].options.timestamp-o[t].options.timestamp)))},[c,o,a,i,r,t=>a(t)]}addCSS("table.svelte-qpnx6v td.svelte-qpnx6v:last-child{white-space:nowrap}");class pt extends K{constructor(t){super(),Z(this,t,ft,dt,i,{fieldID:3,portalID:4})}}function mt(t,n,e){const o=t.slice();return o[7]=n[e],o}function gt(t,n){let e,o,l,i,s,r,c,f,v,k=n[7]+"",y=ct(n[1][n[7]].options.timestamp)+"";function b(){return n[5](n[7])}return{key:t,first:null,c(){e=p("tr"),o=p("td"),l=m(k),i=g(),s=p("td"),r=m(y),c=g(),h(o,"class","svelte-qpnx6v"),h(s,"class","svelte-qpnx6v"),this.first=e},m(t,n){u(t,e,n),a(e,o),a(o,l),a(e,i),a(e,s),a(s,r),a(e,c),f||(v=$(o,"click",b),f=!0)},p(t,e){n=t,1&e&&k!==(k=n[7]+"")&&w(l,k),3&e&&y!==(y=ct(n[1][n[7]].options.timestamp)+"")&&w(r,y)},d(t){t&&d(e),f=!1,v()}}}function $t(n){let e,o=[],l=new Map,i=n[0];const s=t=>t[7];for(let t=0;t<i.length;t+=1){let e=mt(n,i,t),r=s(e);l.set(r,o[t]=gt(r,e))}return{c(){e=p("table");for(let t=0;t<o.length;t+=1)o[t].c();h(e,"class","svelte-qpnx6v")},m(t,n){u(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,[n]){7&n&&(i=t[0],o=H(o,n,s,1,t,i,l,e,U,gt,null,mt))},i:t,o:t,d(t){t&&d(e);for(let t=0;t<o.length;t+=1)o[t].d()}}}function ht(t,n,e){let o;s(t,ot,(t=>e(1,o=t)));const l=x();let{linkID:i=null}=n,{portalID:r=null}=n,c=[];function a(t){l("select",{type:"field",guid:t})}return t.$$set=t=>{"linkID"in t&&e(3,i=t.linkID),"portalID"in t&&e(4,r=t.portalID)},t.$$.update=()=>{27&t.$$.dirty&&(e(0,c=Object.keys(o).filter((t=>(!r||it(r,t))&&(!i||rt(i,t))))),c.sort(((t,n)=>o[n].options.timestamp-o[t].options.timestamp)))},[c,o,a,i,r,t=>a(t)]}addCSS("table.svelte-qpnx6v td.svelte-qpnx6v:last-child{white-space:nowrap}");class wt extends K{constructor(t){super(),Z(this,t,ht,$t,i,{linkID:3,portalID:4})}}function vt(t,n,e){const o=t.slice();return o[7]=n[e][0],o[8]=n[e][1],o}function kt(t){let n,e,o,l,i,s,r,c,a,m,w,v,k,y,b=Object.entries(t[2]),x=[];for(let n=0;n<b.length;n+=1)x[n]=xt(vt(t,b,n));return r=new pt({props:{portalID:t[0]}}),r.$on("select",t[5]),w=new wt({props:{portalID:t[0]}}),w.$on("select",t[6]),{c(){n=p("h3"),n.textContent="Portal ↻",e=g(),o=p("table");for(let t=0;t<x.length;t+=1)x[t].c();l=g(),i=p("h3"),i.textContent="Links",s=g(),J(r.$$.fragment),c=g(),a=p("h3"),a.textContent="Fields",m=g(),J(w.$$.fragment),h(n,"class","svelte-mkkozj"),h(o,"class","svelte-mkkozj"),h(i,"class","svelte-mkkozj"),h(a,"class","svelte-mkkozj")},m(d,f){u(d,n,f),u(d,e,f),u(d,o,f);for(let t=0;t<x.length;t+=1)x[t].m(o,null);u(d,l,f),u(d,i,f),u(d,s,f),B(r,d,f),u(d,c,f),u(d,a,f),u(d,m,f),B(w,d,f),v=!0,k||(y=$(n,"click",t[4]),k=!0)},p(t,n){if(6&n){let e;for(b=Object.entries(t[2]),e=0;e<b.length;e+=1){const l=vt(t,b,e);x[e]?x[e].p(l,n):(x[e]=xt(l),x[e].c(),x[e].m(o,null))}for(;e<x.length;e+=1)x[e].d(1);x.length=b.length}const e={};1&n&&(e.portalID=t[0]),r.$set(e);const l={};1&n&&(l.portalID=t[0]),w.$set(l)},i(t){v||(F(r.$$.fragment,t),F(w.$$.fragment,t),v=!0)},o(t){N(r.$$.fragment,t),N(w.$$.fragment,t),v=!1},d(t){t&&d(n),t&&d(e),t&&d(o),f(x,t),t&&d(l),t&&d(i),t&&d(s),R(r,t),t&&d(c),t&&d(a),t&&d(m),R(w,t),k=!1,y()}}}function yt(t){let n,e,o,l=t[8](t[1].options)+"";return{c(){n=p("td"),e=m(l),h(n,"title",o=t[8](t[1].options)),h(n,"class","svelte-mkkozj")},m(t,o){u(t,n,o),a(n,e)},p(t,i){2&i&&l!==(l=t[8](t[1].options)+"")&&w(e,l),2&i&&o!==(o=t[8](t[1].options))&&h(n,"title",o)},d(t){t&&d(n)}}}function bt(t){let n,e,o,l,i,s=t[8](t[1].options)+"";return{c(){n=p("td"),e=p("a"),o=m(s),h(e,"title",l='<img src="'+t[8](t[1].options)+'" style="width: 100px; height=100px"/>'),h(e,"href",i=t[8](t[1].options)),h(n,"class","svelte-mkkozj")},m(t,l){u(t,n,l),a(n,e),a(e,o)},p(t,n){2&n&&s!==(s=t[8](t[1].options)+"")&&w(o,s),2&n&&l!==(l='<img src="'+t[8](t[1].options)+'" style="width: 100px; height=100px"/>')&&h(e,"title",l),2&n&&i!==(i=t[8](t[1].options))&&h(e,"href",i)},d(t){t&&d(n)}}}function xt(t){let n,e,o,l,i,s=t[7]+"";let r=function(t,n){return"image"==t[7]?bt:yt}(t),c=r(t);return{c(){n=p("tr"),e=p("td"),o=m(s),l=g(),c.c(),i=g(),h(e,"class","svelte-mkkozj")},m(t,s){u(t,n,s),a(n,e),a(e,o),a(n,l),c.m(n,null),a(n,i)},p(t,n){c.p(t,n)},d(t){t&&d(n),c.d()}}}function Dt(t){let n,e,o=t[1]&&kt(t);return{c(){n=p("div"),o&&o.c()},m(t,l){u(t,n,l),o&&o.m(n,null),e=!0},p(t,[e]){t[1]?o?(o.p(t,e),2&e&&F(o,1)):(o=kt(t),o.c(),F(o,1),o.m(n,null)):o&&(T(),N(o,1,1,(()=>{o=null})),A())},i(t){e||(F(o),e=!0)},o(t){N(o),e=!1},d(t){t&&d(n),o&&o.d()}}}function Et(t,n,e){let o;s(t,nt,(t=>e(3,o=t)));let{guid:l=null}=n,i=null;const r={guid:t=>t.guid,timestamp:t=>ct(t.timestamp),team:t=>t.team,latE6:t=>t.data.latE6,lngE6:t=>t.data.lngE6,level:t=>t.level,health:t=>t.data.health,resCount:t=>t.data.resCount,image:t=>t.data.image,title:t=>t.data.title,ornaments:t=>t.data.ornaments,mission:t=>t.data.mission,mission50plus:t=>t.data.mission50plus,artifactBrief:t=>JSON.stringify(t.data.artifactBrief),mods:t=>JSON.stringify(t.data.mods),resonators:t=>JSON.stringify(t.data.resonators),owner:t=>t.data.owner,artifactDetail:t=>JSON.stringify(t.data.artifactDetail),history:t=>t.data.history&&t.data.history._raw||0};return t.$$set=t=>{"guid"in t&&e(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?e(1,i=o[l]):e(1,i=null))},[l,i,r,o,()=>window.renderPortalDetails(l),function(n){D.call(this,t,n)},function(n){D.call(this,t,n)}]}addCSS("table.svelte-mkkozj td.svelte-mkkozj:last-child{display:inline-block;max-width:25em;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap}h3.svelte-mkkozj.svelte-mkkozj:hover{text-decoration:underline;cursor:pointer}");class Ct extends K{constructor(t){super(),Z(this,t,Et,Dt,i,{guid:0})}}function It(t,n,e){const o=t.slice();return o[7]=n[e],o}function St(t,n){let e,o,l,i,s,r,c,f,v,k,y=(n[1][n[7]].options.data.title||n[7])+"",b=ct(n[1][n[7]].options.timestamp)+"";function x(){return n[5](n[7])}return{key:t,first:null,c(){e=p("tr"),o=p("td"),l=m(y),s=g(),r=p("td"),c=m(b),f=g(),h(o,"title",i=n[7]),h(o,"class","svelte-1vrp3m9"),h(r,"class","svelte-1vrp3m9"),this.first=e},m(t,n){u(t,e,n),a(e,o),a(o,l),a(e,s),a(e,r),a(r,c),a(e,f),v||(k=$(o,"click",x),v=!0)},p(t,e){n=t,3&e&&y!==(y=(n[1][n[7]].options.data.title||n[7])+"")&&w(l,y),1&e&&i!==(i=n[7])&&h(o,"title",i),3&e&&b!==(b=ct(n[1][n[7]].options.timestamp)+"")&&w(c,b)},d(t){t&&d(e),v=!1,k()}}}function jt(n){let e,o=[],l=new Map,i=n[0];const s=t=>t[7];for(let t=0;t<i.length;t+=1){let e=It(n,i,t),r=s(e);l.set(r,o[t]=St(r,e))}return{c(){e=p("table");for(let t=0;t<o.length;t+=1)o[t].c();h(e,"class","svelte-1vrp3m9")},m(t,n){u(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,[n]){7&n&&(i=t[0],o=H(o,n,s,1,t,i,l,e,U,St,null,It))},i:t,o:t,d(t){t&&d(e);for(let t=0;t<o.length;t+=1)o[t].d()}}}function Ot(t,n,e){let o;s(t,nt,(t=>e(1,o=t)));const l=x();let{fieldID:i=null}=n,{linkID:r=null}=n,c=[];function a(t){l("select",{type:"portal",guid:t})}return t.$$set=t=>{"fieldID"in t&&e(3,i=t.fieldID),"linkID"in t&&e(4,r=t.linkID)},t.$$.update=()=>{if(27&t.$$.dirty)if(r){const t=window.links[r];e(0,c=t?[t.options.data.oGuid,t.options.data.dGuid]:[])}else if(i){const t=window.fields[i];e(0,c=t?t.options.data.points.map((t=>t.guid)):[])}else e(0,c=Object.keys(o)),c.sort(((t,n)=>o[n].options.timestamp-o[t].options.timestamp))},[c,o,a,i,r,t=>a(t)]}addCSS("table.svelte-1vrp3m9 td.svelte-1vrp3m9:first-child{display:inline-block;max-width:25em;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap}table.svelte-1vrp3m9 td.svelte-1vrp3m9{white-space:nowrap}");class _t extends K{constructor(t){super(),Z(this,t,Ot,jt,i,{fieldID:3,linkID:4})}}function Lt(t,n,e){const o=t.slice();return o[6]=n[e][0],o[7]=n[e][1],o}function zt(t){let n,e,o,l,i,s,r,c,a,m,$,h,w=Object.entries(t[2]),v=[];for(let n=0;n<w.length;n+=1)v[n]=qt(Lt(t,w,n));return r=new _t({props:{linkID:t[0]}}),r.$on("select",t[4]),$=new wt({props:{linkID:t[0]}}),$.$on("select",t[5]),{c(){n=p("h3"),n.textContent="Link",e=g(),o=p("table");for(let t=0;t<v.length;t+=1)v[t].c();l=g(),i=p("h3"),i.textContent="Portals",s=g(),J(r.$$.fragment),c=g(),a=p("h3"),a.textContent="Fields",m=g(),J($.$$.fragment)},m(t,d){u(t,n,d),u(t,e,d),u(t,o,d);for(let t=0;t<v.length;t+=1)v[t].m(o,null);u(t,l,d),u(t,i,d),u(t,s,d),B(r,t,d),u(t,c,d),u(t,a,d),u(t,m,d),B($,t,d),h=!0},p(t,n){if(6&n){let e;for(w=Object.entries(t[2]),e=0;e<w.length;e+=1){const l=Lt(t,w,e);v[e]?v[e].p(l,n):(v[e]=qt(l),v[e].c(),v[e].m(o,null))}for(;e<v.length;e+=1)v[e].d(1);v.length=w.length}const e={};1&n&&(e.linkID=t[0]),r.$set(e);const l={};1&n&&(l.linkID=t[0]),$.$set(l)},i(t){h||(F(r.$$.fragment,t),F($.$$.fragment,t),h=!0)},o(t){N(r.$$.fragment,t),N($.$$.fragment,t),h=!1},d(t){t&&d(n),t&&d(e),t&&d(o),f(v,t),t&&d(l),t&&d(i),t&&d(s),R(r,t),t&&d(c),t&&d(a),t&&d(m),R($,t)}}}function qt(t){let n,e,o,l,i,s,r,c=t[6]+"",f=t[7](t[1].options)+"";return{c(){n=p("tr"),e=p("td"),o=m(c),l=g(),i=p("td"),s=m(f),r=g()},m(t,c){u(t,n,c),a(n,e),a(e,o),a(n,l),a(n,i),a(i,s),a(n,r)},p(t,n){2&n&&f!==(f=t[7](t[1].options)+"")&&w(s,f)},d(t){t&&d(n)}}}function Gt(t){let n,e,o=t[1]&&zt(t);return{c(){n=p("div"),o&&o.c()},m(t,l){u(t,n,l),o&&o.m(n,null),e=!0},p(t,[e]){t[1]?o?(o.p(t,e),2&e&&F(o,1)):(o=zt(t),o.c(),F(o,1),o.m(n,null)):o&&(T(),N(o,1,1,(()=>{o=null})),A())},i(t){e||(F(o),e=!0)},o(t){N(o),e=!1},d(t){t&&d(n),o&&o.d()}}}function Mt(t,n,e){let o;s(t,et,(t=>e(3,o=t)));let{guid:l=null}=n,i=null;const r={guid:t=>t.guid,timestamp:t=>ct(t.timestamp),team:t=>t.team,oGuid:t=>t.data.oGuid,oLatE6:t=>t.data.oLatE6,oLngE6:t=>t.data.oLngE6,dGuid:t=>t.data.dGuid,dLatE6:t=>t.data.dLatE6,dLngE6:t=>t.data.dLngE6};return t.$$set=t=>{"guid"in t&&e(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?e(1,i=o[l]):e(1,i=null))},[l,i,r,o,function(n){D.call(this,t,n)},function(n){D.call(this,t,n)}]}class Pt extends K{constructor(t){super(),Z(this,t,Mt,Gt,i,{guid:0})}}function Tt(t,n,e){const o=t.slice();return o[6]=n[e][0],o[7]=n[e][1],o}function At(t){let n,e,o,l,i,s,r,c,a,m,$,h,w=Object.entries(t[2]),v=[];for(let n=0;n<w.length;n+=1)v[n]=Ft(Tt(t,w,n));return r=new _t({props:{fieldID:t[0]}}),r.$on("select",t[4]),$=new pt({props:{fieldID:t[0]}}),$.$on("select",t[5]),{c(){n=p("h3"),n.textContent="Field",e=g(),o=p("table");for(let t=0;t<v.length;t+=1)v[t].c();l=g(),i=p("h3"),i.textContent="Portals",s=g(),J(r.$$.fragment),c=g(),a=p("h3"),a.textContent="Links",m=g(),J($.$$.fragment)},m(t,d){u(t,n,d),u(t,e,d),u(t,o,d);for(let t=0;t<v.length;t+=1)v[t].m(o,null);u(t,l,d),u(t,i,d),u(t,s,d),B(r,t,d),u(t,c,d),u(t,a,d),u(t,m,d),B($,t,d),h=!0},p(t,n){if(6&n){let e;for(w=Object.entries(t[2]),e=0;e<w.length;e+=1){const l=Tt(t,w,e);v[e]?v[e].p(l,n):(v[e]=Ft(l),v[e].c(),v[e].m(o,null))}for(;e<v.length;e+=1)v[e].d(1);v.length=w.length}const e={};1&n&&(e.fieldID=t[0]),r.$set(e);const l={};1&n&&(l.fieldID=t[0]),$.$set(l)},i(t){h||(F(r.$$.fragment,t),F($.$$.fragment,t),h=!0)},o(t){N(r.$$.fragment,t),N($.$$.fragment,t),h=!1},d(t){t&&d(n),t&&d(e),t&&d(o),f(v,t),t&&d(l),t&&d(i),t&&d(s),R(r,t),t&&d(c),t&&d(a),t&&d(m),R($,t)}}}function Ft(t){let n,e,o,l,i,s,r,c=t[6]+"",f=t[7](t[1].options)+"";return{c(){n=p("tr"),e=p("td"),o=m(c),l=g(),i=p("td"),s=m(f),r=g()},m(t,c){u(t,n,c),a(n,e),a(e,o),a(n,l),a(n,i),a(i,s),a(n,r)},p(t,n){2&n&&f!==(f=t[7](t[1].options)+"")&&w(s,f)},d(t){t&&d(n)}}}function Nt(t){let n,e,o=t[1]&&At(t);return{c(){n=p("div"),o&&o.c()},m(t,l){u(t,n,l),o&&o.m(n,null),e=!0},p(t,[e]){t[1]?o?(o.p(t,e),2&e&&F(o,1)):(o=At(t),o.c(),F(o,1),o.m(n,null)):o&&(T(),N(o,1,1,(()=>{o=null})),A())},i(t){e||(F(o),e=!0)},o(t){N(o),e=!1},d(t){t&&d(n),o&&o.d()}}}function Ut(t,n,e){let o;s(t,ot,(t=>e(3,o=t)));let{guid:l=null}=n,i=null;const r={guid:t=>t.guid,timestamp:t=>ct(t.timestamp),team:t=>t.team,"points[0].guid":t=>t.data.points[0].guid,"points[0].latE6":t=>t.data.points[0].latE6,"points[0].lngE6":t=>t.data.points[0].lngE6,"points[1].guid":t=>t.data.points[1].guid,"points[1].latE6":t=>t.data.points[1].latE6,"points[1].lngE6":t=>t.data.points[1].lngE6,"points[2].guid":t=>t.data.points[2].guid,"points[2].latE6":t=>t.data.points[2].latE6,"points[2].lngE6":t=>t.data.points[2].lngE6};return t.$$set=t=>{"guid"in t&&e(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?e(1,i=o[l]):e(1,i=null))},[l,i,r,o,function(n){D.call(this,t,n)},function(n){D.call(this,t,n)}]}class Ht extends K{constructor(t){super(),Z(this,t,Ut,Nt,i,{guid:0})}}function Jt(n){let e,o;return e=new wt({}),e.$on("select",n[3]),{c(){J(e.$$.fragment)},m(t,n){B(e,t,n),o=!0},p:t,i(t){o||(F(e.$$.fragment,t),o=!0)},o(t){N(e.$$.fragment,t),o=!1},d(t){R(e,t)}}}function Bt(n){let e,o;return e=new pt({}),e.$on("select",n[3]),{c(){J(e.$$.fragment)},m(t,n){B(e,t,n),o=!0},p:t,i(t){o||(F(e.$$.fragment,t),o=!0)},o(t){N(e.$$.fragment,t),o=!1},d(t){R(e,t)}}}function Rt(n){let e,o;return e=new _t({}),e.$on("select",n[3]),{c(){J(e.$$.fragment)},m(t,n){B(e,t,n),o=!0},p:t,i(t){o||(F(e.$$.fragment,t),o=!0)},o(t){N(e.$$.fragment,t),o=!1},d(t){R(e,t)}}}function Yt(t){let n,e,o,l;const i=[Qt,Kt,Zt],s=[];function r(t,n){return"portal"==t[0]?0:"link"==t[0]?1:"field"==t[0]?2:-1}return~(e=r(t))&&(o=s[e]=i[e](t)),{c(){n=p("div"),o&&o.c(),h(n,"class","card")},m(t,o){u(t,n,o),~e&&s[e].m(n,null),l=!0},p(t,l){let c=e;e=r(t),e===c?~e&&s[e].p(t,l):(o&&(T(),N(s[c],1,1,(()=>{s[c]=null})),A()),~e?(o=s[e],o?o.p(t,l):(o=s[e]=i[e](t),o.c()),F(o,1),o.m(n,null)):o=null)},i(t){l||(F(o),l=!0)},o(t){N(o),l=!1},d(t){t&&d(n),~e&&s[e].d()}}}function Zt(t){let n,e;return n=new Ht({props:{guid:t[1]}}),n.$on("select",t[3]),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,e){const o={};2&e&&(o.guid=t[1]),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Kt(t){let n,e;return n=new Pt({props:{guid:t[1]}}),n.$on("select",t[3]),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,e){const o={};2&e&&(o.guid=t[1]),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Qt(t){let n,e;return n=new Ct({props:{guid:t[1]}}),n.$on("select",t[3]),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,e){const o={};2&e&&(o.guid=t[1]),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Vt(t){let n,e,l,i,s,r,c,f,m,w,k,y,b,x,D,E,C;const I=[Rt,Bt,Jt],S=[];function j(t,n){return"portals"==t[2]?0:"links"==t[2]?1:"fields"==t[2]?2:-1}~(y=j(t))&&(b=S[y]=I[y](t));let O=t[0]&&Yt(t);return{c(){n=p("div"),e=p("div"),l=p("ul"),i=p("li"),i.textContent="Portals",s=g(),r=p("li"),r.textContent="Links",c=g(),f=p("li"),f.textContent="Fields",m=g(),w=p("li"),w.textContent="Current portal",k=g(),b&&b.c(),x=g(),O&&O.c(),h(i,"class","svelte-ymvntg"),v(i,"active","portals"==t[2]),h(r,"class","svelte-ymvntg"),v(r,"active","links"==t[2]),h(f,"class","svelte-ymvntg"),v(f,"active","fields"==t[2]),h(w,"class","svelte-ymvntg"),h(l,"class","tablist svelte-ymvntg"),h(e,"class","list"),h(n,"class","content svelte-ymvntg")},m(o,d){u(o,n,d),a(n,e),a(e,l),a(l,i),a(l,s),a(l,r),a(l,c),a(l,f),a(l,m),a(l,w),a(e,k),~y&&S[y].m(e,null),a(n,x),O&&O.m(n,null),D=!0,E||(C=[$(i,"click",t[5]),$(r,"click",t[6]),$(f,"click",t[7]),$(w,"click",t[4])],E=!0)},p(t,o){4&o&&v(i,"active","portals"==t[2]),4&o&&v(r,"active","links"==t[2]),4&o&&v(f,"active","fields"==t[2]);let l=y;y=j(t),y===l?~y&&S[y].p(t,o):(b&&(T(),N(S[l],1,1,(()=>{S[l]=null})),A()),~y?(b=S[y],b?b.p(t,o):(b=S[y]=I[y](t),b.c()),F(b,1),b.m(e,null)):b=null),t[0]?O?(O.p(t,o),1&o&&F(O,1)):(O=Yt(t),O.c(),F(O,1),O.m(n,null)):O&&(T(),N(O,1,1,(()=>{O=null})),A())},i(t){D||(F(b),F(O),D=!0)},o(t){N(b),N(O),D=!1},d(t){t&&d(n),~y&&S[y].d(),O&&O.d(),E=!1,o(C)}}}function Wt(t){let n,e;return n=new W({props:{options:{title:"Data Explorer",resizable:!0,width:"auto"},$$slots:{default:[Vt]},$$scope:{ctx:t}}}),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,[e]){const o={};519&e&&(o.$$scope={dirty:e,ctx:t}),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Xt(t,n,e){let o=null,l=null;let i="portals";return[o,l,i,function(t){if(function(){let t,n;switch(o){case"portal":break;case"link":t=window.links[l],t&&t.setStyle({color:window.COLORS[t.options.team]});break;case"field":n=window.fields[l],n&&n.setStyle({fillColor:window.COLORS[n.options.team]})}}(),t.detail)switch(e(0,o=t.detail.type),e(1,l=t.detail.guid),o){case"portal":window.selectPortal(l);break;case"link":const t=window.links[l];t&&t.setStyle({color:"red"});break;case"field":const n=window.fields[l];n&&(n.setStyle({fillColor:"red"}),n.bringToFront())}else e(1,l=null),e(0,o=null)},function(){window.selectedPortal&&(e(0,o="portal"),e(1,l=window.selectedPortal))},()=>e(2,i="portals"),()=>e(2,i="links"),()=>e(2,i="fields")]}addCSS('.content.svelte-ymvntg.svelte-ymvntg{display:flex}.tablist.svelte-ymvntg.svelte-ymvntg{padding-left:1em}.tablist.svelte-ymvntg li.svelte-ymvntg{display:inline-block}.tablist.svelte-ymvntg li.active.svelte-ymvntg{font-weight:bold}.tablist.svelte-ymvntg li.svelte-ymvntg:nth-child(n+2)::before{content:"| "}');class tn extends K{constructor(t){super(),Z(this,t,Xt,Wt,i,{})}}function nn(n){let e,o,l;return{c(){e=p("a"),e.textContent="DataExplorer"},m(t,i){u(t,e,i),o||(l=$(e,"click",n[0]),o=!0)},p:t,i:t,o:t,d(t){t&&d(e),o=!1,l()}}}function en(t,n,e){let o,l,i,r;return s(t,lt,(t=>e(1,o=t))),s(t,ot,(t=>e(2,l=t))),s(t,et,(t=>e(3,i=t))),s(t,nt,(t=>e(4,r=t))),c(nt,r=window.portals,r),c(et,i=window.links,i),c(ot,l=window.fields,l),c(lt,o=window.selectedPortal,o),window.addHook("mapDataRefreshEnd",(()=>{c(nt,r=window.portals,r),c(et,i=window.links,i),c(ot,l=window.fields,l)})),window.addHook("portalAdded",(t=>{c(nt,r[t.portal.options.guid]=t.portal,r)})),window.addHook("linkAdded",(t=>{c(et,i[t.link.options.guid]=t.link,i)})),window.addHook("fieldAdded",(t=>{c(ot,l[t.field.options.guid]=t.field,l)})),window.addHook("portalSelected",(t=>{c(lt,o=t.selectedPortalGuid,o)})),[function(){new tn({target:document.body})}]}class on extends K{constructor(t){super(),Z(this,t,en,nn,i,{})}}const ln="dataExplorer";class sn{init(){const t=document.querySelector("#toolbox");new on({target:t})}}return()=>{window.plugin[ln]=new sn,window.plugin[ln].init()}}();
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
} // wrapper end
// inject code into site context
var script = document.createElement('script');
var info = {};
if (typeof GM_info !== 'undefined' && GM_info && GM_info.script) info.script = { version: GM_info.script.version, name: GM_info.script.name, description: GM_info.script.description };
script.appendChild(document.createTextNode('('+ wrapper +')('+JSON.stringify(info)+');'));
(document.body || document.head || document.documentElement).appendChild(script);
