// ==UserScript==
// @name        IITC plugin: Data Explorer
// @description UI to explore intel available data
// @namespace   https://github.com/le-jeu
// @version     0.1.2
// @match       https://intel.ingress.com/*
// @author      jaiperdu
// @updateURL   https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @downloadURL https://github.com/le-jeu/iitc-data-explorer/raw/dist/dataExplorer.user.js
// @grant       none
// ==/UserScript==

function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};

var cssList = [];
function registerCSS(css) {
	cssList.push(css);
}

function addCSS(css) {
	var s = document.createElement('style');
	s.textContent = css;
	document.head.appendChild(s);
}

function addCSSs(css) {
	cssList.forEach(addCSS);
}
var setup=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function l(t){return"function"==typeof t}function i(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function s(n,e,o){n.$$.on_destroy.push(function(n,...e){if(null==n)return t;const o=n.subscribe(...e);return o.unsubscribe?()=>o.unsubscribe():o}(e,o))}function r(t,n,e,o){return t[1]&&o?function(t,n){for(const e in n)t[e]=n[e];return t}(e.ctx.slice(),t[1](o(n))):e.ctx}function c(t,n,e){return t.set(e),n}function a(t,n){t.appendChild(n)}function u(t,n,e){t.insertBefore(n,e||null)}function d(t){t.parentNode.removeChild(t)}function f(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}function p(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function $(){return m(" ")}function g(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function h(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function w(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}function k(t,n,e){t.classList[e?"add":"remove"](n)}let b;function v(t){b=t}function y(){if(!b)throw new Error("Function called outside component initialization");return b}function x(){const t=y();return(n,e)=>{const o=t.$$.callbacks[n];if(o){const l=function(t,n,e=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,e,!1,n),o}(n,e);o.slice().forEach((n=>{n.call(t,l)}))}}}function j(t,n){const e=t.$$.callbacks[n.type];e&&e.slice().forEach((t=>t.call(this,n)))}const D=[],E=[],C=[],I=[],S=Promise.resolve();let O=!1;function _(t){C.push(t)}let z=!1;const L=new Set;function G(){if(!z){z=!0;do{for(let t=0;t<D.length;t+=1){const n=D[t];v(n),M(n.$$)}for(v(null),D.length=0;E.length;)E.pop()();for(let t=0;t<C.length;t+=1){const n=C[t];L.has(n)||(L.add(n),n())}C.length=0}while(D.length);for(;I.length;)I.pop()();O=!1,z=!1,L.clear()}}function M(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(_)}}const P=new Set;let T;function q(){T={r:0,c:[],p:T}}function A(){T.r||o(T.c),T=T.p}function F(t,n){t&&t.i&&(P.delete(t),t.i(n))}function N(t,n,e,o){if(t&&t.o){if(P.has(t))return;P.add(t),T.c.push((()=>{P.delete(t),o&&(e&&t.d(1),o())})),t.o(n)}}function U(t,n){t.d(1),n.delete(t.key)}function H(t,n,e,o,l,i,s,r,c,a,u,d){let f=t.length,p=i.length,m=f;const $={};for(;m--;)$[t[m].key]=m;const g=[],h=new Map,w=new Map;for(m=p;m--;){const t=d(l,i,m),r=e(t);let c=s.get(r);c?o&&c.p(t,n):(c=a(r,t),c.c()),h.set(r,g[m]=c),r in $&&w.set(r,Math.abs(m-$[r]))}const k=new Set,b=new Set;function v(t){F(t,1),t.m(r,u),s.set(t.key,t),u=t.first,p--}for(;f&&p;){const n=g[p-1],e=t[f-1],o=n.key,l=e.key;n===e?(u=n.first,f--,p--):h.has(l)?!s.has(o)||k.has(o)?v(n):b.has(l)?f--:w.get(o)>w.get(l)?(b.add(o),v(n)):(k.add(l),f--):(c(e,s),f--)}for(;f--;){const n=t[f];h.has(n.key)||c(n,s)}for(;p;)v(g[p-1]);return g}function J(t){t&&t.c()}function B(t,e,i,s){const{fragment:r,on_mount:c,on_destroy:a,after_update:u}=t.$$;r&&r.m(e,i),s||_((()=>{const e=c.map(n).filter(l);a?a.push(...e):o(e),t.$$.on_mount=[]})),u.forEach(_)}function R(t,n){const e=t.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function Y(t,n){-1===t.$$.dirty[0]&&(D.push(t),O||(O=!0,S.then(G)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function Z(n,l,i,s,r,c,a,u=[-1]){const f=b;v(n);const p=n.$$={fragment:null,ctx:null,props:c,update:t,not_equal:r,bound:e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(f?f.$$.context:[])),callbacks:e(),dirty:u,skip_bound:!1,root:l.target||f.$$.root};a&&a(p.root);let m=!1;if(p.ctx=i?i(n,l.props||{},((t,e,...o)=>{const l=o.length?o[0]:e;return p.ctx&&r(p.ctx[t],p.ctx[t]=l)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](l),m&&Y(n,t)),e})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!s&&s(p.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();l.intro&&F(n.$$.fragment),B(n,l.target,l.anchor,l.customElement),G()}v(f)}class K{$destroy(){R(this,1),this.$destroy=t}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Q(t){let n,e;const o=t[3].default,l=function(t,n,e,o){if(t){const l=r(t,n,e,o);return t[0](l)}}(o,t,t[2],null);return{c(){n=p("div"),l&&l.c()},m(o,i){u(o,n,i),l&&l.m(n,null),t[4](n),e=!0},p(t,[n]){l&&l.p&&(!e||4&n)&&function(t,n,e,o,l,i){if(l){const s=r(n,e,o,i);t.p(s,l)}}(l,o,t,t[2],e?function(t,n,e,o){if(t[2]&&o){const l=t[2](o(e));if(void 0===n.dirty)return l;if("object"==typeof l){const t=[],e=Math.max(n.dirty.length,l.length);for(let o=0;o<e;o+=1)t[o]=n.dirty[o]|l[o];return t}return n.dirty|l}return n.dirty}(o,t[2],n,null):function(t){if(t.ctx.length>32){const n=[],e=t.ctx.length/32;for(let t=0;t<e;t++)n[t]=-1;return n}return-1}(t[2]),null)},i(t){e||(F(l,t),e=!0)},o(t){N(l,t),e=!1},d(e){e&&d(n),l&&l.d(e),t[4](null)}}}function V(t,n,e){let o,{$$slots:l={},$$scope:i}=n,{options:s={}}=n;var r;return r=()=>{dialog(Object.assign(s,{html:o}))},y().$$.on_mount.push(r),t.$$set=t=>{"options"in t&&e(1,s=t.options),"$$scope"in t&&e(2,i=t.$$scope)},[o,s,i,l,function(t){E[t?"unshift":"push"]((()=>{o=t,e(0,o)}))}]}class W extends K{constructor(t){super(),Z(this,t,V,Q,i,{options:1})}}const X=[];function tt(n,e=t){let o;const l=new Set;function s(t){if(i(n,t)&&(n=t,o)){const t=!X.length;for(const t of l)t[1](),X.push(t,n);if(t){for(let t=0;t<X.length;t+=2)X[t][0](X[t+1]);X.length=0}}}return{set:s,update:function(t){s(t(n))},subscribe:function(i,r=t){const c=[i,r];return l.add(c),1===l.size&&(o=e(s)||t),i(n),()=>{l.delete(c),0===l.size&&(o(),o=null)}}}}const nt=tt({}),et=tt({}),ot=tt({}),lt=tt(null);function it(t,n){return!!window.fields[n]&&window.fields[n].options.data.points.some((n=>n.guid==t))}function st(t,n){return!!window.links[n]&&(window.links[n].options.data.oGuid==t||window.links[n].options.data.dGuid==t)}function rt(t,n){const e=window.links[t];return!!e&&(it(e.options.data.oGuid,n)&&it(e.options.data.dGuid,n))}function ct(t){const n=new Date(t),e=n.getUTCFullYear()+"",o=n.getUTCMonth()+1+"",l=n.getUTCDate()+"",i=n.getUTCHours()+"",s=n.getUTCMinutes()+"",r=n.getUTCSeconds()+"",c=n.getUTCMilliseconds()+"";return`${e}-${o.padStart(2,"0")}-${l.padStart(2,"0")}T${i.padStart(2,"0")}:${s.padStart(2,"0")}:${r.padStart(2,"0")}.${c.padStart(3,"0")}Z`}function at(t,n,e){const o=t.slice();return o[7]=n[e],o}function ut(t,n){let e,o,l,i,s,r,c,f,k,b=n[7]+"",v=ct(n[1][n[7]].options.timestamp)+"";function y(){return n[5](n[7])}return{key:t,first:null,c(){e=p("tr"),o=p("td"),l=m(b),i=$(),s=p("td"),r=m(v),c=$(),h(o,"class","raw"),h(s,"class","raw"),this.first=e},m(t,n){u(t,e,n),a(e,o),a(o,l),a(e,i),a(e,s),a(s,r),a(e,c),f||(k=g(o,"click",y),f=!0)},p(t,e){n=t,1&e&&b!==(b=n[7]+"")&&w(l,b),3&e&&v!==(v=ct(n[1][n[7]].options.timestamp)+"")&&w(r,v)},d(t){t&&d(e),f=!1,k()}}}function dt(n){let e,o=[],l=new Map,i=n[0];const s=t=>t[7];for(let t=0;t<i.length;t+=1){let e=at(n,i,t),r=s(e);l.set(r,o[t]=ut(r,e))}return{c(){e=p("table");for(let t=0;t<o.length;t+=1)o[t].c()},m(t,n){u(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,[n]){7&n&&(i=t[0],o=H(o,n,s,1,t,i,l,e,U,ut,null,at))},i:t,o:t,d(t){t&&d(e);for(let t=0;t<o.length;t+=1)o[t].d()}}}function ft(t,n,e){let o;s(t,et,(t=>e(1,o=t)));const l=x();let{portalID:i=null}=n,{fieldID:r=null}=n,c=[];function a(t){l("select",{type:"link",guid:t})}return t.$$set=t=>{"portalID"in t&&e(3,i=t.portalID),"fieldID"in t&&e(4,r=t.fieldID)},t.$$.update=()=>{26&t.$$.dirty&&e(0,c=Object.keys(o).filter((t=>(!i||st(i,t))&&(!r||rt(t,r))))),27&t.$$.dirty&&(e(0,c=Object.keys(o).filter((t=>(!i||st(i,t))&&(!r||rt(t,r))))),c.sort(((t,n)=>o[n].options.timestamp-o[t].options.timestamp)))},[c,o,a,i,r,t=>a(t)]}class pt extends K{constructor(t){super(),Z(this,t,ft,dt,i,{portalID:3,fieldID:4})}}function mt(t,n,e){const o=t.slice();return o[7]=n[e],o}function $t(t,n){let e,o,l,i,s,r,c,f,k,b=n[7]+"",v=ct(n[1][n[7]].options.timestamp)+"";function y(){return n[5](n[7])}return{key:t,first:null,c(){e=p("tr"),o=p("td"),l=m(b),i=$(),s=p("td"),r=m(v),c=$(),h(o,"class","raw"),h(s,"class","raw"),this.first=e},m(t,n){u(t,e,n),a(e,o),a(o,l),a(e,i),a(e,s),a(s,r),a(e,c),f||(k=g(o,"click",y),f=!0)},p(t,e){n=t,1&e&&b!==(b=n[7]+"")&&w(l,b),3&e&&v!==(v=ct(n[1][n[7]].options.timestamp)+"")&&w(r,v)},d(t){t&&d(e),f=!1,k()}}}function gt(n){let e,o=[],l=new Map,i=n[0];const s=t=>t[7];for(let t=0;t<i.length;t+=1){let e=mt(n,i,t),r=s(e);l.set(r,o[t]=$t(r,e))}return{c(){e=p("table");for(let t=0;t<o.length;t+=1)o[t].c()},m(t,n){u(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,[n]){7&n&&(i=t[0],o=H(o,n,s,1,t,i,l,e,U,$t,null,mt))},i:t,o:t,d(t){t&&d(e);for(let t=0;t<o.length;t+=1)o[t].d()}}}function ht(t,n,e){let o;s(t,ot,(t=>e(1,o=t)));const l=x();let{portalID:i=null}=n,{linkID:r=null}=n,c=[];function a(t){l("select",{type:"field",guid:t})}return t.$$set=t=>{"portalID"in t&&e(3,i=t.portalID),"linkID"in t&&e(4,r=t.linkID)},t.$$.update=()=>{27&t.$$.dirty&&(e(0,c=Object.keys(o).filter((t=>(!i||it(i,t))&&(!r||rt(r,t))))),c.sort(((t,n)=>o[n].options.timestamp-o[t].options.timestamp)))},[c,o,a,i,r,t=>a(t)]}class wt extends K{constructor(t){super(),Z(this,t,ht,gt,i,{portalID:3,linkID:4})}}function kt(t,n,e){const o=t.slice();return o[7]=n[e][0],o[8]=n[e][1],o}function bt(t){let n,e,o,l,i,s,r,c,a,m,w,k,b,v,y=Object.entries(t[2]),x=[];for(let n=0;n<y.length;n+=1)x[n]=xt(kt(t,y,n));return r=new pt({props:{portalID:t[0]}}),r.$on("select",t[5]),w=new wt({props:{portalID:t[0]}}),w.$on("select",t[6]),{c(){n=p("h3"),n.textContent="Portal ↻",e=$(),o=p("table");for(let t=0;t<x.length;t+=1)x[t].c();l=$(),i=p("h3"),i.textContent="Links",s=$(),J(r.$$.fragment),c=$(),a=p("h3"),a.textContent="Fields",m=$(),J(w.$$.fragment),h(n,"class","svelte-mkkozj"),h(o,"class","raw svelte-mkkozj"),h(i,"class","svelte-mkkozj"),h(a,"class","svelte-mkkozj")},m(d,f){u(d,n,f),u(d,e,f),u(d,o,f);for(let t=0;t<x.length;t+=1)x[t].m(o,null);u(d,l,f),u(d,i,f),u(d,s,f),B(r,d,f),u(d,c,f),u(d,a,f),u(d,m,f),B(w,d,f),k=!0,b||(v=g(n,"click",t[4]),b=!0)},p(t,n){if(6&n){let e;for(y=Object.entries(t[2]),e=0;e<y.length;e+=1){const l=kt(t,y,e);x[e]?x[e].p(l,n):(x[e]=xt(l),x[e].c(),x[e].m(o,null))}for(;e<x.length;e+=1)x[e].d(1);x.length=y.length}const e={};1&n&&(e.portalID=t[0]),r.$set(e);const l={};1&n&&(l.portalID=t[0]),w.$set(l)},i(t){k||(F(r.$$.fragment,t),F(w.$$.fragment,t),k=!0)},o(t){N(r.$$.fragment,t),N(w.$$.fragment,t),k=!1},d(t){t&&d(n),t&&d(e),t&&d(o),f(x,t),t&&d(l),t&&d(i),t&&d(s),R(r,t),t&&d(c),t&&d(a),t&&d(m),R(w,t),b=!1,v()}}}function vt(t){let n,e,o,l=t[8](t[1].options)+"";return{c(){n=p("td"),e=m(l),h(n,"title",o=t[8](t[1].options)),h(n,"class","svelte-mkkozj")},m(t,o){u(t,n,o),a(n,e)},p(t,i){2&i&&l!==(l=t[8](t[1].options)+"")&&w(e,l),2&i&&o!==(o=t[8](t[1].options))&&h(n,"title",o)},d(t){t&&d(n)}}}function yt(t){let n,e,o,l,i,s=t[8](t[1].options)+"";return{c(){n=p("td"),e=p("a"),o=m(s),h(e,"title",l='<img src="'+t[8](t[1].options)+'" style="width: 100px; height=100px"/>'),h(e,"href",i=t[8](t[1].options)),h(n,"class","svelte-mkkozj")},m(t,l){u(t,n,l),a(n,e),a(e,o)},p(t,n){2&n&&s!==(s=t[8](t[1].options)+"")&&w(o,s),2&n&&l!==(l='<img src="'+t[8](t[1].options)+'" style="width: 100px; height=100px"/>')&&h(e,"title",l),2&n&&i!==(i=t[8](t[1].options))&&h(e,"href",i)},d(t){t&&d(n)}}}function xt(t){let n,e,o,l,i,s=t[7]+"";let r=function(t,n){return"image"==t[7]?yt:vt}(t),c=r(t);return{c(){n=p("tr"),e=p("td"),o=m(s),l=$(),c.c(),i=$(),h(e,"class","svelte-mkkozj")},m(t,s){u(t,n,s),a(n,e),a(e,o),a(n,l),c.m(n,null),a(n,i)},p(t,n){c.p(t,n)},d(t){t&&d(n),c.d()}}}function jt(t){let n,e,o=t[1]&&bt(t);return{c(){n=p("div"),o&&o.c()},m(t,l){u(t,n,l),o&&o.m(n,null),e=!0},p(t,[e]){t[1]?o?(o.p(t,e),2&e&&F(o,1)):(o=bt(t),o.c(),F(o,1),o.m(n,null)):o&&(q(),N(o,1,1,(()=>{o=null})),A())},i(t){e||(F(o),e=!0)},o(t){N(o),e=!1},d(t){t&&d(n),o&&o.d()}}}function Dt(t,n,e){let o;s(t,nt,(t=>e(3,o=t)));let{guid:l=null}=n,i=null;const r={guid:t=>t.guid,timestamp:t=>ct(t.timestamp),team:t=>t.team,latE6:t=>t.data.latE6,lngE6:t=>t.data.lngE6,level:t=>t.level,health:t=>t.data.health,resCount:t=>t.data.resCount,image:t=>t.data.image,title:t=>t.data.title,ornaments:t=>t.data.ornaments,mission:t=>t.data.mission,mission50plus:t=>t.data.mission50plus,artifactBrief:t=>JSON.stringify(t.data.artifactBrief),mods:t=>JSON.stringify(t.data.mods),resonators:t=>JSON.stringify(t.data.resonators),owner:t=>t.data.owner,artifactDetail:t=>JSON.stringify(t.data.artifactDetail),history:t=>t.data.history&&t.data.history._raw||0};return t.$$set=t=>{"guid"in t&&e(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?e(1,i=o[l]):e(1,i=null))},[l,i,r,o,()=>window.renderPortalDetails(l),function(n){j.call(this,t,n)},function(n){j.call(this,t,n)}]}registerCSS("table.svelte-mkkozj td.svelte-mkkozj:last-child{display:inline-block;max-width:25em;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap}h3.svelte-mkkozj.svelte-mkkozj:hover{text-decoration:underline;cursor:pointer}");class Et extends K{constructor(t){super(),Z(this,t,Dt,jt,i,{guid:0})}}function Ct(t,n,e){const o=t.slice();return o[7]=n[e],o}function It(t,n){let e,o,l,i,s,r,c,f,b,v,y=(n[1][n[7]].options.data.title||n[7])+"",x=ct(n[1][n[7]].options.timestamp)+"";function j(){return n[5](n[7])}return{key:t,first:null,c(){e=p("tr"),o=p("td"),l=m(y),s=$(),r=p("td"),c=m(x),f=$(),h(o,"title",i=n[7]),h(o,"class","svelte-azqxto"),k(o,"raw",!n[1][n[7]].options.data.title),h(r,"class","raw svelte-azqxto"),this.first=e},m(t,n){u(t,e,n),a(e,o),a(o,l),a(e,s),a(e,r),a(r,c),a(e,f),b||(v=g(o,"click",j),b=!0)},p(t,e){n=t,3&e&&y!==(y=(n[1][n[7]].options.data.title||n[7])+"")&&w(l,y),1&e&&i!==(i=n[7])&&h(o,"title",i),3&e&&k(o,"raw",!n[1][n[7]].options.data.title),3&e&&x!==(x=ct(n[1][n[7]].options.timestamp)+"")&&w(c,x)},d(t){t&&d(e),b=!1,v()}}}function St(n){let e,o=[],l=new Map,i=n[0];const s=t=>t[7];for(let t=0;t<i.length;t+=1){let e=Ct(n,i,t),r=s(e);l.set(r,o[t]=It(r,e))}return{c(){e=p("table");for(let t=0;t<o.length;t+=1)o[t].c();h(e,"class","svelte-azqxto")},m(t,n){u(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,[n]){7&n&&(i=t[0],o=H(o,n,s,1,t,i,l,e,U,It,null,Ct))},i:t,o:t,d(t){t&&d(e);for(let t=0;t<o.length;t+=1)o[t].d()}}}function Ot(t,n,e){let o;s(t,nt,(t=>e(1,o=t)));const l=x();let{linkID:i=null}=n,{fieldID:r=null}=n,c=[];function a(t){l("select",{type:"portal",guid:t})}return t.$$set=t=>{"linkID"in t&&e(3,i=t.linkID),"fieldID"in t&&e(4,r=t.fieldID)},t.$$.update=()=>{if(27&t.$$.dirty)if(i){const t=window.links[i];e(0,c=t?[t.options.data.oGuid,t.options.data.dGuid]:[])}else if(r){const t=window.fields[r];e(0,c=t?t.options.data.points.map((t=>t.guid)):[])}else e(0,c=Object.keys(o)),c.sort(((t,n)=>o[n].options.timestamp-o[t].options.timestamp))},[c,o,a,i,r,t=>a(t)]}registerCSS("table.svelte-azqxto td.svelte-azqxto:first-child{display:inline-block;max-width:25em;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap}");class _t extends K{constructor(t){super(),Z(this,t,Ot,St,i,{linkID:3,fieldID:4})}}function zt(t,n,e){const o=t.slice();return o[6]=n[e][0],o[7]=n[e][1],o}function Lt(t){let n,e,o,l,i,s,r,c,a,m,g,w,k=Object.entries(t[2]),b=[];for(let n=0;n<k.length;n+=1)b[n]=Gt(zt(t,k,n));return r=new _t({props:{linkID:t[0]}}),r.$on("select",t[4]),g=new wt({props:{linkID:t[0]}}),g.$on("select",t[5]),{c(){n=p("h3"),n.textContent="Link",e=$(),o=p("table");for(let t=0;t<b.length;t+=1)b[t].c();l=$(),i=p("h3"),i.textContent="Portals",s=$(),J(r.$$.fragment),c=$(),a=p("h3"),a.textContent="Fields",m=$(),J(g.$$.fragment),h(o,"class","raw")},m(t,d){u(t,n,d),u(t,e,d),u(t,o,d);for(let t=0;t<b.length;t+=1)b[t].m(o,null);u(t,l,d),u(t,i,d),u(t,s,d),B(r,t,d),u(t,c,d),u(t,a,d),u(t,m,d),B(g,t,d),w=!0},p(t,n){if(6&n){let e;for(k=Object.entries(t[2]),e=0;e<k.length;e+=1){const l=zt(t,k,e);b[e]?b[e].p(l,n):(b[e]=Gt(l),b[e].c(),b[e].m(o,null))}for(;e<b.length;e+=1)b[e].d(1);b.length=k.length}const e={};1&n&&(e.linkID=t[0]),r.$set(e);const l={};1&n&&(l.linkID=t[0]),g.$set(l)},i(t){w||(F(r.$$.fragment,t),F(g.$$.fragment,t),w=!0)},o(t){N(r.$$.fragment,t),N(g.$$.fragment,t),w=!1},d(t){t&&d(n),t&&d(e),t&&d(o),f(b,t),t&&d(l),t&&d(i),t&&d(s),R(r,t),t&&d(c),t&&d(a),t&&d(m),R(g,t)}}}function Gt(t){let n,e,o,l,i,s,r,c=t[6]+"",f=t[7](t[1].options)+"";return{c(){n=p("tr"),e=p("td"),o=m(c),l=$(),i=p("td"),s=m(f),r=$()},m(t,c){u(t,n,c),a(n,e),a(e,o),a(n,l),a(n,i),a(i,s),a(n,r)},p(t,n){2&n&&f!==(f=t[7](t[1].options)+"")&&w(s,f)},d(t){t&&d(n)}}}function Mt(t){let n,e,o=t[1]&&Lt(t);return{c(){n=p("div"),o&&o.c()},m(t,l){u(t,n,l),o&&o.m(n,null),e=!0},p(t,[e]){t[1]?o?(o.p(t,e),2&e&&F(o,1)):(o=Lt(t),o.c(),F(o,1),o.m(n,null)):o&&(q(),N(o,1,1,(()=>{o=null})),A())},i(t){e||(F(o),e=!0)},o(t){N(o),e=!1},d(t){t&&d(n),o&&o.d()}}}function Pt(t,n,e){let o;s(t,et,(t=>e(3,o=t)));let{guid:l=null}=n,i=null;const r={guid:t=>t.guid,timestamp:t=>ct(t.timestamp),team:t=>t.team,oGuid:t=>t.data.oGuid,oLatE6:t=>t.data.oLatE6,oLngE6:t=>t.data.oLngE6,dGuid:t=>t.data.dGuid,dLatE6:t=>t.data.dLatE6,dLngE6:t=>t.data.dLngE6};return t.$$set=t=>{"guid"in t&&e(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?e(1,i=o[l]):e(1,i=null))},[l,i,r,o,function(n){j.call(this,t,n)},function(n){j.call(this,t,n)}]}class Tt extends K{constructor(t){super(),Z(this,t,Pt,Mt,i,{guid:0})}}function qt(t,n,e){const o=t.slice();return o[6]=n[e][0],o[7]=n[e][1],o}function At(t){let n,e,o,l,i,s,r,c,a,m,g,w,k=Object.entries(t[2]),b=[];for(let n=0;n<k.length;n+=1)b[n]=Ft(qt(t,k,n));return r=new _t({props:{fieldID:t[0]}}),r.$on("select",t[4]),g=new pt({props:{fieldID:t[0]}}),g.$on("select",t[5]),{c(){n=p("h3"),n.textContent="Field",e=$(),o=p("table");for(let t=0;t<b.length;t+=1)b[t].c();l=$(),i=p("h3"),i.textContent="Portals",s=$(),J(r.$$.fragment),c=$(),a=p("h3"),a.textContent="Links",m=$(),J(g.$$.fragment),h(o,"class","raw")},m(t,d){u(t,n,d),u(t,e,d),u(t,o,d);for(let t=0;t<b.length;t+=1)b[t].m(o,null);u(t,l,d),u(t,i,d),u(t,s,d),B(r,t,d),u(t,c,d),u(t,a,d),u(t,m,d),B(g,t,d),w=!0},p(t,n){if(6&n){let e;for(k=Object.entries(t[2]),e=0;e<k.length;e+=1){const l=qt(t,k,e);b[e]?b[e].p(l,n):(b[e]=Ft(l),b[e].c(),b[e].m(o,null))}for(;e<b.length;e+=1)b[e].d(1);b.length=k.length}const e={};1&n&&(e.fieldID=t[0]),r.$set(e);const l={};1&n&&(l.fieldID=t[0]),g.$set(l)},i(t){w||(F(r.$$.fragment,t),F(g.$$.fragment,t),w=!0)},o(t){N(r.$$.fragment,t),N(g.$$.fragment,t),w=!1},d(t){t&&d(n),t&&d(e),t&&d(o),f(b,t),t&&d(l),t&&d(i),t&&d(s),R(r,t),t&&d(c),t&&d(a),t&&d(m),R(g,t)}}}function Ft(t){let n,e,o,l,i,s,r,c=t[6]+"",f=t[7](t[1].options)+"";return{c(){n=p("tr"),e=p("td"),o=m(c),l=$(),i=p("td"),s=m(f),r=$()},m(t,c){u(t,n,c),a(n,e),a(e,o),a(n,l),a(n,i),a(i,s),a(n,r)},p(t,n){2&n&&f!==(f=t[7](t[1].options)+"")&&w(s,f)},d(t){t&&d(n)}}}function Nt(t){let n,e,o=t[1]&&At(t);return{c(){n=p("div"),o&&o.c()},m(t,l){u(t,n,l),o&&o.m(n,null),e=!0},p(t,[e]){t[1]?o?(o.p(t,e),2&e&&F(o,1)):(o=At(t),o.c(),F(o,1),o.m(n,null)):o&&(q(),N(o,1,1,(()=>{o=null})),A())},i(t){e||(F(o),e=!0)},o(t){N(o),e=!1},d(t){t&&d(n),o&&o.d()}}}function Ut(t,n,e){let o;s(t,ot,(t=>e(3,o=t)));let{guid:l=null}=n,i=null;const r={guid:t=>t.guid,timestamp:t=>ct(t.timestamp),team:t=>t.team,"points[0].guid":t=>t.data.points[0].guid,"points[0].latE6":t=>t.data.points[0].latE6,"points[0].lngE6":t=>t.data.points[0].lngE6,"points[1].guid":t=>t.data.points[1].guid,"points[1].latE6":t=>t.data.points[1].latE6,"points[1].lngE6":t=>t.data.points[1].lngE6,"points[2].guid":t=>t.data.points[2].guid,"points[2].latE6":t=>t.data.points[2].latE6,"points[2].lngE6":t=>t.data.points[2].lngE6};return t.$$set=t=>{"guid"in t&&e(0,l=t.guid)},t.$$.update=()=>{9&t.$$.dirty&&(l&&o[l]?e(1,i=o[l]):e(1,i=null))},[l,i,r,o,function(n){j.call(this,t,n)},function(n){j.call(this,t,n)}]}class Ht extends K{constructor(t){super(),Z(this,t,Ut,Nt,i,{guid:0})}}function Jt(n){let e,o,l;return{c(){e=p("li"),e.textContent="Current portal",h(e,"class","svelte-j7wrko")},m(t,i){u(t,e,i),o||(l=g(e,"click",n[5]),o=!0)},p:t,d(t){t&&d(e),o=!1,l()}}}function Bt(n){let e,o;return e=new wt({}),e.$on("select",n[4]),{c(){J(e.$$.fragment)},m(t,n){B(e,t,n),o=!0},p:t,i(t){o||(F(e.$$.fragment,t),o=!0)},o(t){N(e.$$.fragment,t),o=!1},d(t){R(e,t)}}}function Rt(n){let e,o;return e=new pt({}),e.$on("select",n[4]),{c(){J(e.$$.fragment)},m(t,n){B(e,t,n),o=!0},p:t,i(t){o||(F(e.$$.fragment,t),o=!0)},o(t){N(e.$$.fragment,t),o=!1},d(t){R(e,t)}}}function Yt(n){let e,o;return e=new _t({}),e.$on("select",n[4]),{c(){J(e.$$.fragment)},m(t,n){B(e,t,n),o=!0},p:t,i(t){o||(F(e.$$.fragment,t),o=!0)},o(t){N(e.$$.fragment,t),o=!1},d(t){R(e,t)}}}function Zt(t){let n,e,o,l;const i=[Vt,Qt,Kt],s=[];function r(t,n){return"portal"==t[0]?0:"link"==t[0]?1:"field"==t[0]?2:-1}return~(e=r(t))&&(o=s[e]=i[e](t)),{c(){n=p("div"),o&&o.c(),h(n,"class","card svelte-j7wrko")},m(t,o){u(t,n,o),~e&&s[e].m(n,null),l=!0},p(t,l){let c=e;e=r(t),e===c?~e&&s[e].p(t,l):(o&&(q(),N(s[c],1,1,(()=>{s[c]=null})),A()),~e?(o=s[e],o?o.p(t,l):(o=s[e]=i[e](t),o.c()),F(o,1),o.m(n,null)):o=null)},i(t){l||(F(o),l=!0)},o(t){N(o),l=!1},d(t){t&&d(n),~e&&s[e].d()}}}function Kt(t){let n,e;return n=new Ht({props:{guid:t[1]}}),n.$on("select",t[4]),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,e){const o={};2&e&&(o.guid=t[1]),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Qt(t){let n,e;return n=new Tt({props:{guid:t[1]}}),n.$on("select",t[4]),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,e){const o={};2&e&&(o.guid=t[1]),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Vt(t){let n,e;return n=new Et({props:{guid:t[1]}}),n.$on("select",t[4]),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,e){const o={};2&e&&(o.guid=t[1]),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Wt(t){let n,e,l,i,s,r,c,f,m,w,b,v,y,x,j,D,E=t[3]&&Jt(t);const C=[Yt,Rt,Bt],I=[];function S(t,n){return"portals"==t[2]?0:"links"==t[2]?1:"fields"==t[2]?2:-1}~(b=S(t))&&(v=I[b]=C[b](t));let O=t[0]&&Zt(t);return{c(){n=p("div"),e=p("div"),l=p("ul"),i=p("li"),i.textContent="Portals",s=$(),r=p("li"),r.textContent="Links",c=$(),f=p("li"),f.textContent="Fields",m=$(),E&&E.c(),w=$(),v&&v.c(),y=$(),O&&O.c(),h(i,"class","svelte-j7wrko"),k(i,"active","portals"==t[2]),h(r,"class","svelte-j7wrko"),k(r,"active","links"==t[2]),h(f,"class","svelte-j7wrko"),k(f,"active","fields"==t[2]),h(l,"class","tablist svelte-j7wrko"),h(e,"class","list svelte-j7wrko"),h(n,"class","content svelte-j7wrko")},m(o,d){u(o,n,d),a(n,e),a(e,l),a(l,i),a(l,s),a(l,r),a(l,c),a(l,f),a(l,m),E&&E.m(l,null),a(e,w),~b&&I[b].m(e,null),a(n,y),O&&O.m(n,null),x=!0,j||(D=[g(i,"click",t[6]),g(r,"click",t[7]),g(f,"click",t[8])],j=!0)},p(t,o){4&o&&k(i,"active","portals"==t[2]),4&o&&k(r,"active","links"==t[2]),4&o&&k(f,"active","fields"==t[2]),t[3]?E?E.p(t,o):(E=Jt(t),E.c(),E.m(l,null)):E&&(E.d(1),E=null);let s=b;b=S(t),b===s?~b&&I[b].p(t,o):(v&&(q(),N(I[s],1,1,(()=>{I[s]=null})),A()),~b?(v=I[b],v?v.p(t,o):(v=I[b]=C[b](t),v.c()),F(v,1),v.m(e,null)):v=null),t[0]?O?(O.p(t,o),1&o&&F(O,1)):(O=Zt(t),O.c(),F(O,1),O.m(n,null)):O&&(q(),N(O,1,1,(()=>{O=null})),A())},i(t){x||(F(v),F(O),x=!0)},o(t){N(v),N(O),x=!1},d(t){t&&d(n),E&&E.d(),~b&&I[b].d(),O&&O.d(),j=!1,o(D)}}}function Xt(t){let n,e;return n=new W({props:{options:{title:"Data Explorer",resizable:!0,width:"auto"},$$slots:{default:[Wt]},$$scope:{ctx:t}}}),{c(){J(n.$$.fragment)},m(t,o){B(n,t,o),e=!0},p(t,[e]){const o={};1039&e&&(o.$$scope={dirty:e,ctx:t}),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){N(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function tn(t,n,e){let o;s(t,lt,(t=>e(3,o=t)));let l=null,i=null;let r="portals";return[l,i,r,o,function(t){if(function(){let t,n;switch(l){case"portal":break;case"link":t=window.links[i],t&&t.setStyle({color:COLORS[t.options.team]});break;case"field":n=window.fields[i],n&&n.setStyle({fillColor:COLORS[n.options.team]})}}(),t.detail)switch(e(0,l=t.detail.type),e(1,i=t.detail.guid),l){case"portal":window.selectPortal(i);break;case"link":const t=window.links[i];t&&t.setStyle({color:"red"});break;case"field":const n=window.fields[i];n&&(n.setStyle({fillColor:"red"}),n.bringToFront())}else e(1,i=null),e(0,l=null)},function(){window.selectedPortal&&(e(0,l="portal"),e(1,i=window.selectedPortal))},()=>e(2,r="portals"),()=>e(2,r="links"),()=>e(2,r="fields")]}registerCSS('.content.svelte-j7wrko.svelte-j7wrko{display:flex;gap:.5em}.tablist.svelte-j7wrko.svelte-j7wrko{padding-left:1em}.tablist.svelte-j7wrko li.svelte-j7wrko{display:inline-block}.tablist.svelte-j7wrko li.active.svelte-j7wrko{font-weight:bold}.tablist.svelte-j7wrko li.svelte-j7wrko:nth-child(n+2)::before{content:"| "}.content.svelte-j7wrko>div.svelte-j7wrko{background-color:#0003;border-radius:10px;padding:0.5em}.content.svelte-j7wrko table{padding:2px;border:1px solid #69a;background-color:#0001;width:100%}.content.svelte-j7wrko table td.raw,.content.svelte-j7wrko table.raw td{font-family:monospace;white-space:nowrap}.content.svelte-j7wrko table tr:nth-child(2n){background-color:#0003}');class nn extends K{constructor(t){super(),Z(this,t,tn,Xt,i,{})}}function en(n){let e,o,l;return{c(){e=p("a"),e.textContent="DataExplorer"},m(t,i){u(t,e,i),o||(l=g(e,"click",n[0]),o=!0)},p:t,i:t,o:t,d(t){t&&d(e),o=!1,l()}}}function on(t,n,e){let o,l,i,r;return s(t,lt,(t=>e(1,o=t))),s(t,ot,(t=>e(2,l=t))),s(t,et,(t=>e(3,i=t))),s(t,nt,(t=>e(4,r=t))),c(nt,r=window.portals,r),c(et,i=window.links,i),c(ot,l=window.fields,l),c(lt,o=window.selectedPortal,o),window.addHook("mapDataRefreshEnd",(()=>{c(nt,r=window.portals,r),c(et,i=window.links,i),c(ot,l=window.fields,l)})),window.addHook("portalAdded",(t=>{c(nt,r[t.portal.options.guid]=t.portal,r)})),window.addHook("linkAdded",(t=>{c(et,i[t.link.options.guid]=t.link,i)})),window.addHook("fieldAdded",(t=>{c(ot,l[t.field.options.guid]=t.field,l)})),window.addHook("portalSelected",(t=>{c(lt,o=t.selectedPortalGuid,o)})),[function(){new nn({target:document.body})}]}class ln extends K{constructor(t){super(),Z(this,t,on,en,i,{})}}const sn="dataExplorer";class rn{init(){const t=document.querySelector("#toolbox");new ln({target:t})}}return()=>{window.plugin[sn]=new rn,window.plugin[sn].init(),addCSSs()}}();
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
} // wrapper end
// inject code into site context
var script = document.createElement('script');
var info = {};
if (typeof GM_info !== 'undefined' && GM_info && GM_info.script) info.script = { version: GM_info.script.version, name: GM_info.script.name, description: GM_info.script.description };
script.appendChild(document.createTextNode('('+ wrapper +')('+JSON.stringify(info)+');'));
(document.body || document.head || document.documentElement).appendChild(script);
